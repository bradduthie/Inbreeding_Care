---
title: "Inbreeding parents should invest more resources in fewer offspring"
author: "Brad Duthie et al."
date: "May 27, 2016"
output:
  pdf_document:
    fig_caption: yes
  html_document: default
  word_document:
    fig_caption: yes
    pandoc_args:
    - --csl
    - evolution.csl
header-includes:
- \usepackage{natbib}
- \usepackage{lineno}
- \linenumbers
- \bibliographystyle{amnatnat}
linestretch: 1
csl: evolution.csl
bibliography: Inbreeding_and_PI.bib
---

<!---
- \setlength\parindent{24pt} 
  word_document:
    reference_docx: AASRJ-Style-Format.docx
--->

******************************


```{r, echo=FALSE}
figscale <- 1.0; # Avoid making huge figures.
```


Abstract
===================================================

In all sexually reproducing organisms, there is the potential for breeding between relatives (inbreeding). While inbreeding typically decreases offspring fitness, it can also increase the inclusive fitness of parents by increasing the rate at which identical-by-descent alleles are carried in inbred offspring. Inbreeding theory assumes that any negative effects of inbreeding depression are fixed, and that parents cannot therefore adjust their parental investment (PI) in response to inbreeding. Similarly, PI theory assumes that offspring are outbred. By synthesising inbreeding and PI theory, we generate novel and broadly relevant predictions for how optimal PI and inclusive fitness change when parents inbreed, and thereby identify the direction of selection on PI given inbreeding. Specifically, we show that (1) optimal PI always increases when offspring are inbred and inbreeding depression is non-negligible, affecting fitness consequences for inbreeding versus avoiding inbreeding. (2) Optimal PI increases with increasing inbreeding under monogamy relative to single parent investment, but inbreeding is always maladaptive under monogamy, and (3) optimal PI is unaffected if a focal parent is inbred. These conclusions have potentially broad implications for understanding inbreeding and PI in empirical systems, and the theory we develop can serve as a foundation for understanding intrafamilial conflict given inbreeding.


Introduction
===================================================

Natural selection is a universal biological process by which inherited traits are preserved within populations if they increase an individual's lifetime reproductive success, which classically defines individual fitness [@Darwin1859; @Dawkins1982]. Inclusive fitness theory [@Hamilton1964; @Hamilton1964a] provides a key extension to this classical definition of fitness, recognising that natural selection will more generally act on individual phenotypes to maximise the rate of increase of replica allele copies [@Grafen2006]. Inclusive fitness accounts for both an individual's own reproductive success and that of relatives who share identical-by-descent alleles. It provides key evolutionary insights [@Gardner2014], perhaps most iconically reconciling self-sacrificial behaviour by appealing to the increased reproductive success of related beneficiaries [@Hamilton1964], and identifying causes of conflict between parents and offspring, and among siblings, over parental investment [hereafter `PI'; @Trivers1972; @Trivers1974].

It is less widely appreciated that the reproductive success of relatives can also be increased by inbreeding, and that selection for inbreeding tolerance or preference might therefore occur despite decreased viability of inbred offspring [i.e., `inbreeding depression'; @Parker1979]. Inclusive fitness theory has focused solely on individuals' decisions to inbreed or avoid inbreeding, assuming no concurrent modulation of PI [e.g., @Parker2006; @Kokko2006; @Duthie2015a]. But this restrictive assumption ignores that inbreeding increases both parent-offspring relatedness and the potential to increase offspring viability through PI. Here we consider selection on PI when offspring are inbred, and how optimisation of PI might in turn affect selection on inbreeding. We thereby derive a novel hypothesis that affects selection on PI and offspring production across all sexual species.

Biparental inbreeding theory has been developed primarily by extending Parker's [-@Parker1979] basic inclusive fitness model, wherein a focal parent encounters a focal relative and chooses to either inbreed or avoid inbreeding with them [e.g., @Parker1979; @Parker2006; @Kokko2006; @Duthie2015a]. If the focal parent inbreeds, then the viability of resulting offspring decreases due to inbreeding depression (hereafter `ID'), but the offspring will carry additional copies of the focal parent's alleles that are inherited from the parent's related mate. The focal parent can thereby increase its inclusive fitness by inbreeding if the number of identical-by-descent alleles in its inbred offspring exceeds that of outbred offspring after accounting for any ID in offspring viability. The magnitude of ID below which inbreeding rather than avoiding inbreeding increases a parent's inclusive fitness is sex-specific, assuming that females are resource limited and therefore always produce a fixed number of offspring, while male reproduction is limited only by mating opportunities (i.e., traditional sex roles). Under such conditions, inbreeding females can only increase their inclusive fitness indirectly by increasing the reproductive success of their male relatives, but inbreeding males can increase their inclusive fitness directly by increasing their own reproductive success. Only males are therefore predicted to benefit by inbreeding given strong ID, while both females and males are predicted to benefit by inbreeding given weak ID. These predictions are sensitive to the assumption that there is a low or negligible opportunity cost of male mating. If inbreeding precludes a male from siring an additional outbred offspring (e.g., as a consequence of monogamy and associated PI), then inbreeding is never beneficial [@Waser1986]. However, all of these inclusive fitness consequences of inbreeding assume that PI is fixed; no theory considers inbreeding decisions when PI is allocated optimally.


The framework for parental investment (hereafter 'PI') theory is well-established under outbreeding, but how PI and fitness are predicted to change when offspring are inbred remains unexplored. Importantly, PI does not simply represent raw resources provided to an offspring (e.g., food), but is rather anything that a parent does to increase its offspring's fitness at the expense of its other actual or potential offspring [@Trivers1972; @Trivers1974]. One key assumption of PI theory is therefore that the degree to which a parent invests in its offspring is directly and inversely related to the number of offspring that it produces. A second key assumption is that offspring fitness increases with increasing PI, but in such a way as to cause diminishing returns on offspring fitness as more PI is provided. Given these two assumptions, optimal PI for which parental fitness is maximised can be determined; this is usually considered in the context of parent-offspring conflict over investment [e.g., @Macnair1978; @Parker1978; @Parker1985; @DeJong2005; @Kuijper2012]. Models of PI assume that offspring are outbred [or the result of self-fertilisation as in @DeJong2005], but in wild populations inbreeding is both variable and ubiquitous, and directly affects both offspring fitness and parent-offspring relatedness [@OGrady2006; @Charlesworth2009], and therefore might profoundly affect a parent's optimal PI. Yet no theory predicts how parents should adjust their PI given different degrees of inbreeding, or the extent to which adjusting PI can in turn affect parent fitness.

Two additional assumptions are worth considering; both PI and fitness might be affected if investment is shared between parents, or if parents are themselves inbred. For example, while optimal PI and fitness are not expected to differ between single parent investment and monogamous biparental investment given outbreeding [@Parker1985], this might not be the case given inbreeding when monogamy entails a mating opportunity cost [@Waser1986] to a focal female's related male. Additionally, it is unrealistic to assume that focal parents will necessarily be outbred in a population where the opportunity for inbreeding exists. If parents are inbred, it will affect the rate at which they pass identical-by-descent alleles to their offspring [e.g., @Duthie2015a]; hence the consequences of inbred focal parents on PI and parental fitness cannot necessarily be ignored. We therefore consider the consequences of biparental investment and inbred focal parents on optimal PI and parent fitness.

Inclusive fitness consequences of inbreeding are well-established, but all models of inbreeding implicitly assume that PI does not vary as a consequence of inbreeding because inbreeding and outbreeding females both produce the same fixed number of offspring. If individuals can vary the number of offspring that they produce, and thereby adjust their investment per offspring, then they might be able to mitigate the negative fitness consequences of inbreeding depression, leading to general predictions for how selection should affect the evolution of PI and inbreeding. Here we have three specific aims: (1) to show how optimal PI changes when offspring are inbred, and for different magnitudes of inbreeding depression; (2) to show how an inbreeding parent's optimal PI is indirectly affected by opportunity costs when both parents invest in offspring; and (3) to show how parental fitness, but not optimal PI, changes when a parent is itself inbred.


******************************

Model
===================================================

Our model conceptually synthesises two different theoretical frameworks initially developed by @Parker1979 and @Macnair1978 to generate new predictions that are generally applicable across all sexual species. The first framework [@Parker1979] predicts inbreeding depression thresholds below which focal parents increase their fitness by inbreeding rather than avoiding inbreeding. The second framework [@Macnair1978] predicts optimal PI in outbred offspring. We consider a focal diploid parent (hereafter assumed to be female) that can adjust the degree to which she invests in each offspring to maximise her own fitness given that she inbreeds to some degree and produces correspondingly inbred offspring whose fitness might be decreased by inbreeding depression.  

We define a focal female's fitness in terms of the rate at which she increases the number of identical-by-descent allele copies carried in her offspring. This definition differs from that of previous models of PI [e.g., @Macnair1978; @Parker1978], which instead define fitness only in terms of the rate at which offspring are produced and therefore cannot account for inclusive fitness differences between inbred and outbred offspring.  As in @Parker1978, we assume that direct offspring fitness (e.g., offspring survival) increases with increasing PI ($m$), with diminishing returns as $m$ increases. Females have a total investment budget of $M$, and therefore will produce $n=M/m$ total offspring. Following @Parker1985, we assume for simplicity that $M \gg m$, but violations of this assumption should not affect our general conclusions. Overall, the number of identical-by-descent allele copies carried per offspring ($\zeta_{\textrm{off}}$) is represented as,

(@maineq) $$ \zeta_{\textrm{off}} = \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m-m_{min}-\beta r\right)}\right). $$ 

Parameters are summarised in Table 1. It is helpful to conceptualise Eq. @maineq in two pieces. First, the expression $\left(1/2\right) \left(1 + r\right)$ is the fitness increment that a female gains from identical-by-descent alleles carried by her offspring, as is affected by the coefficient of relatedness between the female and the sire of her offspring ($r$) scaled by a factor of $1/2$ for each parent's genetic contribution to its offspring. Second, the expression $\left(1 - \exp\left[-c\left(m-m_{min}-\beta r\right)\right]\right)$ is the individual offspring's direct fitness as a function of $m$ and $r$. Additionally, offspring fitness is affected by a minimum value of $m$ required for offspring viability ($m_{min}$), inbreeding depression ($\beta$), and a parameter that affects the curve of PI with respect to fitness ($c$; i.e., how 'diminishing' the returns are on $\zeta_{\textrm{off}}$ from increasing $m$). When a focal female inbreeds, the first expression increases because more identical-by-descent alleles are carried by inbred offspring, but the second expression will decrease if $\beta>0$ due to inbreeding depression in those offspring.

Parameter               | Description
------------------------|---------------------------------------------------------
$M$                     | Parent's total investment budget
$m$                     | Parent's investment per offspring
$n$                     | Parent's total offspring production
$\zeta_{\textrm{off}}$  | Identical-by-descent allele copies carried per offspring
$r$                     | Relatedness of a mate to the focal parent
$m_{min}$               | Minimum parental investment requried for offspring viability
$\beta$                 | Inbreeding depression in offspring
$c$                     | Curve of parental investment with offspring fitness
$\gamma$                | Parent's rate of fitness increase

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   **Table 1: List of parameter values and descriptions.**

When $r=0$ and $\beta=0$ (outbreeding), Eq. @maineq reduces to standard models of PI [e.g., @Macnair1978; @Parker1978] but with the usual parameter $K$ replaced by $1/2$, and thereby specifically representing identical-by-descent alleles instead of an arbitrary constant affecting offspring fitness. Similarly, given $\delta = \exp\left[-c\left(m-m_{min}-\beta r\right)\right]$, where $\delta$ defines reduced fitness of inbred offspring as in previous models of biparental inbreeding [e.g., @Kokko2006; @Parker2006; @Duthie2015a], Eq. @maineq reduces to Parker's [-@Parker1979] standard model of biparental inbreeding.  All offspring have the same direct fitness as $m \to \infty$. Consequently, our model assumes that sufficient PI can always compensate for being inbred, although the amount of investment required for such compensation might be very high (See Supporting Information S1 for a relaxation of this assumption).


Parental investment and fitness when offspring are inbred
----------------------------------------------------

Equation @maineq can be analysed to determine optimal PI ($m^{*}$), and the rate at which identical-by-descent alleles are passed given $m^{*}$ [@Kuijper2012], which we define as $\gamma^{*}$. An example contrasting outbreeding ($r=0$) with inbreeding between first order relatives ($r=1/2$) illustrates this analysis. For simplicity, we assume that $m_{min}=1$, $\beta=1$, and $c=1$ (see Appendix 1 for sample derivations of $m^{*}$ and $\gamma^{*}$ under these conditions).

```{r, echo=FALSE, fig.width = 6*figscale, fig.height = 8*figscale, fig.cap="(A) Relationship between parental investment and the proportion of a focal female's identical-by-descent alleles that are are carried in its offspring for females that outbreed (solid curve) and females that inbreed with first order relatives (dashed curve). Tangent lines identify optimal parental investment, and their slopes define a female's rate of fitness increase when outbreeding (solid line) and inbreeding (dashed line). Dotted horizontal line shows zero on the y-axis. (B) Relationship between the magnitude of inbreeding depression and optimal parental investment across four degrees of relatedness between a focal female and her mate."}
# Below is a function of the general equation for plotting
OffATr <- function(r, m, mmin=1, Beta=1, c=1){
    return( (1/2)*(1+r) * (1 - exp(-c*(m - mmin - Beta*r)) ));
}
# Below is the same equation as an expression for maths
fm  <- expression(0.5*(1+r)*(1-exp(-c*(m-mmin-Beta*r))),'m');
# We can use the above to differentiate fm wrt `m`
fmd <- D(fm,'m'); # can print fmd to show solution
# Below is fmd for analysis and plotting
OffATrd <- function(r, m, mmin=1, Beta=1, c=1){
    return(  0.5 * (1 + r) * (exp(-c * (m - mmin - Beta * r)) * c)  );
    # Also can simplify: return(  (c/2)*(1+r)*exp(-c*(m-mmin-Beta*r))  );
} # We'll need the above to find m^{*} and \gamma^{*} 
# To find m^{*}, can use the function below
findm <- function(low.guess,high.guess,rval,mmin=1,Beta=1,c=1){
  fm  <- function(m,r=rval){ 
           OffATrd(r=rval, mmin=mmin, Beta=Beta, m=m, c=c)*(0-m) + 
             OffATr(r=rval, mmin=mmin, Beta=Beta, m=m, c=c);
         }
  lg  <- fm(m=low.guess, r=rval);
  hg  <- fm(m=high.guess,r=rval);
  if(lg > 0){
    u <- low.guess;
    l <- high.guess;
  }else{
    u <- high.guess;
    l <- low.guess;
  }
  if((fm(l) > 0 & fm(u) > 0) | (fm(l) < 0 & fm(u) < 0)){
    return("Value of m is outside the range");
  }else{
    check  <- 1;
    mguess <- 0.5 * (l+u);
    i      <- 0;
    while(abs(check) > 0.000001 & i < 1000000){
        check <- fm(r=rval, m=mguess);
        if(check > 0){
          u      <- mguess;
          mguess <- 0.5*(l+mguess); 
        }else{
          l      <- mguess;
          mguess <- 0.5*(u+mguess);
        }
        i <- i+1;
    }
    return(mguess);
  }
} # Running the below returns the estimate
# Below returns m^{*} for outbreeders and inbreeders, respectively
r00m <- findm(low.guess=0,high.guess=4,rval=0.0,mmin=1,Beta=1,c=1);
r05m <- findm(low.guess=0,high.guess=4,rval=0.5,mmin=1,Beta=1,c=1);
# Below finds the tangent slope, \gamma^{*}
r00g <- OffATr(r=0,   m=r00m, mmin=1, Beta=1, c=1) / r00m;
r05g <- OffATr(r=0.5, m=r05m, mmin=1, Beta=1, c=1) / r05m;
# The code below plots everything
PI <- seq(from=0,to=4,by=0.01);
Alleles_IBD_outbr <- OffATr(r=0.0, m=PI, mmin=1, Beta=1, c=1);
Alleles_IBD_inbr  <- OffATr(r=0.5, m=PI, mmin=1, Beta=1, c=1);
# -------------------------------------
r00m.b3 <- findm(low.guess=0,high.guess=6,rval=0.0,mmin=1,Beta=3,c=1);
r05m.b3 <- findm(low.guess=0,high.guess=6,rval=0.5,mmin=1,Beta=3,c=1);
r00g.b3 <- OffATr(r=0,   m=r00m.b3, mmin=1, Beta=3, c=1) / r00m.b3;
r05g.b3 <- OffATr(r=0.5, m=r05m.b3, mmin=1, Beta=3, c=1) / r05m.b3;
bss <- seq(from=0.5,to=5,by=0.25);
gamz <- function(rvl,betas,mmin=1,c=1){
    mvl <- rep(0,length(betas));
    gam <- rep(0,length(betas));
    for(i in 1:length(bss)){
        mvl[i] <- findm(low.guess=0,high.guess=10,rval=rvl,mmin=1,Beta=betas[i],c=1);
        gam[i] <- OffATr(r=rvl, m=mvl[i], mmin=1, Beta=betas[i], c=1) / mvl[i];
    }
    return(list(mvl=mvl,gam=gam));
}
rg000 <- gamz(rvl=0.000,betas=bss);
rg125 <- gamz(rvl=0.125,betas=bss);
rg250 <- gamz(rvl=0.250,betas=bss);
rg500 <- gamz(rvl=0.500,betas=bss);
#-----------------------------------------
par(mfrow=c(2,1),mar=c(5,5,1,1),lwd=2);
layout(matrix(data=c(1,2), nrow=2, ncol=1, byrow = TRUE),
       widths=c(1,1), heights=c(1,1));
# --------------------------------------------------------------------
plot(PI,Alleles_IBD_outbr,type="l",lwd=3,ylim=c(0,1),yaxs="i",xaxs="i",
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(h=0,lty="dotted",lwd=0.8);
points(PI,Alleles_IBD_inbr,type="l",lwd=3,lty="dashed");
abline(a=0,b=r00g,lty="solid", lwd=1); # Tangent line r = 0
abline(a=0,b=r05g,lty="dashed",lwd=1); # Tangent line r = 0.5
text(x=0.15,y=0.92,labels="A",cex=2.5);
# --------------------------------------------------------------------
plot(x=bss,y=rg000$mvl,type="l",lwd=2,ylim=c(2,6),pch=1.5,
     xlab=expression(paste("Inbreeding depression (",beta,")")),
     ylab=expression(paste("Optimum PI (",italic(m),"*)")),
     cex.lab=1.5,cex.axis=1.5);
points(x=bss,y=rg125$mvl,type="l",lwd=2);
points(x=bss,y=rg250$mvl,type="l",lwd=2);
points(x=bss,y=rg500$mvl,type="l",lwd=2);
text(x=bss[17],y=rg000$mvl[17]+0.17,labels="r=0",srt=-0,cex=1.25);
text(x=bss[17],y=rg125$mvl[17]+0.2,labels="r=1/8",srt=6,cex=1.25);
text(x=bss[17],y=rg250$mvl[17]+0.2,labels="r=1/4",srt=12.5,cex=1.25);
text(x=bss[17],y=rg500$mvl[17]+0.2,labels="r=1/2",srt=18,cex=1.25);
text(x=0.5,y=5.80,labels="B",cex=2.5);
```

```{r, echo=FALSE}
OffAT <- function(r, m, B0=1, B1=1, c=1){
    return( (1/2)*(1+r) * (1 - exp(-c*(m - B0 - B1*r)) ));
}
```

Figure 1A shows how $\zeta_{\textrm{off}}$ increases with $m$ given $r=0$ (solid curve) and $r=1/2$ (dashed curve). Given $r=0$, $\zeta_{\textrm{off}}=0$ when $m \leq m_{min}$, meaning that offspring are only viable when $m>m_{min}$. Increasing $r$ increases the minimum amount of PI required to produce a viable offspring to $m_{min}+\beta r$, so when $r=1/2$, $\zeta_{\textrm{off}}=0$ when $m \leq 3/2$. Nevertheless, because inbred offspring carry more of their parents' alleles identical-by-descent, sufficiently high $m$ causes $\zeta_{\textrm{off}}$ of inbred offspring to exceed that of outbred offspring (represented by the intersection between solid and dashed curves in Figure 1A). The point on the line running through the origin that is tangent to $\zeta_{\textrm{off}}(m)$ defines optimal PI for outbreeding $m^{*}_{r=0}=$ `r round(r00m,digits=3)` (solid line) and inbreeding $m^{*}_{r=1/2}=$ `r round(r05m,digits=3)` (dashed line) parents. The slope of each line is the rate of a parent's fitness increase given outbreeding $\gamma^{*}_{r=0}=$ `r round(r00g,digits=3)` (solid line) and inbreeding $\gamma^{*}_{r=1/2}=$ `r round(r05g,digits=3)` (dashed line). To maximise fitness, individuals that inbreed with first order relatives ($r=1/2$) should therefore invest more in offspring than individuals that outbreed ($m^{*}_{r=1/2}>m^{*}_{r=0}$). This result is general across different values of $r$ (see Appendix 2); as $r$ increases, so does $m^{*}$. All else being equal, individuals that inbreed more should therefore invest more per capita in fewer total offspring.

A general relationship between $\beta$ and $m^{*}$ for different values of $r$ can be determined numerically. In Fig. 1B, this relationship is shown across a range of $\beta$ for $r$ values corresponding to outbreeding ($r=0$) and inbreeding between outbred cousins ($r=1/8$), half-siblings ($r=1/4$), and full siblings ($r=1/2$). Across all parameter combinations, $m_{min}=1$ and $c=1$. Overall, Figure 1B shows how optimal PI increases with increasing inbreeding depression and relatedness between parents, and that the difference in magnitude of investment per offspring is often expected to be high for individuals that inbreed rather than outbreed (e.g., when $\beta=3.25$, $m^{*}_{r=1/2} > m^{*}_{r=0}$ by a factor of `r round(findm(low.guess=0,high.guess=5,rval=0.5,Beta=3.25) / findm(low.guess=0,high.guess=5,rval=0.0,Beta=3.25),digits=2)`). 

```{r, echo=FALSE, fig.width = 6*figscale, fig.height = 8*figscale, fig.cap="Relationship between the magnitude of inbreeding depression and the rate of a focal female's fitness increase across four degrees of relatedness between a focal female and her mate assuming that (A) focal females invest optimally given their degree of inbreeding and (B) females invest at the optimum for outbreeding."}
# Find gamma assuming investing as if outbreeding
gamznokin <- function(rvl,betas,mmin=1,c=1){
    mvl <- rep(0,length(betas));
    gam <- rep(0,length(betas));
    for(i in 1:length(bss)){
        mvl[i] <- findm(low.guess=0,high.guess=10,rval=0,mmin=1,Beta=betas[i],c=1);
        gam[i] <- OffATr(r=rvl, m=mvl[i], mmin=1, Beta=betas[i], c=1) / mvl[i];
    }
    return(list(mvl=mvl,gam=gam));
}
rg000nk <- gamznokin(rvl=0.000,betas=bss);
rg125nk <- gamznokin(rvl=0.125,betas=bss);
rg250nk <- gamznokin(rvl=0.250,betas=bss);
rg500nk <- gamznokin(rvl=0.500,betas=bss);
# Find gamma assuming investing as if full sibling inbreeding
gamzfsib <- function(rvl,betas,mmin=1,c=1){
    mvl <- rep(0,length(betas));
    gam <- rep(0,length(betas));
    for(i in 1:length(bss)){
        mvl[i] <- findm(low.guess=0,high.guess=10,rval=0.5,mmin=1,Beta=betas[i],c=1);
        gam[i] <- OffATr(r=rvl, m=mvl[i], mmin=1, Beta=betas[i], c=1) / mvl[i];
    }
    return(list(mvl=mvl,gam=gam));
}
rg000fs <- gamzfsib(rvl=0.000,betas=bss);
rg125fs <- gamzfsib(rvl=0.125,betas=bss);
rg250fs <- gamzfsib(rvl=0.250,betas=bss);
rg500fs <- gamzfsib(rvl=0.500,betas=bss);
#--- Start building the figure below
par(mfrow=c(2,1),mar=c(0.25,1,4,1),oma=c(5,5,1,1),lwd=2);
#----------------------------------------------------------------
#par(mar=c(0.5,1,0.25,1),lwd=2);
plot(x=bss,y=rg000$gam,type="l",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     ylab="",xaxt="n",cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.10,0.15,0.20),cex.axis=1.5);
points(x=bss,y=rg125$gam,type="l",lwd=2);
points(x=bss,y=rg250$gam,type="l",lwd=2);
points(x=bss,y=rg500$gam,type="l",lwd=2);
text(x=bss[18],y=rg000$gam[18]+0.0038,labels="r=0",srt=-0,cex=0.8);
text(x=bss[18],y=rg125$gam[18]+0.0038,labels="r=1/8",srt=-7,cex=0.8);
text(x=bss[18],y=rg250$gam[18]+0.0038,labels="r=1/4",srt=-9,cex=0.8);
text(x=bss[18],y=rg500$gam[18]+0.0038,labels="r=1/2",srt=-12,cex=0.8);
text(x=4.95,y=0.213,labels="A",cex=2.5);
#----------------------------------------------------------------
par(mar=c(4,1,0.25,1),lwd=2);
plot(x=bss,y=rg000nk$gam,type="l",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab=expression(paste("Inbreeding depression (",beta,")")),
     cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.10,0.15,0.20),cex.axis=1.5);
points(x=bss,y=rg125nk$gam,type="l",lwd=2);
points(x=bss,y=rg250nk$gam,type="l",lwd=2);
points(x=bss,y=rg500nk$gam,type="l",lwd=2);
text(x=bss[12],y=rg000nk$gam[12]+0.004,labels="r=0",srt=-0,cex=0.8);
text(x=bss[10],y=rg125nk$gam[10]+0.005,labels="r=1/8",srt=-16,cex=0.8);
text(x=bss[7],y=rg250nk$gam[7]+0.005,labels="r=1/4",srt=-40,cex=0.8);
text(x=bss[4]+0.075,y=rg500nk$gam[4]+0.002,labels="r=1/2",srt=-65,cex=0.8);
text(x=4.95,y=0.213,labels="B",cex=2.5);
mtext(text=expression(paste("Rate of fitness increase (",gamma,")")),
      side=2,line=3, cex=1.5, col="black", outer=TRUE);
#----------------------------------------------------------------
# Next, the below generates a function to find where lines intersect
# Finds the beta at which a particular r value intersects r=0 for fitness
findbeta <- function(high.guess,rval,m=FALSE,mmin=1,c=1){
    low.guess <- 0;
    outbr <- findm(low.guess=0,high.guess=10,rval=0,mmin=mmin,Beta=0,c=c);
    outgm <- OffATr(r=0,m=outbr,mmin=mmin,Beta=0,c=c) / outbr;
    if(m == FALSE){ # If we're not constraining m
        check  <- 1;
        bguess <- 0.5 * high.guess;
        i      <- 0;
        l      <- low.guess
        u      <- high.guess;
        while(abs(check) > 0.000001 & i < 1000000){
            mst   <- findm(low.guess=0,high.guess=10,rval=rval,mmin=mmin,Beta=bguess,c=c);
            gam   <- OffATr(r=rval,m=mst,mmin=mmin,Beta=bguess,c=c) / mst;
            check <- gam - outgm;
            if(check < 0){
                u      <- bguess;
                bguess <- 0.5*(l+bguess); 
            }else{
                l      <- bguess;
                bguess <- 0.5*(u+bguess);
            }
            i <- i+1;
        }
    }else{ #If we are forcing m to a particular value
        check  <- 1;
        bguess <- 0.5 * high.guess;
        i      <- 0;
        l      <- low.guess
        u      <- high.guess;
        while(abs(check) > 0.000001 & i < 1000000){
            gam   <- OffATr(r=rval,m=m,mmin=mmin,Beta=bguess,c=c) / m;
            check <- gam - outgm;
            if(check < 0){
                u      <- bguess;
                bguess <- 0.5*(l+bguess); 
            }else{
                l      <- bguess;
                bguess <- 0.5*(u+bguess);
            }
            i <- i+1;
        }
    }   
    return(bguess);
}

```

Assuming that individuals allocate PI optimally, their $\gamma^{*}$ values can be compared across different degrees of inbreeding $r$ and inbreeding depression $\beta$. In the example comparing $r=0$ and $r=1/2$ when $\beta=1$, inbreeding increases fitness more than outbreeding when both individuals invest optimally ($\gamma^{*}_{r=1/2}>\gamma^{*}_{r=0}$). This can also be confirmed by reducing our model to the results of established biparental inbreeding models (see Appendix 3). If, however, $\beta=3$ instead of $\beta=1$, then $\gamma^{*}_{r=0}=$ `r round(r00g.b3,digits=3)` and $\gamma^{*}_{r=1/2}=$ `r round(r05g.b3,digits=3)`. Given this higher inbreeding depression, outbreeders will therefore have higher fitness than individuals that inbreed with first order relatives. Figure 2A shows more generally how $\gamma^{*}$ changes with $\beta$ and $r$ given optimal PI. Across all $\beta$, the highest $\gamma^{*}$ occurs either when $r=1/2$ ($\beta <$ `r round(findbeta(high.guess=5,rval=0.5),digits=3)`) or $r=0$ ($\beta >$ `r round(findbeta(high.guess=5,rval=0.5),digits=3)`), and never for intermediate values of $r$. If parents are capable of investing optimally, it is therefore beneficial to either maximise or minimise inbreeding, depending on the magnitude of inbreeding depression.

In finding $m^{*}$ and $\gamma^{*}$, we identify how selection will act on PI and inbreeding, but in some populations, individuals might be unable to discriminate between relatives and non-relatives, and hence unable to adjust their PI when inbreeding. We therefore consider the fitness consequences when parents cannot adjust their PI when inbreeding, and therefore $\gamma < \gamma^{*}$. Figure 2B shows $\gamma$ values for inbreeding parents when they invest at the relatively low optimum $m^{*}$ under outbreeding. When inbreeding parents allocate PI as if they are outbreeding, $\gamma$ always decreases, and this fitness decrease becomes more severe with increasing $r$. While the fitness of a parent that inbreeds with a first order relative ($r=1/2$) exceeds that of an outbreeding parent when $\beta <$ `r round(findbeta(high.guess=5,rval=0.5),digits=3)`, if the inbreeding parent invests at the outbreeding parent's optimum, then its fitness is higher only when $\beta <$ `r round(findbeta(high.guess=5,rval=0.5,m=r00m),digits=3)`. Consequently, if parents are unable to recognise that they are inbreeding and adjust their PI accordingly, their fitness might be decreased severely relative to optimally investing parents.


Effects of biparental investment
------------------------------------------------

```{r, echo=FALSE}
# New equations needed to present the results below
fpair <- expression(0.5*(1+r)*(1-exp(-c*(m-mmin-Beta*r))) - 
                        (r/2)*(1-exp(-c*(z-mmin))),'m');
fpaird <- D(fpair,'m'); # can print fmd to show solution
Offpair <- function(r, m, mmin=1, Beta=1, c=1, m0=r00m){
    direct   <- (1/2)*(1+r) * (1 - exp(-c*(m - mmin - Beta*r)) );
    indirect <- (r/2)*(1-exp(-c*(r00m-mmin)));
    return( direct - indirect);
}
findmpair <- function(low.guess,high.guess,rval,mmin=1,Beta=1,c=1,m0=r00m){
    # Note that derivative of zeta has not changed, only the original f
    fm  <- function(m,r=rval){ 
        OffATrd(r=rval, mmin=mmin, Beta=Beta, m=m, c=c)*(0-m) + 
            Offpair(r=rval, mmin=mmin, Beta=Beta, m=m, c=c, m0=m0);
    }
    lg  <- fm(m=low.guess, r=rval);
    hg  <- fm(m=high.guess,r=rval);
    if(lg > 0){
        u <- low.guess;
        l <- high.guess;
    }else{
        u <- high.guess;
        l <- low.guess;
    }
    if((fm(l) > 0 & fm(u) > 0) | (fm(l) < 0 & fm(u) < 0)){
        return("Value of m is outside the range");
    }else{
        check  <- 1;
        mguess <- 0.5 * (l+u);
        i      <- 0;
        while(abs(check) > 0.000001 & i < 1000000){
            check <- fm(r=rval, m=mguess);
            if(check > 0){
                u      <- mguess;
                mguess <- 0.5*(l+mguess); 
            }else{
                l      <- mguess;
                mguess <- 0.5*(u+mguess);
            }
            i <- i+1;
        }
        return(mguess);
    }
} # Running the below returns the
r05mpB0 <- findmpair(low.guess=0,high.gues=10,rval=0.5,Beta=0);
r05gpB0 <- Offpair(r=0.5, m=r05mpB0, mmin=1, Beta=0, c=1, m0=r00m) / r05mpB0;
r05mpB1 <- findmpair(low.guess=0,high.gues=10,rval=0.5,Beta=1);
r05gpB1 <- Offpair(r=0.5, m=r05mpB1, mmin=1, Beta=1, c=1, m0=r00m) / r05mpB1;

```

We have assumed that only one parent provides PI. We now consider the opposite extreme in which PI is provided by both parents, which pair exactly once in life and therefore have completely overlapping fitness interests [i.e., strict monogamy; see @Parker1985]. Given outbreeding, $m^{*}$ will remain unchanged with twice as many offspring produced due to a doubled investment budget $2M$ [@Parker1985]. However, $m^{*}$ will change if monogamous parents are related because a male is by definition precluded from mating with another female, and therefore pays a complete opportunity cost for inbreeding [@Waser1986]. A focal female will thereby lose any indirect fitness increment that she would have otherwise received from having her related mate also breed with other females. To incorporate this cost, it is now necessary to consider both the direct and indirect fitness consequences of inbreeding explicitly. We assume that if a focal female avoids inbreeding, her male relative will instead outbreed, and that parents invest optimally for any given $\beta$; we define $m^{*}_{0}$ as optimal investment for outbreeding and $m^{*}_{r}$ as optimal investment for inbreeding to the degree $r$. Therefore, if a focal female avoids inbreeding,

(@optPI) $$\zeta_{\textrm{off}} = \frac{1}{2}\left(1-e^{-c\left(m^{*}_{0}-m_{min}\right)}\right).$$ 

Assuming that $c=1$ and $m_{min}=1$, $m^{*}_{0}=$ `r round(r00m,digits=3)`. If she instead inbreeds,

(@optPIoc) $$\zeta_{\textrm{off}} = \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m^{*}_{r}-m_{min}-\beta r\right)}\right) - \frac{r}{2}\left(1-e^{-c\left(m^{*}_{0}-m_{min}\right)}\right).$$ 

The first term of Eq. @optPIoc represents the fitness increment the focal female receives from inbreeding (as is identical to the right-hand side of Eq. @maineq), while the second term represents the indirect loss of fitness that she would have otherwise received through her relative had she not mated with him. The decrease in $\zeta_{\textrm{off}}(m_{r})$ caused by this fitness loss causes an overall increase in $m^{*}_{r}$. Monogamous parents should therefore each invest even more per offspring when inbreeding than when only females provide PI, assuming a male could have otherwise outbred. For example, if $r=1/2$ and $\beta=1$, $m^{*}_{r}=$ `r round(r05mpB1,digits=3)` given strict monogamy, instead of `r round(r05m,digits=3)` when only females provide PI.  However, while $\gamma^{*}_{r=1/2}=$ `r round(r05g,digits=3)` given single parent PI, $\gamma^{*}_{r=1/2}=$ `r round(r05gpB1,digits=3)` given strict monogamy, and is therefore less than the fitness increase from outbreeding, $\gamma^{*}_{r=0}=$ `r round(r00g,digits=3)`. Across all values of $\beta$, in fact, $\gamma^{*}_{r=1/2} < \gamma^{*}_{r=0}$ given strict monogamy, meaning that the rate of fitness increase from inbreeding never exceeds outbreeding.

```{r, echo=FALSE, fig.width = 6*figscale, fig.height = 8*figscale, fig.cap="Assuming strict monogamy, the (A) relationship between parental investment and the proportion of a focal female's identical-by-descent alleles that are are carried in its offspring for females that outbreed (solid curve) and females that inbreed with first order relatives (dashed curve). Tangent lines identify optimal parental investment, and their slopes define a female's rate of fitness increase when outbreeding (solid line) and inbreeding (dashed line). Dotted horizontal line shows zero on the y-axis. (B) Relationship between the magnitude of inbreeding depression and optimal parental investment across four degrees of relatedness between a focal female and her mate."}
#---------------- Some general patterns now plotted
bss <- seq(from=0.5,to=5,by=0.25);
gamzp <- function(rvl,betas,mmin=1,c=1,m0=r00m){
    mvl <- rep(0,length(betas));
    gam <- rep(0,length(betas));
    for(i in 1:length(bss)){
        mvl[i] <- findmpair(low.guess=0,high.guess=10,rval=rvl,
                            mmin=1,Beta=betas[i],c=1,m0=r00m);
        gam[i] <- Offpair(r=rvl,m=mvl[i],mmin=1,Beta=betas[i],c=1,m0=m0) / mvl[i];
    }
    return(list(mvl=mvl,gam=gam));
}
rg000p <- gamzp(rvl=0.000,betas=bss);
rg125p <- gamzp(rvl=0.125,betas=bss);
rg250p <- gamzp(rvl=0.250,betas=bss);
rg500p <- gamzp(rvl=0.500,betas=bss);
#----------------------------------------------------------------
Alleles_IBD_outbr_pair <- Offpair(r=0.0, m=PI, mmin=1, Beta=1, c=1);
Alleles_IBD_inbr_pair  <- Offpair(r=0.5, m=PI, mmin=1, Beta=1, c=1);
#-----------------------------------------
par(mfrow=c(2,1),mar=c(5,5,1,1),lwd=2);
layout(matrix(data=c(1,2), nrow=2, ncol=1, byrow = TRUE),
       widths=c(1,1), heights=c(1,1));
# --------------------------------------------------------------------
plot(PI,Alleles_IBD_outbr_pair,type="l",lwd=3,ylim=c(0,1),yaxs="i",xaxs="i",
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(h=0,lty="dotted",lwd=0.8);
points(PI,Alleles_IBD_inbr_pair,type="l",lwd=3,lty="dashed");
abline(a=0,b=r00g,lty="solid", lwd=1); # Tangent line r = 0
abline(a=0,b=r05gpB1,lty="dashed",lwd=1); # Tangent line r = 0.5
text(x=0.15,y=0.925,labels="A",cex=2.5);
# --------------------------------------------------------------------
plot(x=bss,y=rg000$mvl,type="l",lwd=2,ylim=c(2,6),pch=1.5,
     xlab=expression(paste("Inbreeding depression (",beta,")")),
     ylab=expression(paste("Optimum PI (",italic(m),"*)")),
     cex.lab=1.5,cex.axis=1.5);
points(x=bss,y=rg125$mvl,type="l",lwd=2);
points(x=bss,y=rg250$mvl,type="l",lwd=2);
points(x=bss,y=rg500$mvl,type="l",lwd=2);
text(x=bss[17],y=rg000$mvl[17]+0.17,labels="r=0",srt=-0,cex=1.15);
text(x=bss[17],y=rg125$mvl[17]+0.17,labels="r=1/8",srt=6,cex=1.15);
text(x=bss[17],y=rg250$mvl[17]+0.17,labels="r=1/4",srt=12.5,cex=1.15);
text(x=bss[17],y=rg500$mvl[17]+0.17,labels="r=1/2",srt=18,cex=1.15);
text(x=0.5,y=5.85,labels="B",cex=2.5);

```

Figure 3A shows how $\zeta_{\textrm{off}}$ increases as a function of $m$ given $r=0$ (solid curve) and $r=1/2$ (dashed curve) when parents are strictly monogamous and invest equally in offspring, as compared to single parent investment for identical parameter values shown in Fig. 1A. In contrast to single parent investment, $\gamma^{*}_{r=1/2}$ (slope of the dashed line) is now lower when $r=1/2$ than when $r=0$, meaning that the fitness of individuals that inbreed with first order relatives is lower than individuals that outbreed given strict monogamy. Figure 3B shows $m^{*}$ for two strictly monogamous parents across different values of $r$ and $\beta$. In comparison with single parent investment in Fig. 1B, $m^{*}$ is always slightly higher given strict monogamy if $r>0$ (Fig. 3B), but in both cases $m^{*}$ increases with increasing $r$ and $\beta$. 

Figure 4A shows $\gamma$ across multiple $\beta$ values given that monogamous parents invest optimally (4A) and invest at an optimum PI for outbreeding (4B). In contrast to single parent investment illustrated in Fig. 2A, $\gamma^{*}$ is always maximised by $r=0$, meaning that inbreeding never increases fitness. Fitness decreases even further when inbreeding individuals allocate PI at $m^{*}$ for outbreeding (compare Figs 2B and 4B; see Supporting Information S3 for $\gamma$ values across $\beta$ and $r$ assuming parents invest at different $m^{*}_{r}$). Universally decreasing $\gamma$ with increasing $r$ is consistent with biparental inbreeding theory, which demonstrates that if inbreeding with a female completely precludes a male from outbreeding, inbreeding will never be beneficial [@Waser1986; @Duthie2015a]. However, if relatives are forced to pair under strict monogamy, each should invest more per offspring than given single parent investment.

```{r, echo=FALSE, fig.width = 6*figscale, fig.height = 8*figscale, fig.cap="Assuming strict monogamy, the relationship between the magnitude of inbreeding depression and the rate of a focal female's fitness increase across four degrees of relatedness between a focal female and her mate given that (A) focal females invest optimally given their degree of inbreeding, and (B) females invest at the optimum for outbreeding."}
#--- Start building the figure below
par(mfrow=c(2,1),mar=c(0.25,1,4,1),oma=c(5,5,1,1),lwd=2);
#----------------------------------------------------------------
plot(x=bss,y=rg000p$gam,type="l",lwd=2,ylim=c(0.05,0.18),pch=1.5,yaxt="n",
     xlab=expression(paste("Inbreeding depression (",beta,")")),xaxt="n",
     ylab="",cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.05,0.10,0.15,0.20),cex.axis=1.5);
points(x=bss,y=rg125p$gam,type="l",lwd=2);
points(x=bss,y=rg250p$gam,type="l",lwd=2);
points(x=bss,y=rg500p$gam,type="l",lwd=2);
text(x=bss[17],y=rg000p$gam[17]+0.005,labels="r=0",srt=-0,cex=1);
text(x=bss[17],y=rg125p$gam[17]+0.005,labels="r=1/8",srt=-4,cex=1);
text(x=bss[17],y=rg250p$gam[17]+0.005,labels="r=1/4",srt=-6,cex=1);
text(x=bss[17],y=rg500p$gam[17]+0.005,labels="r=1/2",srt=-8,cex=1);
text(x=4.95,y=0.174,labels="A",cex=2.5);
#----------------------------------------------------------------
par(mar=c(4,1,0.25,1),lwd=2);
r000_000pt <- Offpair(r=0.000, m=r00m, mmin=1, Beta=bss, c=1, m0=r00m) / r00m;
r125_000pt <- Offpair(r=0.125, m=r00m, mmin=1, Beta=bss, c=1, m0=r00m) / r00m;
r250_000pt <- Offpair(r=0.250, m=r00m, mmin=1, Beta=bss, c=1, m0=r00m) / r00m;
r500_000pt <- Offpair(r=0.500, m=r00m, mmin=1, Beta=bss, c=1, m0=r00m) / r00m;
plot(x=bss,y=r000_000pt,type="l",lwd=2,ylim=c(0.05,0.18),pch=1.5,yaxt="n",
     xlab=expression(paste("Inbreeding depression (",beta,")")),
     ylab="",cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.05,0.10,0.15,0.20),cex.axis=1.5);
points(x=bss,y=r125_000pt,type="l",lwd=2);
points(x=bss,y=r250_000pt,type="l",lwd=2);
points(x=bss,y=r500_000pt,type="l",lwd=2);
text(x=bss[12],y=r000_000pt[12]+0.005,labels="r=0",srt=-0,cex=1);
text(x=bss[10],y=r125_000pt[10]+0.005,labels="r=1/8",srt=-15,cex=1);
text(x=bss[7],y=r250_000pt[7]+0.005,labels="r=1/4",srt=-34,cex=1);
text(x=bss[4]+0.06,y=r500_000pt[4]+0.004,labels="r=1/2",srt=-65,cex=1);
text(x=4.95,y=0.174,labels="B",cex=2.5);
#----------------------------------------------------------------
mtext(text=expression(paste("Rate of fitness increase (",gamma,")")),
      side=2,line=2, cex=1.5, col="black",outer=TRUE);
```


Investment and fitness of an inbred parent
------------------------------------------------

We have assumed that parents are themselves outbred, but this is unrealistic for populations in which inbreeding is expected to occur [@Duthie2015a]. We therefore consider how the degree to which a focal female is inbred will affect her optimum parental care ($m^{*}$) and rate of increase in fitness ($\gamma^{*}$).

To account for an inbred parent, it is most useful to decompose the coefficient of relatedness $r$ into two parts [see @Hamilton1972; @Michod1979]. The first is the constituent coefficient of kinship $k$, which is the probability that a two randomly sampled homologous alleles between the focal female and her mate are identical-by-descent. The second is the focal female's own inbreeding coefficient $f$, which is the probability that two homologous alleles within the focal female herself are identical-by-descent. The coefficient $r$ can be defined as such,

(@rdef) $$ r = \frac{2k}{1 + f}. $$

Because inbreeding depression is widely assumed to be caused by the pairing of deleterious recessive alleles [@Charlesworth2009], the value of $k$ is relevant for modelling inbreeding depression (and in fact defines an offspring's $f$). In contrast, $f$ does not directly affect the degree to which homologous deleterious recessive alleles from two different parents will pair in inbred offspring, and therefore does not contribute to inbreeding depression. To understand how $\zeta_{\textrm{off}}$ is affected by $f$ and $k$, and thereby relax the assumption that a focal female is outbred, we redefine Eq @maineq,

(@maineqr) $$\zeta_{\textrm{off}} = \frac{1}{2}\left(1+\frac{2k}{1+f}\right)\left(1-e^{-c\left(m-m_{min}-2\beta k\right)}\right).$$

Note that if $f=0$ (the focal female is outbred), then Eq. @maineqr reduces to Eq. @maineq because $r=2k$. Because the $f$ of a focal parent does not affect inbreeding depression in its offspring, and instead only affects the fitness increment $1/2\left(1+ 2 k / \left[1 + f\right]\right)$, $m^{*}$ is unaffected (see also Appendix 2). The degree to which a female is herself inbred should therefore not affect optimal PI.

```{r, echo=FALSE}
OffATf <- function(f, k, m, B0=1, B1=1, c=1){
    return( (1/2)*(1+(2*k/(1+f))) * (1 - exp(-c*(m - B0 - 2*B1*k)) ));
}
findmf <- function(low.guess,high.guess,kval,fval,B1=1,c=1,B0=1){
  OffATf <- function(m, f=fval, k=kval, B0=1, B1=1, c=1){
    return( (1/2)*(1+(2*k/(1+f))) * (1 - exp(-c*(m - B0 - 2*B1*k)) ));
  }
  OffATff <- function(m, k=kval, f=fval, B0=1, B1=1, c=1){
    return( 0.5 * (1 + (2 * k/(f + 1))) * (exp(-c * (m - B0 - 2 * B1 * k)) * c) );
  }    
  fm <- function(m, f=fval, k=kval, B0=1, B1=1, c=1){
    OffATff(m=m, f=fval, k=kval, B0=B0, B1=B1, c=c)*(0-m) + 
          OffATf(m=m, f=fval, k=kval, B0=B0, B1=B1, c=c);
  }
  lg  <- fm(m=low.guess, k=kval, f=fval);
  hg  <- fm(m=high.guess,k=kval, f=fval);
  if(lg > 0){
    u <- low.guess;
    l <- high.guess;
  }else{
    u <- high.guess;
    l <- low.guess;
  }
  if((fm(l) > 0 & fm(u) > 0) | (fm(l) < 0 & fm(u) < 0)){
    return("Value of m is outside the range");
  }else{
    check  <- 1;
    mguess <- 0.5 * (l+u);
    i      <- 0;
    while(abs(check) > 0.001 & i < 10000){
        check <- fm(k=kval, f=fval, m=mguess);
        if(check > 0){
          u      <- mguess;
          mguess <- 0.5*(l+mguess); 
        }else{
          l      <- mguess;
          mguess <- 0.5*(u+mguess);
        }
        i <- i+1;
    }
    return(mguess);
  }
} # Running the below returns the estimate
imopt.f000 <- findmf(low.guess=0,high.guess=4,kval=0.25,fval=0.0, B1=1);
imopt.f025 <- findmf(low.guess=0,high.guess=4,kval=0.25,fval=0.25, B1=1);
itang.f000 <- OffATf(m=imopt.f000, f=0, k=0.25, B0=1, B1=1, c=1) / imopt.f000;
itang.f025 <- OffATf(m=imopt.f025, f=0.25, k=0.25, B0=1, B1=1, c=1) / imopt.f025;
omopt.f000 <- findmf(low.guess=0,high.guess=4,kval=0.0,fval=0.0, B1=1);
omopt.f025 <- findmf(low.guess=0,high.guess=4,kval=0.0,fval=0.25, B1=1);
otang.f000 <- OffATf(m=omopt.f000, f=0, k=0.0, B0=1, B1=1, c=1) / omopt.f000;
otang.f025 <- OffATf(m=omopt.f025, f=0.25, k=0.0, B0=1, B1=1, c=1) / omopt.f025;
```

```{r, echo=FALSE, fig.cap="Relationship between parental investment and the proportion of a focal female's identical-by-descent alleles that are are carried in its offspring for females that are outbred (upper curve) versus females that are inbred (lower curve). Grey shading between curves shows the fitness difference between outbred and inbred females across different degrees of parental invesment."}
Alleles_IBD_f000 <- OffATf(k=0.25, f=0.0, m=PI, B0=1, B1=1, c=1);
par(mar=c(5,5,2,2));
plot(PI,Alleles_IBD_f000,type="l",lwd=1,ylim=c(0,0.95),lty="solid",
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5,yaxs="i",xaxs="i");
abline(h=0,lty="dotted",lwd=0.8);
Alleles_IBD_f025 <- OffATf(k=0.25, f=0.25, m=PI, B0=1, B1=1, c=1);
abline(b=itang.f000,a=0,lty="solid",lwd=0.5,col="grey40");
abline(b=itang.f025,a=0,lty="solid",lwd=0.5,col="grey40");
polygon(x=c(PI,rev(PI)),y=c(Alleles_IBD_f000,rev(Alleles_IBD_f025)),col="grey70",border=NA);
points(PI,Alleles_IBD_f025,type="l",lwd=1,col="black",lty="solid");
points(PI,Alleles_IBD_f000,type="l",lwd=1,col="black",lty="solid");
yof000 <- OffATf(k=0.25, f=0.0,  m=imopt.f000, B0=1, B1=1, c=1);
yof025 <- OffATf(k=0.25, f=0.25, m=imopt.f025, B0=1, B1=1, c=1);
xline  <- seq(from=1,to=imopt.f000,by=0.001);
points(x=xline,y=rep(yof000,length(xline)),type="l",lwd=1);
points(x=xline,y=rep(yof025,length(xline)),type="l",lwd=1);
yline  <- seq(from=0,to=yof025,by=0.001);
points(x=rep(imopt.f025,length(yline)),y=yline,type="l",lwd=1);
text(x=3.5,y=0.255,labels=expression(paste(italic(m^{"*"}))),cex=1.75);
arrows(x0=3.345,y0=0.205,x1=imopt.f025+0.04,y1=0.01,length = 0.15,angle=30,code=2,lwd=2);
text(x=0.75,y=0.8,labels=expression(paste(italic(f==0))),cex=1.25);
arrows(x0=0.8,y0=0.75,x1=1.1,y1=yof000+0.01,length = 0.15,angle=30,code=2,lwd=2);
text(x=0.67,y=0.35,labels=expression(paste(italic(f==frac(1,4)))),cex=1.25);
arrows(x0=0.87,y0=0.36,x1=1.1,y1=yof025-0.01,length = 0.15,angle=30,code=2,lwd=2);
```

Further, the degree to which a female is inbred should only slightly affect $\gamma^{*}$, and only if $k>0$. If $k=0$, then $\gamma^{*}$ is unaffected because there is no inbreeding depression, so $\gamma^{*}=$ `r round(otang.f025,digits=3)` for all values of $f$ given the previously considered $\beta=1$, $m_{min}=1$, and $c=1$. If instead $k=1/4$ (inbreeding between first order relatives) and $f=1/4$ (the female is the offspring of first order relatives), then a slight decrease in $\gamma^{*}$ is predicted. If $k=1/4$ and $f=1/4$, then $\gamma^{*}=$ `r round(itang.f025,digits=3)`, versus $\gamma^{*}=$ `r round(itang.f000,digits=3)` given $f=0$. The difference between these two curves predicting $\zeta_{\textrm{off}}(m)$ for $f=0$ and $f=1/4$ given $k=1/4$ is shown in Fig. 5. The bottom curve of Fig. 5 shows $\zeta_{\textrm{off}}(m)$ given $f=1/4$, and the top curve shows $\zeta_{\textrm{off}}(m)$ given $f=0$, with the difference between $\zeta_{\textrm{off}}(m)$ represented by grey shading. Where $m=m^{*}$, $\zeta_{\textrm{off}}$ is slightly higher for $f=0$, meaning that $\gamma^{*}$ (here, technically, identical-by-descent alleles carried by offspring scaled by their frequency within the parent) is higher for outbred individuals even though optimal investment per offspring has not changed ($m^{*}_{f=0}=m^{*}_{f=1/4}$). Thin grey lines in the figure show tangent lines for each curve. Overall, Fig 5 shows a weak effect on $\gamma^{*}$ across a relatively wide range of $f$ (outbred individuals versus individuals of full sibling matings). Consequently, the degree to which an individual is inbred will have a relatively minor effect on its rate of fitness increase, but no effect on the optimal PI it provides to offspring.

******************************

Discussion
===================================================

We have synthesised biparental inbreeding theory and parental investment theory, showing that biparental inbreeding can alter optimal PI, thereby affecting parent and offspring fitness. Specifically, we have shown that when offspring are inbred, the optimal PI provided by a parent should always increase, and this increase in optimal PI should be greatest when inbreeding depression is high. We have also shown that, in contrast to outbreeding [@Parker1985], optimal PI changes when both parents invest given strict monogamy as opposed to single PI; under such conditions, optimal PI increases, but the fitness of inbreeding parents never exceeds that of outbreeding parents. Finally, we have shown that optimal PI does not change when a focal female is herself inbred, but her fitness, defined in as the rate at which she increases copies of her identical-by-descent alleles, is decreased. This theory has potentially widespread empirical implications, and extensions of our model can further inform theory on the interaction between inbreeding and parental investment.

Multiple studies estimate magnitudes of inbreeding depression in offspring fitness [@Charlesworth2009; @Szulkin2012], but predicting how the effects of inbreeding depression in offspring in turn affect parent fitness and subsequent evolution of behaviour remains empirically challenging [@Reid2015b]. Further, because PI might encompass a range of behaviours, each of which is an instance of allocation from an unknown total PI budget, PI is notoriously difficult to measure [@Parker2002]. One approach is to vary PI experimentally by excluding a parent during offspring development. @Pilakouta2015 quantified the fitness of burying beetle (*Nicrophorus vespilloides*) offspring in the presence and absence of maternal care, and for inbred and outbred offspring, finding that maternal care increased survival relatively more for inbred than outbred offspring. Their result is consistent with our assumption that PI can mitigate inbreeding depression and thereby buffer offspring fitness.  Similarly, in the subsocial spider *Anelosimus* cf. *jucundus*, in which care is provided by solitary females, @Aviles2006 found evidence of inbreeding depression only late in life when parental care was absent. They also hypothesise that maternal care might buffer inbreeding depression. Interestingly, clutch size does not decrease when *A.* cf. *jucundus* females inbreed as our model predicts, and as would be expected if females respond to inbreeding by increasing PI per offspring at the cost of total offspring production. In the European earwig (*Forficula auricularia*), @Meunier2013 also found no evidence that clutch size decreased with inbreeding, nor that parental care buffers inbreeding depression. It is possible that the ability of parents to adjust PI based on inbreeding might be precluded in such systems if kin recognition is limited, potentially resulting in severe fitness costs if parents cannot adjust PI with inbreeding (Fig. 2B). Empirical tests of our model might therefore be most applicable to species that are known to vary their behaviour with respect to relatedness.

Adjustment of PI with inbreeding is most likely to occur in social species, where interactions among relatives strongly affect fitness, and for species in which realised inbreeding typically varies and inbreeding strategies are therefore potentially under selection. For example, wolves are highly social (and generally monogamous), and individuals may inbreed to varying degrees with potentially severe inbreeding depression in offspring [@Raikkonen2009; @Geffen2011]. To our knowledge, no empirical studies have tested whether or not PI varies with inbreeding in wolves, but two studies found a strong negative correlation between parent inbreeding and the number of pups per litter [e.g, @Liberg2005; @Fredrickson2007]. In both studies, decreased reproductive output is interpreted as a negative fitness consequence of inbreeding, as might be expected if inbreeding depression causes increased early offspring mortality. Our model suggests an alternative hypothesis; fewer pups per litter might be partially driven by an adaptive strategy whereby parents invest more in fewer total offspring. Distinguishing between inbreeding depression and adjusted PI will require careful observation of variation in PI in wild populations, but our model demonstrates that reduced reproductive output cannot necessarily be assumed to be a negative fitness consequence of inbreeding.

Similarly, just because reproductive output does not vary with inbreeding, it cannot necessarily be assumed that fitness does not vary. Recently, Reid et al. (*in press*) showed that parent-offspring relatedness varies in a wild population of song sparrows (*Melospiza melodia*) as a consequence of inbreeding, and suggest that parent fitness is more accurately reflected by identical-by-descent allele copies expected within offspring rather than total offspring production. A female that produces an outbred brood might therefore have lower fitness than a female that produces an inbred brood of the same (or slightly smaller) size, assuming the fitness of inbred offspring is not sufficiently decreased. Interestingly, if brood size is externally fixed, females that have large total resource budgets ($M$ in our model) might benefit by inbreeding if they are able to allocate more PI to each of their offspring. To quantify parent fitness and predict inbreeding strategy, it might therefore be necessary to consider inbreeding and reproductive output in the context of PI.

Interactions over PI are characterised by intrafamilial conflict between parents, parents and offspring, and among siblings [@Parker2002]. We have largely ignored such conflict to instead establish a theoretical framework for understanding PI in the context of inbreeding. We assumed that only females provide PI, or that the fitness interests of females and males are perfectly aligned due to strict monogamy, so that no sexual conflict occurs. If both parents invest and are not completely monogamous, sexual conflict is predicted because each parent will increase its fitness if it invests less in a brood than its mate (e.g., by abandoning the brood early). Optimal PI can then be modelled as an evolutionary stable strategy [@Smith1977], and is expected to decrease for both parents as a consequence of sexual conflict [@Parker1985]. To account for inbreeding across mating systems, it is necessary to consider indirect effects of inclusive fitness caused by the reproduction of relatives, as we did in considering male mating opportunity costs. Indirect effects might minimise sexual conflict when PI is provided by both parents in non-monogamous species because any negative fitness consequence of reducing PI could be exacerbated through an indirect effect on a focal individual's related mate. 

Sexual conflict might also be minimised if a focal individual that decreases its PI must wait for another mate to become available. @Kokko2006 considered the fitness consequences of inbreeding and inbreeding avoidance under such conditions, modelling a waiting time between mate encounters, and a processing time following mating (interpreted as PI). @Kokko2006 found that inbreeding tolerance generally increased with increasing waiting time between mates, but was highly context-dependent with respect to processing time. However, processing time was a fixed parameter in @Kokko2006, meaning that individuals could not adjust PI as a consequence of inbreeding -- only their inbreeding as a consequence of pre-determined PI. It would be interesting to relax this assumption and allow for inbreeding depression to vary as a consequence of processing time under the framework of @Kokko2006. If PI could vary, individuals that inbreed might be expected to increase their time spent processing offspring before attempting to mate again.

Parent-offspring conflict is a focal theoretical interest of many models of PI [e.g., @Macnair1978; @Parker1978; @Parker1985; @DeJong2005]. We have assumed that parents control PI, and that offspring are unable to influence the extent to which PI is provided (e.g., through begging). Offspring are predicted to benefit at higher PI than parent optima [@Parker1978; @Parker2002], thereby generating conflict, but such conflict might be decreased in the case of inbreeding. Inbreeding parents are more closely related to their offspring than outbreeding parents, generating the increase in parents' optimal PI in our model; in the extreme case in which $r=1$ (self-fertilisation), no conflict over PI should exist. @DeJong2005 model PI conflict in the context of optimal seed mass from the perspective of parent plants and their seeds given varying rates of self-fertilisation, showing that conflict over seed mass decreases with increasing self-fertilisation rate. @DeJong2005 assume seed mass is under the control of seeds rather than parent plants, and find that a comparative analysis of seed size among closely related plant species generally supports this hypothesis. In general, the same principles of parent-offspring conflict are expected to apply for biparental inbreeding as in self-fertilisation. Parent-offspring conflict should decrease with increasing inbreeding, and reduced conflict might in turn affect offspring behaviour. For example, @Mattey2014 observed both increased parental care and decreased offspring begging in an experimental study of *N. vispilloides*. A reduction in begging behaviour is consistent with our model when inbreeding increases and parent-offspring fitness interests with respect to PI are more closely aligned.

We conclude that optimal PI is predicted to increase when parents inbreed, potentially buffering inbreeding depression, decreasing parent's reproductive output, and mitigating intrafamilial conflict. We suggest that future empirical and theoretical research will benefit by further considering how biparental inbreeding and PI are expected to interact to affect parent and offspring fitness. 

**************************


Appendix 1: Sample derivations of $m^{*}$ and $\gamma^{*}$
----------------------------------------------

In general, the equation for a line tangent to some function $f$ at the point $a$ is,

$$ y = f'\left(a\right)\left(x-a\right) + f\left(a\right). $$

In the above, $f'(a)$ is the first derivative of $f(a)$, and $y$ and $x$ define the point of interest through which the straight line will pass that is also tangent to $f(a)$. The original function that defines $\zeta_{\textrm{off}}$ is as follows,

$$\zeta_{\textrm{off}} = \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m-m_{min}-\beta r\right)}\right).$$

Differentiating $\zeta_{\textrm{off}}$ with respect to $m$, we have the following,

```{r, echo=FALSE}
fm <- expression(0.5*(1+r)*(1-exp(-c*(m-B0-B1*r))),'m');
fm1 <- D(fm,'m');
```

$$\frac{\partial \zeta_{\textrm{off}}}{\partial m} = \frac{c}{2} \left(1+r\right)e^{-c\left(m-m_{min}-\beta r\right)}. $$

Substituting $\zeta_{\textrm{off}}(m)$ and $\partial \zeta_{\textrm{off}} / \partial m$ and setting $y=0$ and $x=0$ (origin), we have the general equation, 

$$ 0 = \frac{c}{2} \left(1+r\right)e^{-c\left(m-m_{min}-\beta r\right)}\left(0-m\right) + \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m-m_{min}-\beta r\right)}\right). $$

```{r, echo=FALSE}
r00m.y <- OffATr(r=0,  m=r00m, mmin=1, Beta=1, c=1);
r05m.y <- OffATr(r=0.5, m=r05m, mmin=1, Beta=1, c=1);
```

A solution for $m^{*}$ can be obtained numerically for the example in which $m_{min}=1$, $\beta=1$, and $c=1$. If $r=0$, $m^{*}_{r=0}=$ `r round(r00m,digits=3)`, and if $r=1/2$, $m^{*}_{r=1/2}=$ `r round(r05m,digits=3)`. Solutions for the slopes defining $\gamma^{*}_{r=0}$ and $\gamma^{*}_{r=1/2}$ can be obtained by finding the straight line that runs through the two points $(0,0)$ and $(m^{*}$ , $\zeta_{\textrm{off}}(m^{*}))$. In the case of $r=0$, $\zeta_{\textrm{off}}(m^{*})=$ `r round(r00m.y,digits=3)`, so we find, $\gamma^{*}_{r=0}=$ (`r round(r00m.y,digits=3)` $- 0$) $/$ (`r round(r00m,digits=3)` $- 0$) = `r round(r00g,digits=3)`. In the case of $r=1/2$, $\zeta_{\textrm{off}}(m^{*})=$ `r round(r05m.y,digits=3)`, so we find, $\gamma^{*}_{r=1/2}=$ (`r round(r05m.y,digits=3)` $- 0$) $/$ (`r round(r05m,digits=3)` $- 0$) = `r round(r05g,digits=3)`. 

Appendix 2: $m^{*}$ increases with increasing $r$
----------------------------------------------

Here we show that optimal parental investment always increases with increasing inbreeding given inbreeding depression and $c>0$. Because we are only interested in the sign of this increase, it will be sufficient to show that $\partial r / \partial m^{*} > 0$ given $\beta>0$ and $c>0$. 

First, we note that $m^{*}$ is defined as the value of $m$ that maximises the rate of increase in $\zeta_{\textrm{off}}$ for a female. This is described by the line that passes through the origin and lies tangent to $\zeta_{\textrm{off}}(m)$. As in Appendix 1, we have the general equation for which $m=m^{*}$,

$$ 0 = \frac{c}{2} \left(1+r\right)e^{-c\left(m-m_{min}-\beta r\right)}\left(0-m\right) + \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m-m_{min}-\beta r\right)}\right). $$

We first substitute $m=m^{*}$ and note that this equation reduces to,

$$ 0 = c e^{-c\left(m^{*}-m_{min}-\beta r\right)}\left(0-m^{*}\right) + \left(1-e^{-c\left(m^{*}-m_{min}-\beta r\right)}\right). $$

This simplification dividing both sides of the equation by $(1/2)(1+r)$ has a biological interpretaion that is relevant to parental investment. Optimal parental investment does not depend directly on the uniform increase in $\zeta_{\textrm{off}}$ caused by $r$ in $(1/2)(1+r)$, the change in $m^{*}$ is only affected by $r$ insofar as $r$ affects offspring fitness directly through inbreeding depression. Ideally, we would isolate $m$ to find $\partial m^{*} / \partial r$, but this is not possible. Instead, the above equation can be simplified further to isolate $r$ and show that $\partial r / \partial m^{*} > 0$,

$$ 0 = -m^{*} c e^{-c\left(m^{*}-m_{min}-\beta r\right)} + 1-e^{-c\left(m^{*}-m_{min}-\beta r\right)} $$

$$ 1 = m^{*} c e^{-c\left(m^{*}-m_{min}-\beta r\right)} + e^{-c\left(m^{*}-m_{min}-\beta r\right)} $$

$$ 1 = e^{-c\left(m^{*}-m_{min}-\beta r\right)} \left(1 + m^{*} c\right) $$

$$ e^{-c\left(m^{*}-m_{min}-\beta r\right)} = \frac{1}{\left(1 + m^{*} c\right)} $$

$$ -c\left(m^{*}-m_{min}-\beta r\right) = \ln\left(\frac{1}{\left(1 + m^{*} c\right)}\right) $$

$$ m^{*}-m_{min}-\beta r = -\frac{1}{c}\ln\left(\frac{1}{\left(1 + m^{*} c\right)}\right) $$

$$ \beta r = m^{*} - m_{min} + \frac{1}{c}\ln\left(\frac{1}{\left(1 + m^{*} c\right)}\right) $$

$$ r = \frac{1}{\beta}\left(m^{*} - m_{min} + \frac{1}{c}\ln\left(\frac{1}{\left(1 + m^{*} c\right)}\right)\right) $$

We now differentiate $r$ with respect to $m^{*}$,

```{r, echo=FALSE}
rrmm  <- expression((1/beta)*(mopt-mmin+(1/c)*log(1/(mopt*c+1))),'mopt');
# We can use the above to differentiate fm wrt `m`
drdm <- D(rrmm,'mopt'); # can print fmd to show solution
# Note that drdm simplifies considerably from what R produces
```

$$ \frac{\partial r}{\partial m^{*}} = \frac{m^{*} c}{\beta \left(m^{*} c + 1\right)} $$

Given the above, $\partial r / \partial m^{*} > 0$ assuming $\beta>0$ (inbreeding depression), $c>0$ (offspring fitness increases with parental investment), and $m^{*}>0$ (optimum parental investment is positive). These assumptions are biologically realistic; we therefore conclude that the positive association between optimal parental investment ($m^{*}$) and inbreeding ($r$) is general. As inbreeding increases, so should optimal parental investment in offspring.

Appendix 3: Consistency with biparental inbreeding models
----------------------------------------------

It is trivial to show that a female that inbreeds with a first order relative ($r=1/2$) has a higher fitness than a female that outbreeds ($r=0$) given $m_{min}=1$, $\beta=1$, and $c=1$ at optimal values of $m^{*}_{r=1/2}$ and $m^{*}_{r=0}$. To do this, we define $\delta_{r}$ as follows,

$$ \delta_{r} = e^{-c(m^{*}_{r}-m_{min}-\beta r)}. $$

In biparental inbreeding models [e.g., @Kokko2006; @Parker2006; @Duthie2015a], it is assumed that $\delta_{r=0}=0$ for outbred offspring, but this is not the case in our model because $\delta_{r=0}$ will also depend on parental investment. Fitness from inbreeding to any degree $r$ can be determined by,

$$ W_{r} = \frac{n}{2}\left(1+r\right)\left(1-\delta_{r}\right). $$

By definition, $n = M/m$, so $n$ is the total number of offspring a female produces. Biparental inbreeding models assume that this value is constant, but $n$ will scale linearly with $m$ because females that invest more in each offspring (high $m$) will produce fewer total offspring (low $n$). To account for this, we can simply substitute $M/m$ for $n$ to scale for offspring produced,

$$ W_{r} = \frac{M}{2 m}\left(1+r\right)\left(1-\delta_{r}\right). $$

Fitness given $r=0$ and $r=1/2$, and $m^{*}_{r=0}$ and $m^{*}_{r=1/2}$, can be determined by substituting some constant value for $M$ (here for simplicity, assume $M=1$), as the magnitude of $n$ will not affect relative fitness differences. 

To show that inbreeding with first order relatives returns a higher fitness than outbreeding given the above conditions assumed in our model, we can simply use the above equation directly to compare the fitness given both $r=1/2$ and $r=0$, noting that $\delta_{r=1/2}=0.26$ and $\delta_{r=0}=0.32$ (note that $\delta_{r=1/2}<\delta_{r=0}$ because inbreeding parents are investing more in their offspring, $m^{*}_{r=1/2}=$ `r round(r05m,digits=3)` versus $m^{*}_{r=0}=$ `r round(r00m,digits=3)`). Consequently, we can use the above equation to show that the fitness gain of an optimally investing female that inbreeds with a first order relative is `r round((1/(r05m*2))*(1+0.5)*(1-exp(-1*(r05m - 1 -1*0.5))),digits=3)`, compared with `r round((1/(r00m*2))*(1+0.0)*(1-exp(-1*(r00m - 1 -1*0.0))),digits=3)` for the outbreeding female; these values are identical to our earlier calculated values of $\gamma^{*}_{r=1/2}$ and $\gamma^{*}_{r=0}$.


******************************

Supporting Information (S1)
----------------------------------------------

Suppose we assume that some amount of reduction in offspring fitness due to inbreeding cannot be mitigated by parental investment, $(1 - \Delta r)$, such that offspring fitness decreases linearly with increasing $\Delta$ and $r$ regardless of $m$. In this case, $\zeta_{\textrm{off}}$ is simply,

$$\zeta_{\textrm{off}} = \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m-m_{min}-\beta r\right)}\right) \left(1 - \Delta r\right).$$

Note that offspring fitness now decreases with $\Delta$, but $\Delta$ (by definition) is independent of $m$. A simple example illustrates how $\zeta_{\textrm{off}}$ and therefore $\gamma^{*}$ decreases with increasing $\Delta$, while $m^{*}$ remains unaffected. We return to the example in which $c=1$, $m_{min}=1$, $\beta=1$, and $r=1/2$ (inbreeding between first order relatives).

```{r, echo=FALSE}
fm  <- expression(0.5*(1+r) * (1 - exp(-c*(m-mmin-Beta*r))) * (1-r*Delta),'m');
# We can use the above to differentiate fm wrt `m`
fmd <- D(fm,'m'); # can print fmd to show solution
OffDelta <- function(r, m, mmin=1, Beta=1, c=1, Delta){
    return( 0.5*(1+r) * (1 - exp(-c*(m-mmin-Beta*r))) * (1-r*Delta) );
}
OffDeltad <- function(r, m, mmin=1, Beta=1, c=1, Delta){
    return( 0.5 * (1 + r) * (exp(-c * (m - mmin - Beta * r)) * c)*(1-r*Delta) );
}
findmDelta <- function(low.guess,high.guess,rval,mmin=1,Beta=1,c=1,Delta){
    fm  <- function(m,r=rval, DD=Delta){ 
        OffDeltad(r=rval, mmin=mmin, Beta=Beta, m=m, c=c, Delta=Delta)*(0-m) + 
            OffDelta(r=rval, mmin=mmin, Beta=Beta, m=m, c=c, Delta=Delta);
    }
    lg  <- fm(m=low.guess, r=rval, DD=Delta);
    hg  <- fm(m=high.guess,r=rval, DD=Delta);
    if(lg > 0){
        u <- low.guess;
        l <- high.guess;
    }else{
        u <- high.guess;
        l <- low.guess;
    }
    if((fm(l) > 0 & fm(u) > 0) | (fm(l) < 0 & fm(u) < 0)){
        return("Value of m is outside the range");
    }else{
        check  <- 1;
        mguess <- 0.5 * (l+u);
        i      <- 0;
        while(abs(check) > 0.000001 & i < 1000000){
            check <- fm(r=rval, m=mguess);
            if(check > 0){
                u      <- mguess;
                mguess <- 0.5*(l+mguess); 
            }else{
                l      <- mguess;
                mguess <- 0.5*(u+mguess);
            }
            i <- i+1;
        }
        return(mguess);
    }
} # Running the below returns the estimate
Beta <- 1;
c    <- 1;
mmin <- 1;
rva  <- 0.5;
Delt <- 0; # First show no Delta
Del1 <- OffDelta(m=PI,r=0.5,Delta=Delt, Beta=1);
par(mar=c(5,5,1,1));
plot(x=PI,y=Del1,type="l",lwd=2,ylim=c(0,1),
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5,yaxs="i",xaxs="i");
d1m <- findmDelta(low.guess=0,high.guess=10,rval=0.5,Delta=Delt);
d1g <- OffDelta(r=rva, mmin=mmin, Beta=Beta, m=d1m, c=c, Delta=Delt) / d1m;
abline(a=0,b=d1g,col="black");
Delt <- 0.5; # Now show significant delta
Del2 <- OffDelta(m=PI,r=0.5,Delta=Delt, Beta=1);
points(x=PI,y=Del2,type="l",lwd=2,ylim=c(0,1),lty="dashed");
d2m <- findmDelta(low.guess=0,high.guess=10,rval=0.5,Delta=Delt);
d2g <- OffDelta(r=rva, mmin=mmin, Beta=Beta, m=d2m, c=c, Delta=Delt) / d2m;
abline(a=0,b=d2g,lty="dashed");

```

The figure above compares $\Delta=0$ (solid curve) with $\Delta=1/2$ (dashed curve). When strong inbreeding depression exists with an effect that is independent of $m$, optimal parental investment does not change, and $m^{*}=$ `r round(d2m,digits=3)`. Yet while $m^{*}$ is unaffected by $\Delta$, an additional source of inbreeding depression has a predictable negative effect on $\zeta_{\textrm{off}}$, with a rate of fitness increase $\gamma^{*}$ of `r round(d1g,digits=3)` (solid line) when $\Delta=0$ and `r round(d2g,digits=3)` when $\Delta=1/2$ (dashed line). The inclusion of $\Delta$ effectively relaxes the assumption that sufficient parental investment can always compensate for being inbred. For inbred offspring, $\zeta_{\textrm{off}}$ approaches $1/2(1+r)(1 - \Delta r)$ as $m \to \infty$. As such, when $r=1/2$ and $\Delta=1/2$, the maximum possible $\zeta_{\textrm{off}}$ is `r OffDelta(m=Inf, r=0.5, Delt=0.5, Beta=0)` (dashed curve) instead of `r OffDelta(m=Inf, r=0.5, Delt=0, Beta=0)` (solid curve). While this has no effect on optimal parental investment given that inbreeding has occurred, it should be noted that the existence of inbreeding depression that cannot be mitigated with parental investment might strongly affect the fitness consequences of inbreeding versus avoiding inbreeding (e.g., $\gamma^{*}_{r=1/2}$ versus $\gamma^{*}_{r=0}$).

Supporting Information (S2)
----------------------------------------------

Figure 6 below shows how $\gamma$ changes as a function of $m$, and graphically identifies $m^{*}$ where $\gamma$ is maximised (i.e., $\gamma = \gamma^{*}$). Values of $m^{*}$ are identified by grey dots where $\gamma$ is at its peak for four different $r$ values. Figure 6A identifies $m^{*}$ where $\beta$ is sufficiently low to make inbreeding beneficial ($\gamma$ peaks at higher values when $r$ is higher), and Fig. 6B identifies $m^{*}$ where $\beta$ is sufficiently high to make outbreeding beneficial ($\gamma$ peaks at higher values when $r$ is lower). As in Fig. 1B, Fig. 6 shows that $m^{*}$ always increases with increasing $r$ and $\beta$. Consequently, inbreeding parents might often be expected to invest considerably more in fewer offspring, relative to outbreeding parents.

```{r, echo=FALSE, fig.width = 8*figscale, fig.height = 5*figscale, fig.cap="A focal female's rate of fitness increase (gamma star), defined as the rate at which she increases the number of identical-by-descent alleles copies carried in her offspring, given different magnitudes of parental investment. Lines show outbreeding (r=0), inbreeding between outbred first cousins (r=1/8), half-siblings (r=1/4), and full-siblings (r=1/2). Grey dots identify optimal parental investment (m star) for each degree of inbreeding given magnitudes of inbreeding depression in which inbreeding (A; beta=1) and outbreeding (B; beta=3) increase parent fitness."}
par(oma=c(4,1,1,1));
moBB <- 1;
mvals   <- seq(from=1, to=6, by=0.01);
par(mfrow=c(1,2),mar=c(1,5,2,1),lwd=2);
# First assume that Beta = 1.
mvr000  <- OffATr(r=0.000, m=mvals, mmin=1, Beta=moBB, c=1) / mvals;
mvr125  <- OffATr(r=0.125, m=mvals, mmin=1, Beta=moBB, c=1) / mvals;
mvr250  <- OffATr(r=0.250, m=mvals, mmin=1, Beta=moBB, c=1) / mvals;
mvr500  <- OffATr(r=0.500, m=mvals, mmin=1, Beta=moBB, c=1) / mvals;
mstr000 <- findm(low.guess=0,high.guess=6,rval=0.000,Beta=moBB,c=1,mmin=1);
mstr125 <- findm(low.guess=0,high.guess=6,rval=0.125,Beta=moBB,c=1,mmin=1);
mstr250 <- findm(low.guess=0,high.guess=6,rval=0.250,Beta=moBB,c=1,mmin=1);
mstr500 <- findm(low.guess=0,high.guess=6,rval=0.500,Beta=moBB,c=1,mmin=1);
mstrgm0 <- OffATr(r=0.000, m=mstr000, mmin=1, Beta=moBB, c=1) / mstr000;
mstrgm1 <- OffATr(r=0.125, m=mstr125, mmin=1, Beta=moBB, c=1) / mstr125;
mstrgm2 <- OffATr(r=0.250, m=mstr250, mmin=1, Beta=moBB, c=1) / mstr250;
mstrgm5 <- OffATr(r=0.500, m=mstr500, mmin=1, Beta=moBB, c=1) / mstr500;
plot(x=mvals,y=mvr000,type="l",lwd=3,ylim=c(0.0,0.21),pch=1.5,yaxt="n",
     ylab=expression(paste("Rate of fitness increase (",gamma,")")),
     cex.lab=1.5,cex.axis=1.5,xaxs="i",yaxs="i",xaxt="n");
axis(side=2,at=c(0,0.05,0.10,0.15,0.20),labels=TRUE,cex.axis=1.5);
axis(side=1,at=c(1,2,3,4,5,6),cex.axis=1.5);
points(x=mvals,y=mvr125,type="l",lwd=3);
points(x=mvals,y=mvr250,type="l",lwd=3);
points(x=mvals,y=mvr500,type="l",lwd=3);
points(x=mstr000,y=mstrgm0,cex=1.5,pch=21,bg="grey70");
points(x=mstr125,y=mstrgm1,cex=1.5,pch=21,bg="grey70");
points(x=mstr250,y=mstrgm2,cex=1.5,pch=21,bg="grey70");
points(x=mstr500,y=mstrgm5,cex=1.5,pch=21,bg="grey70");
text(x=mvals[450],y=mvr000[450]+0.005,labels="r=0",  srt=-25,cex=0.8);
text(x=mvals[450],y=mvr125[450]+0.005,labels="r=1/8",srt=-25,cex=0.8);
text(x=mvals[450],y=mvr250[450]+0.005,labels="r=1/4",srt=-25,cex=0.8);
text(x=mvals[450],y=mvr500[450]+0.006,labels="r=1/2",srt=-30,cex=0.8);
text(x=5.0,y=0.198,labels=expression(paste("A; ",beta==1)),cex=1.5);
lines(x=c(4.1,4.1,6),y=c(0.21,0.189,0.189),lwd=2);
#--- Now show the place where Beta = 3.
par(mar=c(1,1,2,4),lwd=2);
moBB    <- 3;
mvr000  <- OffATr(r=0.000, m=mvals, mmin=1, Beta=moBB, c=1) / mvals;
mvr125  <- OffATr(r=0.125, m=mvals, mmin=1, Beta=moBB, c=1) / mvals;
mvr250  <- OffATr(r=0.250, m=mvals, mmin=1, Beta=moBB, c=1) / mvals;
mvr500  <- OffATr(r=0.500, m=mvals, mmin=1, Beta=moBB, c=1) / mvals;
mstr000 <- findm(low.guess=0,high.guess=6,rval=0.000,Beta=moBB,c=1,mmin=1);
mstr125 <- findm(low.guess=0,high.guess=6,rval=0.125,Beta=moBB,c=1,mmin=1);
mstr250 <- findm(low.guess=0,high.guess=6,rval=0.250,Beta=moBB,c=1,mmin=1);
mstr500 <- findm(low.guess=0,high.guess=6,rval=0.500,Beta=moBB,c=1,mmin=1);
mstrgm0 <- OffATr(r=0.000, m=mstr000, mmin=1, Beta=moBB, c=1) / mstr000;
mstrgm1 <- OffATr(r=0.125, m=mstr125, mmin=1, Beta=moBB, c=1) / mstr125;
mstrgm2 <- OffATr(r=0.250, m=mstr250, mmin=1, Beta=moBB, c=1) / mstr250;
mstrgm5 <- OffATr(r=0.500, m=mstr500, mmin=1, Beta=moBB, c=1) / mstr500;
plot(x=mvals,y=mvr000,type="l",lwd=3,ylim=c(0.0,0.21),pch=1.5,yaxt="n",
     xlab="",ylab="", cex.lab=1.5,cex.axis=1.5,xaxs="i",yaxs="i",xaxt="n");
axis(side=1,at=c(1,2,3,4,5,6),cex.axis=1.5);
points(x=mvals,y=mvr125,type="l",lwd=3);
points(x=mvals,y=mvr250,type="l",lwd=3);
points(x=mvals,y=mvr500,type="l",lwd=3);
points(x=mstr000,y=mstrgm0,cex=1.5,pch=21,bg="grey70");
points(x=mstr125,y=mstrgm1,cex=1.5,pch=21,bg="grey70");
points(x=mstr250,y=mstrgm2,cex=1.5,pch=21,bg="grey70");
points(x=mstr500,y=mstrgm5,cex=1.5,pch=21,bg="grey70");
text(x=mvals[450],y=mvr000[450]+0.005,labels="r=0",  srt=-22,cex=0.8);
text(x=mvals[450],y=mvr125[450]+0.005,labels="r=1/8",srt=-22,cex=0.8);
text(x=mvals[450],y=mvr250[450]+0.005,labels="r=1/4",srt=-22,cex=0.8);
text(x=mvals[450],y=mvr500[450]+0.005,labels="r=1/2",srt=-22,cex=0.8);
text(x=5.0,y=0.198,labels=expression(paste("B; ",beta==3)),cex=1.5);
lines(x=c(4.1,4.1,6),y=c(0.21,0.189,0.189),lwd=2);
mtext(expression(paste("Parental investment (",italic(m),")")),
      outer=TRUE,side=1,line=2.1,cex=1.5);
```


Supporting Information (S3)
----------------------------------------------

One goal of theory is to provide unified explanations for otherwise disparate natural phenomena, and to thereby generate broadly applicable predictions that follow from a minimal set of general assumptions. Most broadly, the Price equation provides a unified framework for understanding covarying change [@Price1970], which applies universally to evolutionary biology by isolating phenotypic change caused by natural selection from phentopic change caused by other evolutionary processes [@Gardner2008]. Inclusive fitness theory focuses exclusively on natural selection to make general predictions about how selection will lead to evolutionary adaptations and the appearance of design in nature [@Gardner2014]. While the mathematical bridge between the Price equation and inclusive fitness theory continues to be developed [@Grafen2006; @Grafen2014b], inclusive fitness theory remains a powerful tool for understanding adaptation and predicting the general direction of selection. In the main text, we used inclusive fitness theory as a framework to unify previous theory developed for understanding adaptation in the context of inbreeding [@Parker1979; @Parker2006] and parental investment [e.g., @Macnair1978; @Parker1978], and to thereby make general predictions for how natural selection should act across all sexual species when PI can vary with inbreeding. Our interest was therefore to broadly understand the general effect of natural selection with respect to inbreeding and PI, not to predict specific inclusive fitness consequences for different magnitudes of inbreeding or PI provided by individual parents.  Nevertheless, by predicting the fitness consequences for individuals that inbreed and allocate PI sub-optimally (i.e., $m < m^{*}$), it is possible to gain some additional insight into how selection might affect individual's fitnesses in real populations. 

Here we focus on the specific fitness consequences of individuals that inbreed and provide PI to different degrees. We consider outbred individuals that breed with mates of four different degrees of relatedness: non-relatives ($r=0$), first cousins ($r=1/8$), half siblings ($r=1/4$), and full siblings ($r=1/2$). We consider a focal individual that inbreeds to each degree $r$, and allocates PI at the optimum of its own, and all other, optimal PIs (i.e., $m^{*}_{r=0}$, $m^{*}_{r=1/8}$, $m^{*}_{r=1/4}$, and $m^{*}_{r=1/2}$ for all degrees of inbreeding $r$). Figure 7 shows the consequences across all possible combinations of inbreeding and PI given single parent invest (left-hand column of panels) and strict monogamy (right-hand column of panels). A focal individual's rate of fitness increase ($\gamma$) is shown across a range of inbreeding depression magnitudes ($\beta$) assuming that individuals allocate PI at $m^{*}_{r=0}$ (Fig. 7A,B), $m^{*}_{r=1/8}$ (Fig. 7C,D), $m^{*}_{r=1/4}$ (Fig. 7E,F), $m^{*}_{r=1/2}$ (Fig. 7G,H). Line weights show different degrees of inbreeding ($r$) from decreasing to increasing such that lightest lines show $r=0$, medium light lines show $r=1/8$, medium heavy lines show $r=1/4$, and heaviest lines show $r=1/2$. Overall, Figure 7 thereby shows the fitness consequences ($\gamma$) across multiple degrees of inbreeding, PI ($m$), and magnitudes of inbreeding depression ($\beta$).

Given single parent investment (left-hand column of panels), fitness always decreases with increasing $\beta$, except when $r=0$ and outbreeders invest optimally (Fig. 7A), in which case fitness remains unchanged despite increasing $\beta$. As outbreeding parents invest at the optimum of increasingly high inbreeding (panel rows top to bottom), individual fitness decreases more rapidly with $\beta$ because outbreeding individuals are allocating PI further away from their optimum and more toward the optimum of individuals that inbreed (compare Fig. 7 with Fig. 6 in SI 2, where $\gamma$ for $r=0$ decreases along the curve away from its maximum given $m^{*}$ for increasing $r=1/8$ to $r=1/2$). When $r>0$, $\gamma$ always decreases with increasing $\beta$, but the slope of this decrease is weakest when an individual is investing at its optimum PI. For example, when $r=1/8$, the slope of $\gamma$ as a function of $\beta$ is least negative in Fig. 7C, where the individual is investing at its optimum $m^{*}_{r=1/8}$, and more negative for all other $m^{*}$ (Fig. 7A,E,G). For the highest $m^{*}_{r=1/2}$ (Fig. 7G), $r=1/2$ consistently has the highest $\gamma$, with a monotonic decrease in $\gamma$ with decreasing $r$, and as individuals therefore invest further away from their own optimum PI (it is relevant to note that lines predicting $\gamma$ in Fig. 7G would cross at higher $\beta$ values, as they do at increasingly higher $\beta$ in Fig. 7A,C, and E). Overall, fitness decreases with increasing $\beta$, and as an individual invests further away from its optimal PI.

Given strict monogamy (right-hand column of panels), fitness always decreases with increasing $\beta$, except again when outbreeders invest optimally (Fig. 7B). In contrast to single parent investment, given strict monogamy, individuals that inbreed ($r>0$) never have a higher fitness than individuals that avoid inbreeding ($r=0$). In fact, across all optimal PI, individual fitness always decreases with increasing inbreeding. For example, in Fig. 7F, a focal individual that inbreeds with its half-sibling (second to lightest line weight) is investing optimally while all other individuals do not, yet its fitness is always lower than individuals that outbreed or inbreed with first cousins ($r=0$ and $r=1/8$, respectively), and always higher than indivduals that inbreed with full siblings ($r=1/2$). This illustrates the importance of considering the fitness consequences of inbreeding in light of opportunity costs [@Waser1986], such as the complete opportunity cost imposed by strict monogamy. If opportunity costs of male mating are high, then inbreeding will decrease fitness regardless of PI, as is consistent with the key conceptual point highlighted by @Waser1986.

Overall, Figure 7 thereby shows the fitness consequences of varying inbreeding and PI across a wide range of values for inbreeding depression. These specific cases affecting individual fitness highlight our general conclusion that parents will benefit by increasing their PI at higher magnitudes of inbreeding and inbreeding depression, as illustrated by the fitness consequences of deviations from optimal PI derived in the main text.


```{r, echo=FALSE, fig.width = 7*figscale, fig.height = 8*figscale, fig.cap="Relationship between the magnitude of inbreeding depression and the rate of a focal parents's fitness increase given optimum parental investment (m*) for four degrees of relatedness between a focal parent and its mate (r={0, 1/8, 1/4, 1/2}, rows top to bottom) and single parent investment (left column) versus strict monogamy (right column). Each panel therefore shows a unique combinuation of optimum parental investment given either single parent investment or strict monogamy. Within panels, parent fitness is plotted as a function of inbreeding depression for all combinations of r: r=0 (thin line), r=1/8 (medium thin line), r=1/4 (medium thick line) and r=1/2 (thick line)."}
gamzVrkin <- function(rvl,kin,betas,mmin=1,c=1,oc=0){
    mvl <- rep(0,length(betas));
    gam <- rep(0,length(betas));
    for(i in 1:length(bss)){
        mvl[i] <- findm(low.guess=0,high.guess=10,rval=kin,mmin=1,Beta=betas[i],c=1);
        if(oc==0){
            gam[i] <- OffATr(r=rvl, m=mvl[i], mmin=1, Beta=betas[i], c=1) / mvl[i];
        }else{
            gam[i] <- Offpair(r=rvl, m=mvl[i], mmin=1, Beta=betas[i], c=1, m0=r00m) / mvl[i];
        }
    }
    return(list(mvl=mvl,gam=gam));
} 
#-----------------------------------------------------------
r0500m000 <- gamzVrkin(rvl=0.500,kin=0.000,betas=bss,oc=0); 
r0250m000 <- gamzVrkin(rvl=0.250,kin=0.000,betas=bss,oc=0);
r0125m000 <- gamzVrkin(rvl=0.125,kin=0.000,betas=bss,oc=0);
r0000m000 <- gamzVrkin(rvl=0.000,kin=0.000,betas=bss,oc=0);
#-----------------------------------------------------------
r0500m125 <- gamzVrkin(rvl=0.500,kin=0.125,betas=bss,oc=0);
r0250m125 <- gamzVrkin(rvl=0.250,kin=0.125,betas=bss,oc=0);
r0125m125 <- gamzVrkin(rvl=0.125,kin=0.125,betas=bss,oc=0);
r0000m125 <- gamzVrkin(rvl=0.000,kin=0.125,betas=bss,oc=0);
#-----------------------------------------------------------
r0500m250 <- gamzVrkin(rvl=0.500,kin=0.250,betas=bss,oc=0);
r0250m250 <- gamzVrkin(rvl=0.250,kin=0.250,betas=bss,oc=0);
r0125m250 <- gamzVrkin(rvl=0.125,kin=0.250,betas=bss,oc=0);
r0000m250 <- gamzVrkin(rvl=0.000,kin=0.250,betas=bss,oc=0);
#-----------------------------------------------------------
r0500m500 <- gamzVrkin(rvl=0.500,kin=0.500,betas=bss,oc=0);
r0250m500 <- gamzVrkin(rvl=0.250,kin=0.500,betas=bss,oc=0);
r0125m500 <- gamzVrkin(rvl=0.125,kin=0.500,betas=bss,oc=0);
r0000m500 <- gamzVrkin(rvl=0.000,kin=0.500,betas=bss,oc=0);
#-----------------------------------------------------------
#-----------------------------------------------------------
r0500m000c <- gamzVrkin(rvl=0.500,kin=0.000,betas=bss,oc=1); 
r0250m000c <- gamzVrkin(rvl=0.250,kin=0.000,betas=bss,oc=1);
r0125m000c <- gamzVrkin(rvl=0.125,kin=0.000,betas=bss,oc=1);
r0000m000c <- gamzVrkin(rvl=0.000,kin=0.000,betas=bss,oc=1);
#-----------------------------------------------------------
r0500m125c <- gamzVrkin(rvl=0.500,kin=0.125,betas=bss,oc=1);
r0250m125c <- gamzVrkin(rvl=0.250,kin=0.125,betas=bss,oc=1);
r0125m125c <- gamzVrkin(rvl=0.125,kin=0.125,betas=bss,oc=1);
r0000m125c <- gamzVrkin(rvl=0.000,kin=0.125,betas=bss,oc=1);
#-----------------------------------------------------------
r0500m250c <- gamzVrkin(rvl=0.500,kin=0.250,betas=bss,oc=1);
r0250m250c <- gamzVrkin(rvl=0.250,kin=0.250,betas=bss,oc=1);
r0125m250c <- gamzVrkin(rvl=0.125,kin=0.250,betas=bss,oc=1);
r0000m250c <- gamzVrkin(rvl=0.000,kin=0.250,betas=bss,oc=1);
#-----------------------------------------------------------
r0500m500c <- gamzVrkin(rvl=0.500,kin=0.500,betas=bss,oc=1);
r0250m500c <- gamzVrkin(rvl=0.250,kin=0.500,betas=bss,oc=1);
r0125m500c <- gamzVrkin(rvl=0.125,kin=0.500,betas=bss,oc=1);
r0000m500c <- gamzVrkin(rvl=0.000,kin=0.500,betas=bss,oc=1);
#-----------------------------------------------------------
par(mfrow=c(4,2),mar=c(0.5,0.5,0.5,0.5),oma=c(5.5,5.5,4,1));
#-----------------------------------------------------------
plot(x=bss,y=r0500m000$gam,type="n",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab="",xaxt="n",ylab="",cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.10,0.15,0.20),cex.axis=1.5);
points(x=bss,y=r0500m000$gam,type="l",lwd=4);
points(x=bss,y=r0250m000$gam,type="l",lwd=3);
points(x=bss,y=r0125m000$gam,type="l",lwd=2);
points(x=bss,y=r0000m000$gam,type="l",lwd=1);
text(x=4.95,y=0.212,labels="A",cex=2.5);
text(x=1.20,y=0.212,labels=expression(paste("m*"[r==0])),cex=1.5);
#-----------------------------------------------------------
plot(x=bss,y=r0500m000c$gam,type="n",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab="",xaxt="n",ylab="",cex.lab=1.5,cex.axis=1.5);
points(x=bss,y=r0500m000c$gam,type="l",lwd=4);
points(x=bss,y=r0250m000c$gam,type="l",lwd=3);
points(x=bss,y=r0125m000c$gam,type="l",lwd=2);
points(x=bss,y=r0000m000c$gam,type="l",lwd=1);
text(x=4.95,y=0.212,labels="B",cex=2.5);
text(x=1.20,y=0.212,labels=expression(paste("m*"[r==0])),cex=1.5);
#-----------------------------------------------------------
plot(x=bss,y=r0500m125$gam,type="n",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab="",xaxt="n",ylab="",cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.10,0.15,0.20),cex.axis=1.5);
points(x=bss,y=r0500m125$gam,type="l",lwd=4);
points(x=bss,y=r0250m125$gam,type="l",lwd=3);
points(x=bss,y=r0125m125$gam,type="l",lwd=2);
points(x=bss,y=r0000m125$gam,type="l",lwd=1);
text(x=4.95,y=0.212,labels="C",cex=2.5);
text(x=1.20,y=0.212,labels=expression(paste("m*"[r==1/8])),cex=1.5);
#-----------------------------------------------------------
plot(x=bss,y=r0500m125c$gam,type="n",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab="",xaxt="n",ylab="",cex.lab=1.5,cex.axis=1.5);
points(x=bss,y=r0500m125c$gam,type="l",lwd=4);
points(x=bss,y=r0250m125c$gam,type="l",lwd=3);
points(x=bss,y=r0125m125c$gam,type="l",lwd=2);
points(x=bss,y=r0000m125c$gam,type="l",lwd=1);
text(x=4.95,y=0.212,labels="D",cex=2.5);
text(x=1.20,y=0.212,labels=expression(paste("m*"[r==1/8])),cex=1.5);
#-----------------------------------------------------------
plot(x=bss,y=r0500m250$gam,type="n",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab="",xaxt="n",ylab="",cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.10,0.15,0.20),cex.axis=1.5);
points(x=bss,y=r0500m250$gam,type="l",lwd=4);
points(x=bss,y=r0250m250$gam,type="l",lwd=3);
points(x=bss,y=r0125m250$gam,type="l",lwd=2);
points(x=bss,y=r0000m250$gam,type="l",lwd=1);
text(x=4.95,y=0.212,labels="E",cex=2.5);
text(x=1.20,y=0.212,labels=expression(paste("m*"[r==1/4])),cex=1.5);
#-----------------------------------------------------------
plot(x=bss,y=r0500m250c$gam,type="n",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab="",xaxt="n",ylab="",cex.lab=1.5,cex.axis=1.5);
points(x=bss,y=r0500m250c$gam,type="l",lwd=4);
points(x=bss,y=r0250m250c$gam,type="l",lwd=3);
points(x=bss,y=r0125m250c$gam,type="l",lwd=2);
points(x=bss,y=r0000m250c$gam,type="l",lwd=1);
text(x=4.95,y=0.212,labels="F",cex=2.5);
text(x=1.20,y=0.212,labels=expression(paste("m*"[r==1/4])),cex=1.5);
#-----------------------------------------------------------
plot(x=bss,y=r0500m500$gam,type="n",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab="", ylab="",cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.10,0.15,0.20),cex.axis=1.5);
points(x=bss,y=r0500m500$gam,type="l",lwd=4);
points(x=bss,y=r0250m500$gam,type="l",lwd=3);
points(x=bss,y=r0125m500$gam,type="l",lwd=2);
points(x=bss,y=r0000m500$gam,type="l",lwd=1);
text(x=4.95,y=0.212,labels="G",cex=2.5);
text(x=1.20,y=0.212,labels=expression(paste("m*"[r==1/2])),cex=1.5);
#-----------------------------------------------------------
plot(x=bss,y=r0500m500$gam,type="n",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab="",ylab="",cex.lab=1.5,cex.axis=1.5);
points(x=bss,y=r0500m500c$gam,type="l",lwd=4);
points(x=bss,y=r0250m500c$gam,type="l",lwd=3);
points(x=bss,y=r0125m500c$gam,type="l",lwd=2);
points(x=bss,y=r0000m500c$gam,type="l",lwd=1);
text(x=4.95,y=0.212,labels="H",cex=2.5);
text(x=1.20,y=0.212,labels=expression(paste("m*"[r==1/2])),cex=1.5);
#-----------------------------------------------------------
mtext(text=expression(paste("Inbreeding depression (",beta,")")),
      side=1,line=3, cex=1.5, col="black" , outer=TRUE);
mtext(text=expression(paste("Rate of fitness increase (",gamma,")")),
      side=2,line=2, cex=1.5, col="black", outer=TRUE);
mtext(text="Single parent", adj=0,
      side=3,line=1, cex=1.5, col="black", outer=TRUE);
mtext(text="Strict monogamy", adj=1,
      side=3,line=1, cex=1.5, col="black", outer=TRUE);
```

******************************


References
----------------------------------------------


