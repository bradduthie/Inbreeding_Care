---
title: "Inbreeding parents should invest more resources in fewer offspring"
author: "Brad Duthie"
date: "March 28, 2016"
output: html_document
linestretch: 1
header-includes:
- \usepackage{natbib}
- \usepackage{lineno}
- \linenumbers
- \bibliographystyle{amnatnat}
bibliography: Inbreeding_and_PI.bib
word_document:
  reference_docx: AASRJ-Style-Format.docx
---

<!---

  word_document:
    reference_docx: AASRJ-Style-Format.docx

--->


******************************

Introduction
------------------------------------------------

Mating among relatives is common, especially within small and viscous populations, and such inbreeding can alter offspring genotypes and decrease offspring fitness [@Goodwillie2005; OGrady2006; @Charlesworth2009].  

The setup of the introduction should address:

* Biparental inbreeding can increase or decrease fitness depending on inbreeding depression
* Inbreeding theory assumes that offspring number is fixed and parental investment is implicit
* We instead allow parents to adjust their investment in offspring given different inbreeding
* Empirical studies suggest that parental investment increases offspring fitness relatively more when offspring are inbred [@Aviles2006; @Pilakouta2015].
* We demonstrate that inbreeding should consistently increase optimal parental investment


<!--- The following includes some initial notes, modelling, and analysis on biparental inbreeding and parental investment. The goal is to explore whether or not different degrees of parental investment might be favoured for different degrees of inbreeding, and if inbreeding might be favoured sometimes if enough parental investment can overcome the effect of inbreeding depression. --->

<!--- Something about parent-offspring conflict -- how it is reduced when the offspring are inbred because parents then invest more in their offspring. This links in with the seed size papers, but find a different angle? Separate section to go through @Macnair1978 and @Parker1978 type results but with inbreeding? --->

******************************

Model
------------------------------------------------

<!--- Get in here somewhere, perhaps, a female's total pool $M$ of resources, such that she produces a total of $n = M/m$ offspring [see @Parker2002]. This will make the connection between the biparental inbreeding literature and the parental investment literature clearer. Also, @Parker1985 define this explicitly using the same terms, such that n f = (M/m)f(m), where n is offspring number and f is fitness of an offspring. Can weave this directly into the model at the start, and then just assume $n=1$ (noting that it doesn't really matter). Or, could leave it where it is, maybe with a bit more explicit connection before mentioning Appendix 3, where it features more heavily. --->

<!--- Also, @Parker1985 has a useful way of putting the rate of fitness increase: ``A gene which causes a female to allocate its resources as m* equally to each offspring will have the fastest possible replication rate'' -- maybe explain it this way, with citation, to describe $\zeta_{\textrm{off}}$? Essentially, we are showing how this works when outbreeding is no longer assumed. --->

<!--- Note that given the above logic, and that in @Parker1985, the below modelling assumes *either* one parent investment *or* `true monogamy' in which each parent invests equally. The two only differ be a factor of two, so if we assume monogamy, then m* is the same, but parents produce twice as many offspring (this doesn't need to be demonstrated, but it's worth noting). --->

<!--- Adding a second parent, more generally, is a bit counter-intuitive: Total investment should just be m_mum + m_dad. Given true monogamy under these conditions, optimal investment for each parent is just m*/2 (each contributes half investment). But, if the father slacks off and only invests m*/4 (and mum can't do anything about it), then -- paradoxicially -- mum should invest less, not more. The reason is that given the father decreases its m, the mother is now stuck with more offspring than she would have otherwise produced given her budget for investment; her optimal response is to decrease investment in each. This is because when one parent `defects' by investing less, the reduced benefit is offset by the non-defecting parent (and both parents get the same total benefit) and the defector pays none of the costs. In response, the optimal strategy is therefore to also decrease investment. I'm not sure whether it's worth getting into this or not yet. It appears we would need to define $\zeta_{\textrm{off}}(m1,m2)$, then find 2*zeta(m1)/zeta'(m1) ? --->

Our model conceptually links two different theoretical frameworks initially developed by @Macnair1978 and @Parker1979. The first framework [@Macnair1978] predicts optimal parental investment in outbred offspring. The second [@Parker1979] predicts inbreeding depression thresholds below which focal parents increase their fitness by inbreeding rather than avoiding inbreeding. We consider a focal diploid parent (hereafter assumed to be female) that can adjust the degree to which she invests in each offspring to maximise her own fitness given that she inbreeds to some degree and produces correspondingly inbred offspring whose fitness might be decreased by inbreeding depression. 

We define a focal female's fitness in terms of the total number of identical-by-descent allele copies carried in her offspring. This definition differs from that of previous models of parental investment [e.g., @Macnair1978; @Parker1978], which instead define fitness only in terms of the number of offspring produced and therefore cannot account for inclusive fitness differences between inbred and outbred offspring.  As in @Parker1978, we assume that direct offspring fitness (e.g., offspring survival) increases with increasing parental investment ($m$), with diminishing returns as $m$ increases. It is important to note that $m$ does not represent raw resources provided to an offspring (e.g., food), but is rather anything that a parent does to increase its offspring's fitness at the expense of its other actual or potential offspring [@Trivers1972; @Trivers1974]. Females have a total investment budget of $M$, and therefore will produce $n=M/m$ total offspring, and we assume $M \gg m$ [@Parker1985]. Overall, identical-by-descent allele copies carried per offspring ($\zeta_{\textrm{off}}$) is represented as,

$$\zeta_{\textrm{off}} = \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m-m_{min}-\beta r\right)}\right).$$ 

It is helpful to conceptualise the above equation in two pieces. First, the expression $\left(1/2\right) \left(1 + r\right)$ is the fitness increment that a female gains from identical-by-descent alleles carried by her offspring, as is affected by the coefficient of relatedness between the female and the sire of her offspring ($r$) scaled by a factor of $1/2$ for each parent's genetic contribution to its offspring. Second, the expression $\left(1 - \exp\left[-c\left(m-m_{min}-\beta r\right)\right]\right)$ is the individual offspring's direct fitness as a function of $m$ and $r$. Additionally, offspring fitness is affected by a minimum value of $m$ required for offspring viability ($m_{min}$), inbreeding depression $\beta$, and a parameter that affects the curve of parental investment with respect to fitness ($c$; i.e., how 'diminishing' are the returns on $\zeta_{\textrm{off}}$ from increasing $m$). When a focal female inbreeds, the first expression increases because more identical-by-descent alleles are carried by inbred offspring, but the second expression will decrease if $\beta>0$ due to inbreeding depression in those offspring.

When $r=0$ and $\beta=0$ (outbreeding), the above equation reduces to standard models of parental investment [e.g., @Macnair1978; @Parker1978] but with the usual parameter $K$ being replaced by $1/2$, and thereby specifically representing identical-by-descent alleles instead of an arbitrary constant affecting offspring fitness. Similarly, given $\delta = \exp\left[-c\left(m-m_{min}-\beta r\right)\right]$, where $\delta$ defines reduced fitness of inbred offspring as in previous models of biparental inbreeding [e.g., @Kokko2006; @Parker2006; @Duthie2015a], the above equation reduces to the standard model of biparental inbreeding introduced by @Parker1979.  All offspring have the same direct fitness as $m \to \infty$. Consequently, our model assumes that sufficient parental investment can always compensate for being inbred, although the amount of investment required for such compensation might be very high.

The above equation can be analysed to determine optimal parental investment ($m^{*}$), and the rate at which identical-by-descent alleles are passed given $m^{*}$ [@Kuijper2012], which we define as $\gamma^{*}$ (see Appendix 1 for derivations of $m^{*}$ and $\gamma^{*}$). An example contrasting outbreeding ($r=0$) with inbreeding between first order relatives ($r=1/2$) illustrates this analysis. For simplicity, we assume that $m_{min}=1$, $\beta=1$, and $c=1$.

```{r, echo=FALSE}
# Below is a function of the general equation for plotting
OffATr <- function(r, m, mmin=1, Beta=1, c=1){
    return( (1/2)*(1+r) * (1 - exp(-c*(m - mmin - Beta*r)) ));
}
# Below is the same equation as an expression for maths
fm  <- expression(0.5*(1+r)*(1-exp(-c*(m-mmin-Beta*r))),'m');
# We can use the above to differentiate fm wrt `m`
fmd <- D(fm,'m'); # can print fmd to show solution
# Below is fmd for analysis and plotting
OffATrd <- function(r, m, mmin=1, Beta=1, c=1){
    return(  0.5 * (1 + r) * (exp(-c * (m - mmin - Beta * r)) * c)  );
    # Also can simplify: return(  (c/2)*(1+r)*exp(-c*(m-mmin-Beta*r))  );
} # We'll need the above to find m^{*} and \gamma^{*} 
# To find m^{*}, can use the function below
findm <- function(low.guess,high.guess,rval,mmin=1,Beta=1,c=1){
  fm  <- function(m,r=rval){ 
           OffATrd(r=rval, mmin=mmin, Beta=Beta, m=m, c=c)*(0-m) + 
             OffATr(r=rval, mmin=mmin, Beta=Beta, m=m, c=c);
         }
  lg  <- fm(m=low.guess, r=rval);
  hg  <- fm(m=high.guess,r=rval);
  if(lg > 0){
    u <- low.guess;
    l <- high.guess;
  }else{
    u <- high.guess;
    l <- low.guess;
  }
  if((fm(l) > 0 & fm(u) > 0) | (fm(l) < 0 & fm(u) < 0)){
    return("Value of m is outside the range");
  }else{
    check  <- 1;
    mguess <- 0.5 * (l+u);
    i      <- 0;
    while(abs(check) > 0.000001 & i < 1000000){
        check <- fm(r=rval, m=mguess);
        if(check > 0){
          u      <- mguess;
          mguess <- 0.5*(l+mguess); 
        }else{
          l      <- mguess;
          mguess <- 0.5*(u+mguess);
        }
        i <- i+1;
    }
    return(mguess);
  }
} # Running the below returns the estimate
# Below returns m^{*} for outbreeders and inbreeders, respectively
r00m <- findm(low.guess=0,high.guess=4,rval=0.0,mmin=1,Beta=1,c=1);
r05m <- findm(low.guess=0,high.guess=4,rval=0.5,mmin=1,Beta=1,c=1);
# Below finds the tangent slope, \gamma^{*}
r00g <- OffATr(r=0,   m=r00m, mmin=1, Beta=1, c=1) / r00m;
r05g <- OffATr(r=0.5, m=r05m, mmin=1, Beta=1, c=1) / r05m;
# The code below plots everything
PI <- seq(from=0,to=4,by=0.01);
Alleles_IBD_outbr <- OffATr(r=0.0, m=PI, mmin=1, Beta=1, c=1);
Alleles_IBD_inbr  <- OffATr(r=0.5, m=PI, mmin=1, Beta=1, c=1);
par(mar=c(5,5,2,2));
plot(PI,Alleles_IBD_outbr,type="l",lwd=3,ylim=c(0,1),
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(h=0,lty="dotted",lwd=0.8);
points(PI,Alleles_IBD_inbr,type="l",lwd=3,lty="dashed");
abline(a=0,b=r00g,lty="solid", lwd=1); # Tangent line r = 0
abline(a=0,b=r05g,lty="dashed",lwd=1); # Tangent line r = 0.5
#abline(v=r00m,lty="solid", lwd=0.5); # Position of m^{*} for r = 0
#abline(v=r05m,lty="dashed",lwd=0.5); # Position of m^{*} for r = 0.5
```

```{r, echo=FALSE}
OffAT <- function(r, m, B0=1, B1=1, c=1){
    return( (1/2)*(1+r) * (1 - exp(-c*(m - B0 - B1*r)) ));
}
```

The above figure shows how $\zeta_{\textrm{off}}$ increases with $m$ given $r=0$ (solid curve) and $r=1/2$ (dashed curve). Given, $r=0$, $\zeta_{\textrm{off}}=0$ when $m \leq m_{min}$, meaning that offspring are only viable when $m>m_{min}$. Increasing $r$ effectively increases the minimum amount of parental investment required to produce a viable offspring to $m_{min}+\beta r$, so when $r=1/2$, $\zeta_{\textrm{off}}=0$ when $m \leq 3/2$. Nevertheless, because inbred offspring carry more of their parents' alleles identical-by-descent, sufficiently high $m$ causes $\zeta_{\textrm{off}}$ of inbred offspring to exceed that of outbred offspring (represented by the intersection between solid and dashed curves in the figure above). The point on the line running through the origin that is tangent to $\zeta_{\textrm{off}}(m)$ defines optimal investment for outbreeding $m^{*}_{r=0}=$ `r round(r00m,digits=2)` (solid line) and inbreeding $m^{*}_{r=1/2}=$ `r round(r05m,digits=2)` (dashed line) parents. The slope of each line is the rate of a parent's fitness increase given outbreeding $\gamma^{*}_{r=0}=$ `r round(r00g,digits=2)` (solid line) and inbreeding $\gamma^{*}_{r=1/2}=$ `r round(r05g,digits=2)` (dashed line). To maximise fitness, females that inbreed with first order relatives should therefore invest more in offspring than females that outbreed ($m^{*}_{r=1/2}>m^{*}_{r=0}$). This result is general across different values of $r$ (see Appendix 2); as $r$ increases, so does $m^{*}$. All else being equal, females that inbreed more should therefore adopt a strategy of investing more per capita in fewer total offspring.

```{r, echo=FALSE}
# Getting the calculatoins for beta = 3
r00m.b3 <- findm(low.guess=0,high.guess=6,rval=0.0,mmin=1,Beta=3,c=1);
r05m.b3 <- findm(low.guess=0,high.guess=6,rval=0.5,mmin=1,Beta=3,c=1);
r00g.b3 <- OffATr(r=0,   m=r00m.b3, mmin=1, Beta=3, c=1) / r00m.b3;
r05g.b3 <- OffATr(r=0.5, m=r05m.b3, mmin=1, Beta=3, c=1) / r05m.b3;
```

Assuming that females adopt an optimal strategy of parental investment, it is possible to compare the rate of fitness increase for females across different degrees of inbreeding $r$ and inbreeding depression $\beta$. In the example above comparing $r=0$ and $r=1/2$ when $\beta=1$, inbreeding increases fitness more than outbreeding when both females invest optimally ($\gamma^{*}_{r=1/2}>\gamma^{*}_{r=0}$). This can also be confirmed by reducing our model to the results of established biparental inbreeding models (see Appendix 3). If, however, $\beta=3$ instead of $\beta=1$, then $\gamma^{*}_{r=0}=$ `r round(r00g.b3,digits=2)` and $\gamma^{*}_{r=1/2}=$ `r round(r05g.b3,digits=2)`. Given this higher inbreeding depression and assuming optimal parental investment, outbreeding females therefore have higher fitness than females that inbreed with first order relatives.

```{r, echo=FALSE, fig.width = 8, fig.height = 10}
bss <- seq(from=0.5,to=5,by=0.25);
gamz <- function(rvl,betas,mmin=1,c=1){
    mvl <- rep(0,length(betas));
    gam <- rep(0,length(betas));
    for(i in 1:length(bss)){
        mvl[i] <- findm(low.guess=0,high.guess=10,rval=rvl,mmin=1,Beta=betas[i],c=1);
        gam[i] <- OffATr(r=rvl, m=mvl[i], mmin=1, Beta=betas[i], c=1) / mvl[i];
    }
    return(list(mvl=mvl,gam=gam));
}
rg000 <- gamz(rvl=0.000,betas=bss);
rg125 <- gamz(rvl=0.125,betas=bss);
rg250 <- gamz(rvl=0.250,betas=bss);
rg500 <- gamz(rvl=0.500,betas=bss);
par(mfrow=c(2,1),mar=c(0.25,5,1,1),lwd=2);
layout(matrix(data=c(1,2), nrow=2, ncol=1, byrow = TRUE),
       widths=c(1,1), heights=c(1,1))
#----------------------------------------------------------------
par(mar=c(1,5,2,1),lwd=2);
plot(x=bss,y=rg000$mvl,type="l",lwd=2,ylim=c(2,6),pch=1.5,xaxt="n",
     xlab="",
     ylab=expression(paste("Optimum parental investment (",italic(m),"*)")),
     cex.lab=1.5,cex.axis=1.5);
points(x=bss,y=rg125$mvl,type="l",lwd=2);
points(x=bss,y=rg250$mvl,type="l",lwd=2);
points(x=bss,y=rg500$mvl,type="l",lwd=2);
text(x=bss[17],y=rg000$mvl[17]+0.15,labels="r=0",srt=-0,cex=1.25);
text(x=bss[17],y=rg125$mvl[17]+0.15,labels="r=1/8",srt=6,cex=1.25);
text(x=bss[17],y=rg250$mvl[17]+0.15,labels="r=1/4",srt=12,cex=1.25);
text(x=bss[17],y=rg500$mvl[17]+0.15,labels="r=1/2",srt=18,cex=1.25);
text(x=4.95,y=5.9,labels="A",cex=2.5);
#----------------------------------------------------------------
par(mar=c(5,5,0.25,1),lwd=2);
plot(x=bss,y=rg000$gam,type="l",lwd=2,ylim=c(0.12,0.22),pch=1.5,yaxt="n",
     xlab=expression(paste("Inbreeding depression (",beta,")")),
     ylab=expression(paste("Rate of fitness increase (",gamma,"*)")),
     cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.12,0.16,0.20),cex.axis=1.5);
points(x=bss,y=rg125$gam,type="l",lwd=2);
points(x=bss,y=rg250$gam,type="l",lwd=2);
points(x=bss,y=rg500$gam,type="l",lwd=2);
text(x=bss[17],y=rg000$gam[17]+0.003,labels="r=0",srt=-0,cex=1.25);
text(x=bss[17],y=rg125$gam[17]+0.003,labels="r=1/8",srt=-6,cex=1.25);
text(x=bss[17],y=rg250$gam[17]+0.003,labels="r=1/4",srt=-12,cex=1.25);
text(x=bss[17],y=rg500$gam[17]+0.003,labels="r=1/2",srt=-18,cex=1.25);
text(x=4.95,y=0.215,labels="B",cex=2.5);

```

A general relationship between $\beta$, $m^{*}$, and $\gamma^{*}$ for different values of $r$ can be shown through numerical simulation. In the figure above, this relationship is shown across a range of $\beta$ for $r$ values corresponding to outbreeding ($r=0$) and inbreeding between outbred cousins ($r=1/8$), half-siblings ($r=1/4$), and full siblings ($r=1/2$). Across all numerical simulations, $m_{min}=1$ and $c=1$. Panel (A) shows how $m^{*}$ increases with both increasing $\beta$ and increasing $r$, and panel (B) shows how $\gamma^{*}$ changes with $\beta$ and $r$ given optimal parental investment. Overall, optimal investment increases with increasing inbreeding depression and inbreeding, and the difference in magnitude of investment per offspring is sometimes expected to be high (e.g., when $\beta=3.25$, $m^{*}_{r=1/2} > m^{*}_{r=0}$ by a factor of `r round(findm(low.guess=0,high.guess=5,rval=0.5,Beta=3.25) / findm(low.guess=0,high.guess=5,rval=0.0,Beta=3.25),digits=2)`). Consequently, inbreeding parents might often be expected to invest considerably more in fewer offspring, relative to outbreeding parents.

In some populations, females might be unable to discriminate between kin and non-kin, and hence unable to adjust their parental investment when inbreeding. It is therefore interesting to consider the fitness consequencies when inbreeding females invest suboptimally in offspring, and therefore $\gamma < \gamma^{*}$. The figure below shows $\gamma$ values for inbreeding females when they invest at the relatively low optimum $m^{*}$ for an outbreeding female. 

```{r, echo=FALSE, fig.width = 8, fig.height = 5}
# First the below plots the new figure
bss <- seq(from=0.5,to=5,by=0.25);
gamznokin <- function(rvl,betas,mmin=1,c=1){
    mvl <- rep(0,length(betas));
    gam <- rep(0,length(betas));
    for(i in 1:length(bss)){
        mvl[i] <- findm(low.guess=0,high.guess=10,rval=0,mmin=1,Beta=betas[i],c=1);
        gam[i] <- OffATr(r=rvl, m=mvl[i], mmin=1, Beta=betas[i], c=1) / mvl[i];
    }
    return(list(mvl=mvl,gam=gam));
}
rg000nk <- gamznokin(rvl=0.000,betas=bss);
rg125nk <- gamznokin(rvl=0.125,betas=bss);
rg250nk <- gamznokin(rvl=0.250,betas=bss);
rg500nk <- gamznokin(rvl=0.500,betas=bss);
par(mar=c(5,5,0.25,1),lwd=2);
plot(x=bss,y=rg000nk$gam,type="l",lwd=2,ylim=c(0.12,0.22),pch=1.5,yaxt="n",
     xlab=expression(paste("Inbreeding depression (",beta,")")),
     ylab=expression(paste("Rate of fitness increase (",gamma,"*)")),
     cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.12,0.16,0.20),cex.axis=1.5);
points(x=bss,y=rg125nk$gam,type="l",lwd=2);
points(x=bss,y=rg250nk$gam,type="l",lwd=2);
points(x=bss,y=rg500nk$gam,type="l",lwd=2);
text(x=bss[12],y=rg000nk$gam[12]+0.003,labels="r=0",srt=-0,cex=1.25);
text(x=bss[10],y=rg125nk$gam[10]+0.004,labels="r=1/8",srt=-22.5,cex=1.25);
text(x=bss[7],y=rg250nk$gam[7]+0.005,labels="r=1/4",srt=-44,cex=1.25);
text(x=bss[4]+0.08,y=rg500nk$gam[4]+0.004,labels="r=1/2",srt=-60,cex=1.25);
# Next, the below generates a function to find where lines intersect
# Finds the beta at which a particular r value intersects r=0 for fitness
findbeta <- function(high.guess,rval,m=FALSE,mmin=1,c=1){
    low.guess <- 0;
    outbr <- findm(low.guess=0,high.guess=10,rval=0,mmin=mmin,Beta=0,c=c);
    outgm <- OffATr(r=0,m=outbr,mmin=mmin,Beta=0,c=c) / outbr;
    if(m == FALSE){ # If we're not constraining m
        check  <- 1;
        bguess <- 0.5 * high.guess;
        i      <- 0;
        l      <- low.guess
        u      <- high.guess;
        while(abs(check) > 0.000001 & i < 1000000){
            mst   <- findm(low.guess=0,high.guess=10,rval=rval,mmin=mmin,Beta=bguess,c=c);
            gam   <- OffATr(r=rval,m=mst,mmin=mmin,Beta=bguess,c=c) / mst;
            check <- gam - outgm;
            if(check < 0){
                u      <- bguess;
                bguess <- 0.5*(l+bguess); 
            }else{
                l      <- bguess;
                bguess <- 0.5*(u+bguess);
            }
            i <- i+1;
        }
    }else{ #If we are forcing m to a particular value
        check  <- 1;
        bguess <- 0.5 * high.guess;
        i      <- 0;
        l      <- low.guess
        u      <- high.guess;
        while(abs(check) > 0.000001 & i < 1000000){
            gam   <- OffATr(r=rval,m=m,mmin=mmin,Beta=bguess,c=c) / m;
            check <- gam - outgm;
            if(check < 0){
                u      <- bguess;
                bguess <- 0.5*(l+bguess); 
            }else{
                l      <- bguess;
                bguess <- 0.5*(u+bguess);
            }
            i <- i+1;
        }
    }   
    return(bguess);
}
```

The fitness consequences of suboptimal parental investment are severe when inbreeding females invest as if they are outbreeding. While the fitness of a female that inbreeds with a first order relative ($r=1/2$) exceeds that of an outbreeding female ($\gamma^{*}=$ `r round(r00g,digits=3)`) when $\beta <$ `r round(findbeta(high.guess=10,rval=0.5,m=FALSE), digits=3)`, if the inbreeding female invests at the outbreeding female's optimum ($m^{*}_{r=0}$), then her fitness is higher only when $\beta <$ `r round(findbeta(high.guess=10,rval=0.5,m=r00m), digits=3)`. Consequently, if females are unable to adjust their parental investment with inbreeding, the consequences of inbreeding depression might be especially severe. 

Biparental investment (work in progress)
------------------------------------------------

We have assumed that a focal female provides exclusive care to offspring. The consequence of relaxing this assumption is straightforward in the case of outbreeding if both females and males pair exactly once in life [i.e., strict monomgamy; see @Parker1985]. In this case, $m^{*}$ will remain unchanged with twice as many offspring produced due to a doubled investment budget $2M$ [@Parker1985]. This is not true given inbreeding because by choosing a male relative, a focal female is necessarily precluding him from mating with another female. Consequently, she will loses any indirect fitness increment she would have otherwise received from him breeding with a different female. In the biparental inbreeding literature, this indirect fitness loss is modelled as an opportunity cost ($\omega$) of the focal male relative [@Waser1986]. To incorporate this cost, it is now necessary to consider both the direct and indirect (through her male relative) fitness consequences of inbreeding explicitly. We assume that if a focal female avoids inbreeding, her male relative will instead outbreed, and that parents invest optimally for any given $\beta$. Therefore, if a focal female avoids inbreeding,

$$\zeta_{\textrm{off}} = \frac{1}{2}\left(1-e^{-c\left(m^{*}_{r=0}-m_{min}\right)}\right).$$ 

If she instead inbreeds,

$$\zeta_{\textrm{off}} = \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m^{*}_{r=r}-m_{min}-\beta r\right)}\right) - \frac{r}{2}\left(1-e^{-c\left(m^{*}_{r=0}-m_{min}\right)}\right).$$ 


<!--- , and that breeding with a male relative does not decrease his opportunities to breed with other females.   --->


Consequences of relaxing these assumptions follow clearly from theory on parental investment [@Parker1985] and biparental inbreeding [@Waser1986]. If instead of providing exclusive care, both females and males pair exactly once in life (true monogamy), then paternal care will have the same optimal value as females ($m^{*}$) with twice as many offspring produced due to a doubled investment budget $2M$ [@Parker1985]. If pairings are not monogamous, then, paradoxically, $m^{*}$ is decreased due to sexual conflict over investment. @Parker1985 shows that an evolutionary stable strategy (ESS) for $m^{*}$ given two parent investment without monogamy $m^{*}_{p}$ is satisfied by,

$$ m^{*}_{p} = \frac{2 \zeta_{\textrm{off}}(m^{*}_{p})}{\zeta'_{\textrm{off}}(m^{*}_{p})}. $$

```{r, echo=FALSE}
findmp <- function(low.guess,high.guess,rval,mmin=1,Beta=1,c=1){
    fm  <- function(m,r=rval){ 
         (2*OffATr(r=rval, mmin=mmin, Beta=Beta, m=m, c=c) / 
            OffATrd(r=rval, mmin=mmin, Beta=Beta, m=m, c=c));
    }
    lg  <- fm(m=low.guess, r=rval);
    if(lg < 0){
        fixlg     <- seq(from=low.guess,to=high.guess,by=0.01);
        move      <- sum(fm(m=fixlg,r=rval) < 0);
        newg      <- fixlg[move+1];
        lg        <- fm(m=newg, r=rval);
    }
    hg  <- fm(m=high.guess,r=rval);
    if(lg > 0){
        u <- low.guess;
        l <- high.guess;
    }else{
        u <- high.guess;
        l <- low.guess;
    }
    if((fm(l) > 0 & fm(u) > 0) | (fm(l) < 0 & fm(u) < 0)){
        return("Value of m is outside the range");
    }else{
        check  <- 1;
        mguess <- 0.5 * (l+u);
        i      <- 0;
        while(abs(check) > 0.000001 & i < 1000000){
            check <- fm(r=rval, m=mguess) - mguess;
            if(check > 0){
                u      <- mguess;
                mguess <- 0.5*(l+mguess); 
            }else{
                l      <- mguess;
                mguess <- 0.5*(u+mguess);
            }
            i <- i+1;
        }
        return(mguess);
    }
} # Running the below returns the estimate
```

ESS values of $m^{*}_{p}$ are always lower than $m^{*}$. In our example where $c=1$, $m_{min}=1$, and $\beta=1$, the value $m^{*}_{p}$ of outbreeding equals `r round(findmp(low.guess=0,high.guess=10,rval=0),digits=3)` compared to $m^{*}=$ `r round(findm(low.guess=0,high.guess=10,rval=0),digits=3)` given single parental care or monogamy. When $r=1/2$, $m^{*}_{p}=$ `r round(findmp(low.guess=0,high.guess=10,rval=0.5),digits=3)` compared to $m^{*}=$ `r round(findm(low.guess=0,high.guess=10,rval=0),digits=3)`. All else being equal, optimal parental investment therefore decreases when both parents contribute but are not monogamous, regardless of inbreeding. It is unclear, however, if this general agreement with @Parker1985 would still be expected for females jointly considering inbreeding strategy and parental investment. <!--- Need to say more about this --->

Assuming again that only females provide care, if a male pays a mating opportunity cost by inbreeding with a female ($\omega$), then the fitness increase of the focal female will decrease proportionally to $r$ such that
<!---
$$\zeta_{\textrm{off}} = \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m-m_{min}-\beta r\right)}\right) - \omega r \frac{1}{2} \left(1-e^{-c\left(m-m_{min})}\right) .$$ 
--->
For simplicity, the above assumes that the male is unrelated to all but the focal female, and therefore only inbreeds once [but see @Duthie2015a]. 

<!--- ===================================================================== --->
<!--- ==================  LEFT OFF HERE =================================== --->
<!--- ===================================================================== --->


Relaxing the assumption of an outbred parent
------------------------------------------------

We have assumed that parents are themselves outbred, but this is not biologically realistic when considering populations in which inbreeding is expected to occur. We therefore consider how the degree to which a focal female is inbred will affect her optimum parental care ($m^{*}$) and rate of increase in fitness ($\gamma^{*}$).

If a focal female is inbred, then the degree to which she is inbred should affect her transmission of identical-by-descent alleles $\left(1/2\right)\left(1+r\right)$, but not inbreeding depression in her offspring $\left(1 - \exp\left[-c\left(m-m_{min}-\beta r\right)\right]\right)$. To separate the effects of a focal female being inbred versus her degree of inbreeding, it is most useful to decompose the coefficient of relatedness $r$ into two parts [see @Hamilton1972; @Michod1979]. The first is the constituent coefficient of kinship $k$, which is the probability that a two randomly sampled homologous alleles between the focal female and her mate are identical-by-descent. The second is the focal female's own inbreeding coefficient $f$ which is the probability that two homologous alleles within the focal female herself are identical-by-descent. The coefficient $r$ can be defined as such,

$$ r = \frac{2k}{1 + f} $$

Relatedness between two individuals is increased by an increase in $k$. Because $k$ is defined by the probability that homologous identical-by-descent alleles are paired between mates, and inbreeding depression is widely assumed to be cause by the pairing of deleterious recessive alleles [@Charlesworth2009], the value of $k$ is relevant for modelling inbreeding depression (and in fact defines an offspring's $f$). In contrast, relatedness between a focal female and a relative is decreased by $f$, but a focal female's $f$ does not directly affect the degree to which deleterious recessive alleles are paired and thus does not contribute to inbreeding depression. To understand how $\zeta_{\textrm{off}}$ is affected by $f$ and $k$, and thereby relax the assumption that a focal female is outbred, it is therefore useful to clarify,

$$\zeta_{\textrm{off}} = \frac{1}{2}\left(1+\frac{2k}{1+f}\right)\left(1-e^{-c\left(m-m_{min}-2\beta k\right)}\right).$$

<!--- One potentially important point: The first expression here is not the same as the expected allele copies in offspring, as in Jane's manuscript. The reason is that Jane was looking at the total identical-by-descent allele copies an offspring has of its parent's. This made sense in the context of the Evolution manuscript, but here we really should be interested in the rate at which IBD alleles are produced in offspring per IBD allele in the parent. This means that we should divide by (1 + f) instead of adding f. The rate of increase is what seleciton should act on. --->

Note that if $f=0$ (the focal female is outbred), then nothing has changed because $r=2k$. Because $f$ does not affect inbreeding depression, and only affects the fitness increment (the first expression $1/2\left[1+r\right]$ previously described), $m^{*}$ is unaffected (see also Appendix 2). The degree to which a female is herself inbred should therefore not affect her parental investment in offspring.

```{r, echo=FALSE}
OffATf <- function(f, k, m, B0=1, B1=1, c=1){
    return( (1/2)*(1+(2*k/(1+f))) * (1 - exp(-c*(m - B0 - 2*B1*k)) ));
}
findmf <- function(low.guess,high.guess,kval,fval,B1=1,c=1,B0=1){
  OffATf <- function(m, f=fval, k=kval, B0=1, B1=1, c=1){
    return( (1/2)*(1+(2*k/(1+f))) * (1 - exp(-c*(m - B0 - 2*B1*k)) ));
  }
  OffATff <- function(m, k=kval, f=fval, B0=1, B1=1, c=1){
    return( 0.5 * (1 + (2 * k/(f + 1))) * (exp(-c * (m - B0 - 2 * B1 * k)) * c) );
  }    
  fm <- function(m, f=fval, k=kval, B0=1, B1=1, c=1){
    OffATff(m=m, f=fval, k=kval, B0=B0, B1=B1, c=c)*(0-m) + 
          OffATf(m=m, f=fval, k=kval, B0=B0, B1=B1, c=c);
  }
  lg  <- fm(m=low.guess, k=kval, f=fval);
  hg  <- fm(m=high.guess,k=kval, f=fval);
  if(lg > 0){
    u <- low.guess;
    l <- high.guess;
  }else{
    u <- high.guess;
    l <- low.guess;
  }
  if((fm(l) > 0 & fm(u) > 0) | (fm(l) < 0 & fm(u) < 0)){
    return("Value of m is outside the range");
  }else{
    check  <- 1;
    mguess <- 0.5 * (l+u);
    i      <- 0;
    while(abs(check) > 0.001 & i < 10000){
        check <- fm(k=kval, f=fval, m=mguess);
        if(check > 0){
          u      <- mguess;
          mguess <- 0.5*(l+mguess); 
        }else{
          l      <- mguess;
          mguess <- 0.5*(u+mguess);
        }
        i <- i+1;
    }
    return(mguess);
  }
} # Running the below returns the estimate
imopt.f000 <- findmf(low.guess=0,high.guess=4,kval=0.25,fval=0.0, B1=1);
imopt.f025 <- findmf(low.guess=0,high.guess=4,kval=0.25,fval=0.25, B1=1);
itang.f000 <- OffATf(m=imopt.f000, f=0, k=0.25, B0=1, B1=1, c=1) / imopt.f000;
itang.f025 <- OffATf(m=imopt.f025, f=0.25, k=0.25, B0=1, B1=1, c=1) / imopt.f025;
omopt.f000 <- findmf(low.guess=0,high.guess=4,kval=0.0,fval=0.0, B1=1);
omopt.f025 <- findmf(low.guess=0,high.guess=4,kval=0.0,fval=0.25, B1=1);
otang.f000 <- OffATf(m=omopt.f000, f=0, k=0.0, B0=1, B1=1, c=1) / omopt.f000;
otang.f025 <- OffATf(m=omopt.f025, f=0.25, k=0.0, B0=1, B1=1, c=1) / omopt.f025;
```

Further, the degree to which a female is inbred should only slightly affect $\gamma^{*}$, and only if $k>0$. If $k=0$, then $\gamma^{*}$ is unaffected because there is no inbreeding depression, so $\gamma^{*}=$ `r round(otang.f025,digits=3)` for all values of $f$ given the previously considered $\beta=1$, $m_{min}=1$, and $c=1$. If instead $k=1/4$ (inbreeding between first order relatives) and $f=1/4$ (the female is the offspring of first order relatives), then a slight decrease in $\gamma^{*}$ is predicted. If $k=1/4$ and $f=1/4$, then $\gamma^{*}=$ `r round(itang.f025,digits=3)`, versus $\gamma^{*}=$ `r round(itang.f000,digits=3)` given $f=0$. The difference between these two curves predicting $\zeta_{\textrm{off}}(m)$ for $f=0$ and $f=1/4$ given $k=1/4$ is shown in the figure below.

```{r, echo=FALSE}
Alleles_IBD_f000 <- OffATf(k=0.25, f=0.0, m=PI, B0=1, B1=1, c=1);
par(mar=c(5,5,2,2));
plot(PI,Alleles_IBD_f000,type="l",lwd=1,ylim=c(0,1),lty="solid",
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(h=0,lty="dotted",lwd=0.8);
Alleles_IBD_f025 <- OffATf(k=0.25, f=0.25, m=PI, B0=1, B1=1, c=1);
abline(b=itang.f000,a=0,lty="solid",lwd=0.5,col="grey40");
abline(b=itang.f025,a=0,lty="solid",lwd=0.5,col="grey40");
polygon(x=c(PI,rev(PI)),y=c(Alleles_IBD_f000,rev(Alleles_IBD_f025)),col="grey70",border=NA);
points(PI,Alleles_IBD_f025,type="l",lwd=1,col="black",lty="solid");
points(PI,Alleles_IBD_f000,type="l",lwd=1,col="black",lty="solid");
yof000 <- OffATf(k=0.25, f=0.0,  m=imopt.f000, B0=1, B1=1, c=1);
yof025 <- OffATf(k=0.25, f=0.25, m=imopt.f025, B0=1, B1=1, c=1);
xline  <- seq(from=1,to=imopt.f000,by=0.001);
points(x=xline,y=rep(yof000,length(xline)),type="l",lwd=1);
points(x=xline,y=rep(yof025,length(xline)),type="l",lwd=1);
yline  <- seq(from=0,to=yof025,by=0.001);
points(x=rep(imopt.f025,length(yline)),y=yline,type="l",lwd=1);
text(x=3.5,y=0.255,labels=expression(paste(italic(m^{"*"}))),cex=1.75);
arrows(x0=3.345,y0=0.205,x1=imopt.f025+0.04,y1=0.01,length = 0.15,angle=30,code=2,lwd=2);
text(x=0.75,y=0.8,labels=expression(paste(italic(f==0))),cex=1.25);
arrows(x0=0.8,y0=0.75,x1=1.1,y1=yof000+0.01,length = 0.15,angle=30,code=2,lwd=2);
text(x=0.67,y=0.35,labels=expression(paste(italic(f==frac(1,4)))),cex=1.25);
arrows(x0=0.87,y0=0.36,x1=1.1,y1=yof025-0.01,length = 0.15,angle=30,code=2,lwd=2);
```

The bottom curve shows $\zeta_{\textrm{off}}(m)$ given $f=1/4$, and the top curve shows $\zeta_{\textrm{off}}(m)$ given $f=0$, with the difference between $\zeta_{\textrm{off}}(m)$ represented by grey shading. Where $m=m^{*}$, $\zeta_{\textrm{off}}$ is slightly higher for $f=0$, meaning that the rate of fitness increase (here, technically, identical-by-descent alleles carried by offspring scaled by their frequency within the parent) is higher for outbred individuals even though optimal investment per offspring has not changed ($m^{*}_{f=0}=m^{*}_{f=1/4}$). Thin grey lines in the figure show tangent lines for each curve. The above figure shows an overall weak effect on $\gamma^{*}$ across a relatively wide range of $f$ (outbred individuals versus individuals of full sibling matings). Consequently, the degree to which an individual is inbred will have a relatively minor effect on its rate of fitness increase.

<!--- It is worth noting that because the optimal amount of parent investment always increases as inbreeding depression becomes more severe (Appendix 2), if increases in $f$ increase inbreeding depression of offspring (e.g., if inbred individuals are less able to), then $m^{*}$ is expected to increase. --->

Discussion
----------------------------------------------

Key points to hit in the Discussion:

* Reiterate that there is no theory addressing how parental investment should affect inbreeding depression [@Pilakouta2015]. 
* If a female inbreeds by choice or necessity, she should make fewer offspring and increase her parental investment in each one.
* Lower offspring production for inbreeding versus outbreeding females does not necessarily reflect consequences of inbreeding depression [e.g, @Liberg2005; @Fredrickson2007].
* If offspring number is fixed, the best strategy might be to inbreed.
* Parent-offspring conflict will be reduced by inbreeding.
* Comparison with selfing literature for optimal seed size.

Appendix 1: Derivations of $m^{*}$ and $\gamma^{*}$
----------------------------------------------

In general, the equation for a line tangent to some function $f$ at the point $a$ is,

$$ y = f'\left(a\right)\left(x-a\right) + f\left(a\right).$$

In the above, $f'(a)$ is the first derivative of $f(a)$, and $y$ and $x$ define the point of interest through which the straight line will pass that is also tangent to $f(a)$. The original function that defines $\zeta_{\textrm{off}}$ is as follows,

$$\zeta_{\textrm{off}} = \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m-m_{min}-\beta r\right)}\right).$$

Differentiating $\zeta_{\textrm{off}}$ with respect to $m$, we have the following,

```{r, echo=FALSE}
fm <- expression(0.5*(1+r)*(1-exp(-c*(m-B0-B1*r))),'m');
fm1 <- D(fm,'m');
```

$$\frac{\partial \zeta_{\textrm{off}}}{\partial m} = \frac{c}{2} \left(1+r\right)e^{-c\left(m-m_{min}-\beta r\right)}. $$

Substituting $\zeta_{\textrm{off}}(m)$ and $\partial \zeta_{\textrm{off}} / \partial m$ and setting $y=0$ and $x=0$ (origin), we have the general equation, 

$$ 0 = \frac{c}{2} \left(1+r\right)e^{-c\left(m-m_{min}-\beta r\right)}\left(0-m\right) + \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m-m_{min}-\beta r\right)}\right). $$

```{r, echo=FALSE}
r00m.y <- OffATr(r=0,  m=r00m, mmin=1, Beta=1, c=1);
r05m.y <- OffATr(r=0.5, m=r05m, mmin=1, Beta=1, c=1);
```

A solution for $m^{*}$ can be obtained numerically for the example in which $m_{min}=1$, $\beta=1$, and $c=1$. If $r=0$, $m^{*}_{r=0}=$ `r round(r00m,digits=2)`, and if $r=1/2$, $m^{*}_{r=1/2}=$ `r round(r05m,digits=2)`. Solutions for the slopes defining $\gamma^{*}_{r=0}$ and $\gamma^{*}_{r=1/2}$ can be obtained by finding the straight line that runs through the two points $(0,0)$ and $(m^{*}$ , $\zeta_{\textrm{off}}(m^{*}))$. In the case of $r=0$, $\zeta_{\textrm{off}}(m^{*})=$ `r round(r00m.y,digits=2)`, so we find, $\gamma^{*}_{r=0}=$ (`r round(r00m.y,digits=2)` $- 0$) $/$ (`r round(r00m,digits=2)` $- 0$) = `r round(r00g,digits=2)`. In the case of $r=1/2$, $\zeta_{\textrm{off}}(m^{*})=$ `r round(r05m.y,digits=2)`, so we find, $\gamma^{*}_{r=1/2}=$ (`r round(r05m.y,digits=2)` $- 0$) $/$ (`r round(r05m,digits=2)` $- 0$) = `r round(r05g,digits=2)`. 

Appendix 2: $m^{*}$ increases with increasing $r$
----------------------------------------------

Here we show that optimal parental investment always increases with increasing inbreeding given inbreeding depression and $c>0$. Because we are only interested in the sign of this increase, it will be sufficient to show that $\partial r / \partial m^{*} > 0$ given $\beta>0$ and $c>0$. 

First, we note that $m^{*}$ is defined as the value of $m$ that maximises the rate of increase in $\zeta_{\textrm{off}}$ for a female. This is described by the line that passes through the origin and lies tangent to $\zeta_{\textrm{off}}(m)$. As in Appendix 1, we have the general equation for which $m=m^{*}$,

$$ 0 = \frac{c}{2} \left(1+r\right)e^{-c\left(m-m_{min}-\beta r\right)}\left(0-m\right) + \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m-m_{min}-\beta r\right)}\right). $$

We first substitute $m=m^{*}$ and note that this equation reduces to,

$$ 0 = c e^{-c\left(m^{*}-m_{min}-\beta r\right)}\left(0-m^{*}\right) + \left(1-e^{-c\left(m^{*}-m_{min}-\beta r\right)}\right). $$

This simplification dividing both sides of the equation by $(1/2)(1+r)$ has a biological interpretaion that is relevant to parental investment. Optimal parental investment does not depend directly on the uniform increase in $\zeta_{\textrm{off}}$ caused by $r$ in $(1/2)(1+r)$, the change in $m^{*}$ is only affected by $r$ insofar as $r$ affects offspring fitness directly through inbreeding depression. Ideally, we would isolate $m$ to find $\partial m^{*} / \partial r$, but this is not possible. Instead, the above equation can be simplified further to isolate $r$ and show that $\partial r / \partial m^{*} > 0$,

$$ 0 = -m^{*} c e^{-c\left(m^{*}-m_{min}-\beta r\right)} + 1-e^{-c\left(m^{*}-m_{min}-\beta r\right)}. $$

$$ 1 = m^{*} c e^{-c\left(m^{*}-m_{min}-\beta r\right)} + e^{-c\left(m^{*}-m_{min}-\beta r\right)}. $$

$$ 1 = e^{-c\left(m^{*}-m_{min}-\beta r\right)} \left(1 + m^{*} c\right) $$

$$ e^{-c\left(m^{*}-m_{min}-\beta r\right)} = \frac{1}{\left(1 + m^{*} c\right)} $$

$$ -c\left(m^{*}-m_{min}-\beta r\right) = \ln\left(\frac{1}{\left(1 + m^{*} c\right)}\right) $$

$$ m^{*}-m_{min}-\beta r = -\frac{1}{c}\ln\left(\frac{1}{\left(1 + m^{*} c\right)}\right) $$

$$ \beta r = m^{*} - m_{min} + \frac{1}{c}\ln\left(\frac{1}{\left(1 + m^{*} c\right)}\right) $$

$$ r = \frac{1}{\beta}\left(m^{*} - m_{min} + \frac{1}{c}\ln\left(\frac{1}{\left(1 + m^{*} c\right)}\right)\right) $$

We now differentiate $r$ with respect to $m^{*}$,

```{r, echo=FALSE}
rrmm  <- expression((1/beta)*(mopt-mmin+(1/c)*log(1/(mopt*c+1))),'mopt');
# We can use the above to differentiate fm wrt `m`
drdm <- D(rrmm,'mopt'); # can print fmd to show solution
# Note that drdm simplifies considerably from what R produces
```

$$ \frac{\partial r}{\partial m^{*}} = \frac{m^{*} c}{\beta \left(m^{*} c + 1\right)} $$

Given the above, $\partial r / \partial m^{*} > 0$ assuming $\beta>0$ (inbreeding depression), $c>0$ (offspring fitness increases with parental investment), and $m^{*}>0$ (optimum parental investment is positive). These assumptions are biologically realistic; we therefore conclude that the positive association between optimal parental investment ($m^{*}$) and inbreeding ($r$) is general. As inbreeding increases, so should optimal parental investment in offspring.

Appendix 3: Consistency with biparental inbreeding models
----------------------------------------------

It is trivial to show that a female that inbreeds with a first order relative ($r=1/2$) has a higher fitness than a female that outbreeds ($r=0$) given $m_{min}=1$, $\beta=1$, and $c=1$ at optimal values of $m^{*}_{r=1/2}$ and $m^{*}_{r=0}$. To do this, we define $\delta_{r}$ as follows,

$$ \delta_{r} = e^{-c(m^{*}_{r}-m_{min}-\beta r)}. $$

In biparental inbreeding models [e.g., @Kokko2006; @Parker2006; @Duthie2015a], it is assumed that $\delta_{r=0}=0$ for outbred offspring, but this is not the case in our model because $\delta_{r=0}$ will also depend on parental investment. Fitness from inbreeding to any degree $r$ can be determined by,

$$ W_{r} = \frac{n}{2}\left(1+r\right)\left(1-\delta_{r}\right). $$

By definition, $n = M/m$, so $n$ is the total number of offspring a female produces. Biparental inbreeding models assume that this value is constant, but $n$ will scale linearly with $m$ because females that invest more in each offspring (high $m$) will produce fewer total offspring (low $n$). To account for this, we can simply substitute $M/m$ for $n$ to scale for offspring produced,

$$ W_{r} = \frac{M}{2 m}\left(1+r\right)\left(1-\delta_{r}\right). $$

Fitness given $r=0$ and $r=1/2$, and $m^{*}_{r=0}$ and $m^{*}_{r=1/2}$, can be determined by substituting some constant value for $M$ (here for simplicity, assume $M=1$), as the magnitude of $n$ will not affect relative fitness differences. 

To show that inbreeding with first order relatives returns a higher fitness than outbreeding given the above conditions assumed in our model, we can simply use the above equation directly to compare the fitness given both $r=1/2$ and $r=0$, noting that $\delta_{r=1/2}=0.26$ and $\delta_{r=0}=0.32$ (note that $\delta_{r=1/2}<\delta_{r=0}$ because inbreeding parents are investing more in their offspring, $m^{*}_{r=1/2}=$ `r round(r05m,digits=2)` versus $m^{*}_{r=0}=$ `r round(r00m,digits=2)`). Consequently, we can use the above equation to show that the fitness gain of an optimally investing female that inbreeds with a first order relative is `r round((1/(r05m*2))*(1+0.5)*(1-exp(-1*(r05m - 1 -1*0.5))),digits=2)`, compared with `r round((1/(r00m*2))*(1+0.0)*(1-exp(-1*(r00m - 1 -1*0.0))),digits=2)` for the outbreeding female; these values are identical to our earlier calculated values of $\gamma^{*}_{r=1/2}$ and $\gamma^{*}_{r=0}$.

<!--- Note that we can expand this -- n * (\zeta_{\textrm{off}} / m) --->

Thoughts in progress
----------------------------------------------

Note that we can formulate the optimal contribution for an individual parent $m_{p}^{*}$ as the value of m that satisfies the following [see @Parker1985],

$$m = \frac{2 \zeta_{\textrm{off}}(m)}{\partial \zeta_{\textrm{off}}(m) / \partial m}$$


References
----------------------------------------------

<!---

```{r, echo=FALSE}
beteq <- 2.335264; # eyeballed then found this value
m00eq <- 2.146187; # Iteratively found these values
m05eq <- 3.719273;
r00eq <- OffATr(r=0,  m=m00eq,Beta=beteq,mmin=1,c=1);
r05eq <- OffATr(r=0.5,m=m05eq,Beta=beteq,mmin=1,c=1);
g00eq <- r00eq / m00eq;
g05eq <- r05eq / m05eq;
```


It is interesting to note that when $\beta \approx$ `r round(beteq,digits=3)`, and both outbreeding parents ($r=0$) and parents that inbreed with siblings ($r=1/2$) invest at their optimum $m^{*}$ ($m^{*}_{r=0} \approx$ `r round(m00eq,digits=3)` and $m^{*}_{r=1/2} \approx$ `r round(m05eq,digits=3)`), both parents have an equal value of $\gamma^{*} \approx$ `r round(g00eq,digits=3)`. Importantly, $m^{*}_{r=0}$ and $m^{*}_{r=1/2}$ values cannot simply be plugged into the above equations to compare with biparental inbreeding models because the number of offspring produced (typically denoted $n$ in biparental inbreeding models) will change with $m^{*}$ in our model (outbred offspring will produce ca `r round(m05eq/m00eq,digits=3)` more offspring than full siblings when $\beta \approx$ `r round(beteq,digits=3)`.

Note that `r exp(-1*(3.719-1-2.335*0.5)) / exp(-1*(2.146-1-2.335*0))` is the threshold expected for males, not females. Is this because females no longer produced a fixed number of offspring, but can instead adjust? Doubtful, because they still have fixed resources

--->


<!---

Very brief summary
----------------------------------------------

There is clearly more work to do with the analysis, but I am optimistic that a manuscript can be written from this model that makes two key interesting points:

1. Parental investment should increase -- and fewer offspring should be produced -- given increasing parental inbreeding (all else being equal, of course).

2. The inclusive fitness gain associated with inbreeding to a particular degree, or with outbreeding, can be described by a straight line that passes through the origin and is tangent to $\zeta_{\textrm{off}}(m)$ for any set of parameter values. This is how fitness is described in other models of parental care [@Macnair1978; @Parker1978], and the concept can be used to relate inclusive fitness from inbreeding versus avoiding inbreeding across different magnitudes of parental investment ($m$).

In addition to the theoretical knowledge gained from the two above points, the above (1) could lead to interseting empirical hypotheses relating parental care to inbreeding. Even (2) could be used to develop empirical hypotheses (though this would seem more challenging) across systems with different degrees of inbreeding and parental investment. My inclination is to say that a manuscript based on the above could make a strong contribution to the *Journal of Theoretical Biology*, but it would probably be possible to shoot a bit higher (e.g., *Proceedings B*).

> **ADDED NOTE** This work could have implications for quantitative estimates of parental care. If, for example empirical studies do not account for inbreeding, they might underestimate the amount of parental care that should be provided to offspring. Alternativley, changing environment might or inbreeding behaviour might then feedback to affect parental care provided. Implications for cooperative breeding if high inbreeding increases parental care.

--->

<!---  The below code is useless, see point below: no optimal beta possible
```{r, echo=FALSE}
find.Beta <- function(lg,hg,mstari,mstaro,cvl=1,mmin=1,rval=0.5){
    Ir <- function(Beta, m=mstari, cvl=cvl, mmin=mmin, rval=rval){
        return( 0.5*(1+rval)*(1-exp(-cvl*(m-mmin-rval*Beta))) );
    }
    oD <- exp(-cvl*(mstaro-mmin-0.0));
    Of <- Ir(Beta=0, m=mstaro, cvl=cvl, mmin=mmin, rval=0);
    uu <- Ir(Beta=lg, m=mstaro, cvl=cvl, mmin=mmin, rval=rval);
    ll <- Ir(Beta=hg, m=mstaro, cvl=cvl, mmin=mmin, rval=rval);
    if((ll > Of & uu > Of) | (ll < Of & uu < Of)){
        return("Value of m is outside the range");
    }else{
        check  <- 1;
        mguess <- 0.5 * (lg+hg);
        i      <- 0;
        while(abs(check) > 0.001 & i < 10000){
            check <- Ir(Beta=mguess, m=mstaro, cvl=cvl, mmin=mmin, rval=rval) - Of;
            if(check < 0){
                hg     <- mguess;
                mguess <- 0.5*(lg+mguess); 
            }else{
                lg     <- mguess;
                mguess <- 0.5*(hg+mguess);
            }
            i <- i+1;
        }
        return(mguess);
    }
} # Running the below returns the estimate
est <- find.Beta(lg=0,hg=5,mstari=2.85,mstaro=2.15);
```
--->
<!--- Note, we can find the $\beta$ that would given equal fitness for r=0 and r=0.5, thereby getting to the thresholds of Parker models, but as $\beta$ changes, so does $m^{*}$, so it's not a simple matter of tweaking $\beta$. Instead, need to write a function that optimises both optimal investment and inbreeding depression to reach a given fitness equal to that of an outbred female -> Tried this, can't do it because as inbreeding depression increases, so does the optimal investment in offspring, so the two diverge. We therefore can't find optimise both 'm' and 'beta' to find equivalents to outbred offspring. We really are just stuck with tangent lines. ---> 




<!--- =========== OLD TEXT THAT MIGHT STILL BE USEFUL ======================== --->


<!--- Tangent line ``maximises the number of surviving offspring per unit investment'' @Kuijper2012 --->

<!---  As $m \to \infty$, inbred offspring **always** have the same direct fitness (and therefore higher $\zeta_{\textrm{off}}$ due to IBD alleles) as their outbred counterparts; in other words, **I assume that sufficient parental investment can *always* compensate for being inbred** (though the amount of PI required might be extremely high). --->

<!--- First I define an equation describing the proportion of identical-by-descent allele copies of a parent (assume female) in its offspring that make it into the next generation ($\zeta_{\textrm{off}}$). As such, the below equation accounts for the inclusive fitness increment associated with inbreeding, along with inbreeding depression. It also models direct offspring fitness as a function of parental investment. The equation takes a similar form to previous models of parental investment and inclusive fitness models of biparental inbreeding,

The expression $\left(1/2\right) \left(1 + r\right)$ is the proportion of identical-by-descent alleles in **one** offspring of the parent providing parental care (again, just assume female for now; note that there is no $n$ representing offspring number, yet -- for the moment, we are only looking at the proportion of alleles passed in one focal offspring). The expression $\left(1 - \exp\left[-c\left(m-m_{min}-\beta r\right)\right]\right)$ is the individual offspring's direct fitness (e.g., in terms of survival) as a function of parental care ($m$), the minimum parental care required for a viable offspring ($m_{min}$, which can also be interpreted as the amount of load in the population not due to inbreeding -- this might require a constant to scale appropriately, but the concept should be the same), log-linear slope of inbreeding depression ($\beta$), and a parameter that affects the curve of parental investment with respect to fitness ($c$; i.e., how 'diminishing' are the returns on $\zeta_{\textrm{off}}$ from increasing $m$). There are a few things worth noting right away: --->

<!--- This model considers a focal parent (just assume it is outbred and female, to keep things simple for now) that has offspring that can be inbred to some degree, and she must decide how much parental investment to make to maximise the number of identical-by-descent alleles contributed to her offspring. --->
<!--- The parameter $m$ is not simply raw resources provided to an offspring. Rather, it is the amount of parental investment provided that **could otherwise have been invested in other offspring**. In other words, assuming parents have a total amount of investment that they can provide, and that amount must be divided among offspring, $m$ is the amount provided to the one offspring of interest that is taken away from the production of, or investment in, siblings of the offspring (for now, I implicity assume no mixed broods -- females apply $m$ to offspring that are equally inbred or outbred). --->
<!--- When $r=0$ and $\beta =0$ (outbred offspring), the above equation collapses back down to standard models of parental investment [e.g., @Macnair1978; @Parker1978], but with the usual parameter $K$ being replaced by $1/2$, and thereby specifying IBD alleles transmitted to offspring instead of some arbitrary metric of offspring fitness. --->
<!--- When $c=-1$ and $m=0$, the model collapses back down to the version of Parker's [-@Parker1978] model presented in @Duthie2015a. This is elegant, but it is worth pointing out that, conceptually, there is no 'standard' amount of parental care provided in biparental inbreeding models (and therefore no real way, that I can see, to completely anchor to them; i.e., this is probably as mathematically elegant as it can get). Really, at $m=0$, offspring fitness should always be zero because no investment is provided. It is only the $-c$ that flips things back around so that the model can collapse and mirror that of @Duthie2015a -- otherwise, $\zeta_{\textrm{off}}$ would **always** be negative (biologically interpreted as zero fitness). As $m \to \infty$, inbred offspring **always** have the same direct fitness (and therefore higher $\zeta_{\textrm{off}}$ due to IBD alleles) as their outbred counterparts; in other words, **I assume that sufficient parental investment can *always* compensate for being inbred** (though the amount of PI required might be extremely high).  ---> <!--- [**NOTE:**, actually, the collapse is not entirely clean because in @Duthie2015a we defined $\exp\left(-m_{min}-\beta r\right) = \left(1-\delta\right)$, meaning that really the exponent above is more like $\delta$, representing the degree of inbreeding depression -- not survival. Not sure how this will affect some of the interpretation below in relation to previous biparental inbreeding models, but conceptually this still works for a given $\beta$. I have some initial concern when differentiating $\zeta_{\textrm{off}}$ with respect to $r$ -- the concavity of this function appears to be the opposite of what we would want, but this should not affect the general conclusions below, I do not think.]   <span style="color:red">  **NOTE AGAIN** Really, to shoehorn the biparental inbreeding model, it really should be that $\left(1 - \exp\left[-c\left(m-m_{min}-\beta r\right)\right]\right) = \left(1-\delta\right)$. This kind of makes sense, actually.]</span> --->

<!--- ==============================================================

> **CONJECTURE**: The tangent of a curve $\zeta_{\textrm{off}}(m)$ with respect to the origin determines optimal offspring produced and PI per offspring. Upon inspection, it is obvious that optimal PI is higher when $r$ is higher. Therefore, **when inbreeding, it might be beneficial to invest more in fewer offspring**. 

A biological implication of the above conjecture (the conjecture will be demonstrated more carefully below) might be that parents that inbreed will be expected to produce fewer offspring -- not necessarily because the inbreeding parents (or the inbred offspring) are *low quality*, but because the best strategy for maximising their own inclusive fitness is to invest more in a smaller number of offspring rather than invest less in a lot of offspring (note, will want to think about how the distribution of relatedness and fecundity interact, but for now we can just look at the key concept). 

Alternatively, if parents have a fixed clutch size, for whatever reason (e.g., only four eggs fit in a nest or burrow, or something -- as long as the reason is independent of the parent's $m$, I think it works), it might be beneficial to produce inbred offspring. Intuitively, this would be caused by a parent that has more to invest, but cannot use that extra $m$ to make more offspring, so it shifts to producing inbred offspring that now have the same direct fitness as outbred offspring -- or, at least, lower fitness, but are expected to pass more alleles identical-by-descent.

============================================================== --->

<!--- **The above points are only some potential ideas, but we need to analyse the model to really understand what it predicts.** Note again that the tangent of the curve $\zeta_{\textrm{off}}(m)$ with respect to the origin identifies the optimum amount of investment for a particular offspring *given a degree of inbreeding*. This does not by itself say anything about how much inbreeding an individual should do given some degree of inbreeding depression -- but this should be something we can figure out (I will do this below). Intuitively, if there is no inbreeding depression, a focal female should always inbreed -- the same amount of PI will yield a higher $\zeta_{\textrm{off}}$ every time due the positive increment of $r$ and zero value of $\beta$ in the above equation. Also intuitively, if inbreeding depression is severe, then inbred offspring will simply not be viable (aside: consider defining a maximum $m$?). Between the two, there should be some way to find the $r$ and $m$ that maximises $\zeta_{\textrm{off}}$ for a given $\beta$, but some care needs to be exercised in biological interpretations of this. In any case, **there seem to be at least two interesting concepts to flesh out here:** --->

<!--- 1. How the optimum amount of parental investment varies with a parent's degree of inbreeding.
2. What the optimal combination of inbreeding and parental investment is for maximising the number of identical-by-descent alleles a parent leaves in their offspring. --->

<!--- What follows is some progress in fleshing out the two above points, and generally analysing the above model. Below is the equation defined in R, which can be used as a starting point for the analysis. --->

<!--- As a starting point, we can plot the relationship between $m$ (x-axis) and $\zeta_{\textrm{off}}$ (y-axis) in the figure below, given that a focal female outbreeds ($r=0$) and the minimum $m$ for a viable offspring ($m_{min}$) is $1$; set $c=1$. --->

<!---
``{r, echo=FALSE}
PI <- seq(from=0,to=4,by=0.01);
Alleles_IBD_outbr <- OffAT(r=0, m=PI, B0=1, B1=1, c=1);
par(mar=c(5,5,2,2));
plot(PI,Alleles_IBD_outbr,type="l",lwd=3,ylim=c(0,1),
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(h=0,lty="dotted",lwd=0.8);
``
--->

<!--- The general shape of this curve is the same as described from previous models of parental investment [e.g., @Macnair1978; @Parker1978]. Note that the slope crosses the x-axis at $m=1$, the miminum parental investment for viable offspring. As $m$ increases, the direct fitness of offspring increases, asymptotically approaching a direct fitness of $1$. Because outbred offspring share $1/2$ of their alleles IBD with the focal parent, the value of $\zeta_{\textrm{off}}$ therefore approaches $1/2$ as $m \to \infty$. Note that we can change the shape of this curve by adjusting $c$, increasing the rate at which $\zeta_{\textrm{off}}$ approaches $1/2$ (increasing $c$), or decreasing the rate at which it approaches $1/2$ (decreasing $c$). Note also that if we increase $r$ but not $\beta$ (inbreeding, but no inbreeding depression), such that $r=1/2$ and $\beta =0$, $\zeta_{\textrm{off}}$ is higher for all values of $m>m_{min}$ than when $r=0$, as reflected by the plotted red line below. --->

<!---
``{r, echo=FALSE}
par(mar=c(5,5,2,2));
plot(PI,Alleles_IBD_outbr,type="l",lwd=3,ylim=c(0,1),
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(h=0,lty="dotted",lwd=0.8);
Alleles_IBD_inbr <- OffAT(r=0.5, m=PI, B0=1, B1=0, c=1);
points(PI,Alleles_IBD_inbr,type="l",lwd=3,col="red");
``
--->


<!--- Note that the red line asymptotes to the value of $\left(1/2\right)\left(r+1\right)=3/4$ as $m \to \infty$. Also note, however, that the optimal $m$ is probably identical (tangent line appears to hit the curve at around the same place), which would make biological sense (as long as all the offspring in a clutch are equally related, there does not seem to be any intuitive reason why a female should shift to investing more in fewer offspring -- or vice versa -- in the absence of inbreeding depression). This is a good thing, but needs to be confirmed through analysis (*note*, analysis described below confirms that both curves have an optimum of $m=2.146193$). --->

<!--- Before proceeding with such an analysis, I will consider one more simple case in which there exists some inbreeding depression, $\beta =1$. All other parameters will be kept the same for now. The red line below now compares how $\zeta_{\textrm{off}}$ changes with $m$ given the same degree of inbreeding $r=1/2$ as above, except now with inbreeding depression. --->

<!---
``{r, echo=FALSE}
OffAT <- function(r, m, B0=1, B1=1, c=1){
    return( (1/2)*(1+r) * (1 - exp(-c*(m - B0 - B1*r)) ));
}
``
--->
<!---
``{r, echo=FALSE}
par(mar=c(5,5,2,2));
plot(PI,Alleles_IBD_outbr,type="l",lwd=3,ylim=c(0,1),
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(h=0,lty="dotted",lwd=0.8);
Alleles_IBD_inbr <- OffAT(r=0.5, m=PI, B0=1, B1=1, c=1);
points(PI,Alleles_IBD_inbr,type="l",lwd=3,col="red");
``
--->


<!--- The tangent lines to the curves appear to hit $m$ at different places, lower $m$ for the outbred offspring, indicating an optimal strategy of producing more offspring and investing less in each, compared to inbreeding. The slope of the tangent line would also appear to be slightly greater for the inbred (red) case, which would indicate (as in the previous example where $\beta =0$), I think, higher fitness is possible overall due to inbreeding. --->

<!--- So the way to analyse this is to consider the lines that pass through the origin and are tangent to the curves produced by this model -- I believe that that three concepts can be illustrated visually in this way (which I hope to come back to with these same two examples): --->

<!--- 1. For slopes where the lines run through the origin and are tangent to the curves, the point at which the two touch represents the optimal $m$ for maximising fitness (assuming as many offspring will be presented as possible with $m$ invested in each offspring). This is not new, and has already been shown by @Macnair1978, and by @Parker1978, but leads into point 2 below. --->

<!--- 2. How optimal $m$ differs for different degrees of inbreeding ($r$) and inbreeding depression ($\beta$). This is described, as mentioned in 1 above, by the point on the x-axis where the line running from the origin is tangent to the curve. This by itself is interesting, and my intuition from both the equation and the plots is that optimal $m$ will be directly affected by $\beta$, but not $r$ (*note*, analysis confirms). --->

<!--- 3. How fitness can be maximised by inbreeding and parental investment jointly. This will be determined, I believe, by maximising the *slope* of the line that runs through the origin that lies tangent to the curves. The results of @Parker1979 and @Duthie2015a should also pop out of this (*note*, they sort of do) -- where inbreeding increases inclusive fitness more than inbreeding avoidance, the slope of this line should be greater. In other words, we should be able to find the inbreeding thresholds from @Duthie2015a for females and -- *I think* -- demonstrate that at those thresholds, the slope of the lines will be **identical** (*note*, it is *slightly* more complicated than this, see below). Note, this is a bit more difficult than it sounds because the thresholds were discussed in terms of coefficients of kinship rather than relatedness (*note*, not really an issue, actually), but a translation should be possible. To me, this would be a beautiful conceptual link between the two models (*note*, it is pretty cool). ---> 


<!---
``{r, echo=FALSE}

findm <- function(low.guess,high.guess,rval,B1=1,c=1){
  fm  <- function(m,r) OffAT1(r=rval, B1=B1, m=m, c=c)*(0-m) + OffAT(r=rval, B1=B1, m=m, c=c);
  lg  <- fm(m=low.guess, r=rval);
  hg  <- fm(m=high.guess,r=rval);
  if(lg > 0){
    u <- low.guess;
    l <- high.guess;
  }else{
    u <- high.guess;
    l <- low.guess;
  }
  if((fm(l) > 0 & fm(u) > 0) | (fm(l) < 0 & fm(u) < 0)){
    return("Value of m is outside the range");
  }else{
    check  <- 1;
    mguess <- 0.5 * (l+u);
    i      <- 0;
    while(abs(check) > 0.001 & i < 10000){
        check <- fm(r=rval, m= mguess);
        if(check > 0){
          u      <- mguess;
          mguess <- 0.5*(l+mguess); 
        }else{
          l      <- mguess;
          mguess <- 0.5*(u+mguess);
        }
        i <- i+1;
    }
    return(mguess);
  }
} # Running the below returns the estimate

findm(low.guess=0,high.guess=4,rval=0.0, B1=1.785148);

``
--->

<!---

Below begins my attempt to analyse the model a bit. 

******************************

Initial analysis
------------------------------------------------

Starting again with the original equation,

$$\zeta_{\textrm{off}} = \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m-m_{min}-\beta r\right)}\right).$$

We can differentiate $\zeta_{\textrm{off}}$ with respect to $m$ using R. Instead of using the above R function (`OffAT`), I will define `fm` as an expression in R.

``{r}
fm <- expression(0.5*(1+r)*(1-exp(-c*(m-B0-B1*r))),'m');
``

We can find the first derivative as follows.

``{r}
fm1 <- D(fm,'m');
print(fm1);
``

More clearly written, we have the following,

$$\frac{\partial \zeta_{\textrm{off}}}{\partial m} = \frac{c}{2} \left(1+r\right)e^{-c\left(m-m_{min}-\beta r\right)}. $$

This is intuitive, but it is nice to have R verify. We can do the same for the second derivative (which we will not need for the anaylsis, but it helps sometimes write out and visualise).

``{r}
fm2 <- D(D(fm , 'm'),'m');
print(fm2);
``

Again, more clearly written, we have the following,

$$\frac{\partial^{2} \zeta_{\textrm{off}}}{\partial m^{2}} = \frac{-c^{2}}{2}\left(1+r\right) e^{-c\left(m - m_{min} - \beta r\right)}.  $$

This also is also fairly straightforward, but it helps to plot these functions to make sure that they look sensical. In the case of the above, we can go back to the simple case where $r=0$, $m_{min}=1$, and $c=1$ (note, it does not matter what we set $\beta$ to if $r=0$, so $\beta =1$ is fine).

``{r, echo=FALSE}
OffAT1 <- function(r, m, B0=1, B1=1, c=1){
    return(  0.5 * (1 + r) * (exp(-c * (m - B0 - B1 * r)) * c)  );
    return(  (c/2)*(1+r)*exp(-c*(m-B0-B1*r))  );
}
OffAT2 <- function(r, m, B0=1, B1=1, c=1){
    return(  -(0.5 * (1 + r) * (exp(-c * (m - B0 - B1 * r)) * c * c))  );
}
Alleles_IBD_outbr  <- OffAT(r=0, m=PI, B0=1, B1=1, c=1);
par(mar=c(5,5,2,2));
plot(PI,Alleles_IBD_outbr,type="l",lwd=3,ylim=c(-1,1),
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(h=0,lty="dotted",lwd=0.8);
Alleles_IBD_outbr1 <- OffAT1(r=0, m=PI, B0=1, B1=1, c=1);
points(PI,Alleles_IBD_outbr1,type="l",lwd=3,col="black",lty="dashed");
Alleles_IBD_outbr2 <- OffAT2(r=0, m=PI, B0=1, B1=1, c=1);
points(PI,Alleles_IBD_outbr2,type="l",lwd=3,col="black",lty="dotted");
``

In the above, the dashed line plots the partial derivative of $\zeta_{\textrm{off}}$ with respect to $m$, and the dotted line plots the second partial derivative. This all appears to checkout, so I think I can proceed with confidence in finding the line that lies tangent to the curve that also passes through the origin. In general, the equation for a line tangent to some function $f$ at the point $a$ is,

$$ y = f'\left(a\right)\left(x-a\right) + f\left(a\right).$$

Applying this to the above, we have the general line,

$$ y = \frac{c}{2} \left(1+r\right)e^{-c\left(m-m_{min}-\beta r\right)}\left(x-m\right) + \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m-m_{min}-\beta r\right)}\right). $$

Substituting the parameters of interest, this simplifies considerably,

$$ y = \frac{1}{2} \left(1+0\right)e^{-1\left(m-1-\left(1\right)0r\right)}\left(x-m\right) + \frac{1}{2}\left(1+0\right)\left(1-e^{-1\left(m-1-\left(1\right)0r\right)}\right), $$

which reduces to,

$$ y = \frac{1}{2} e^{-\left(m-1\right)}\left(x-m\right) + \frac{1}{2}\left(1-e^{-\left(m-1\right)}\right). $$

The line needs to pass through the origin, so we want to solve for $m$ given $y=0$ and $x=0$, so we set $x$ and $y$ values as such below,

$$ 0 = \frac{1}{2} e^{-\left(m-1\right)}\left(0-m\right) + \frac{1}{2}\left(1-e^{-\left(m-1\right)}\right). $$

The nicest way we can simplify this is,

$$ 0 = e^{-\left(m-1\right)} - \frac{1}{m+1}. $$

We can plot the right hand side of the above equation across different values of $m$, and the unsimplified version before it. What we are looking for is the value of $m$ that equals zero on the y-axis.

``{r, echo=FALSE}
fmlong  <- function(m) 0.5*exp(-(m-1)) * (0-m) + 0.5*(1-exp(-(m-1)));
fmshort <- function(m) exp(-(m-1))-(1/(m+1));
x       <- seq(from=0,to=4,by=0.001);
plot(x=x,y=fmlong(x),type="l",lwd=3,xlab="m value",ylab="y value");
points(x=x,y=fmshort(x),type="l",lwd=3,lty="dashed");
abline(h=0,lty="dotted");
``

Clearly, the value of $m$ we are looking for is slightly greater than $2$; we can get a more precise value by solving numerically (as an analytical solution does not seem possible -- isolating $m$ is not going to work). The R code below is probably overkill (I suspect it can be written more cleanly too, but it does the job), but writing something like it might be useful later on when there are other values for which we need to solve numerically (*note*, did this, and a general `findm` function is useful).


``{r}
findm <- function(low.guess,high.guess){
  fm  <- function(m) exp(-(m-1)) - (1/(m+1));
  lg  <- fm(low.guess);
  hg  <- fm(high.guess);
  if(lg > 0){
    u <- low.guess;
    l <- high.guess;
  }else{
    u <- high.guess;
    l <- low.guess;
  }
  if((fm(l) > 0 & fm(u) > 0) & (fm(l) < 0 & fm(u) < 0)){
    return("Value of m is outside the range");
  }else{
    check  <- 1;
    mguess <- 0.5 * (l+u);
    i      <- 0;
    while(abs(check) > 0.001 & i < 10000){
        check <- fm(mguess);
        if(check > 0){
          u      <- mguess;
          mguess <- 0.5*(l+mguess); 
        }else{
          l      <- mguess;
          mguess <- 0.5*(u+mguess);
        }
        i <- i+1;
    }
    return(mguess);
  }
} # Running the below returns the estimate
findm(low.guess=0,high.guess=4);
``


We now have our value of interest. This is the optimal value of $m$, which is the amount of parental investment that maximises IBD allele copies produced in offspring. Above this value of $m$, females invest too much in their offspring when they should instead produce more offspring with less parental care. Below this value of $m$, females do not invest enough in their offspring and produce too many offspring with too low of direct fitness.

Now, it is useful to find the *slope* ($\gamma$) of the line tangent to the curve at the optimal $m$ that passes through the origin. The slope of this line will be the rate of increase in fitness for the parent. Higher values mean more total IBD allele copies in the offspring of a female parent. Finding $\gamma$ is trivial; because the line is straight, we just need two sets of points. The first set is the origin at $(0,0)$. The second is the value of $m$ we just calculated, and $\zeta_{\textrm{off}}(m)$ from the original function,

``{r}
OffAT(r=0, m=2.146193, B0=1, B1=1, c=1);
``

We now have the point on the y-axis that we need. The slope of the line tangent to our original function is simply,

$$ \gamma = \frac{0.3410777 - 0}{2.146193 - 0} = 0.1589222 $$

We can plot the tangent line against our original function to confirm this visually,

``{r, echo=FALSE}
PI <- seq(from=0,to=4,by=0.01);
Alleles_IBD_outbr <- OffAT(r=0, m=PI, B0=1, B1=1, c=1);
par(mar=c(5,5,2,2));
plot(PI,Alleles_IBD_outbr,type="l",lwd=3,ylim=c(0,1),
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(a=0,b=0.1589222,lwd=2,lty="dashed");
abline(h=0,lty="dotted",lwd=0.8);
``

We now have the optimum parental investment ($m$) and the rate of fitness increase ($\gamma$) for an outbreeding ($r=0$) female given minimum parental care for viable offspring of $m_{min}=1$, inbreeding depress of $\beta =1$ (irrelevant here due to outbreeding), and $c=1$. Using the same procedure as above, we can find the optimum $m$ and its corresponding $\gamma$ for a female that inbreeds with a full sibling $r=1/2$. This requires the more general function `OffAT` be used, and its derivative `OffAT1`,

``{r}
OffAT <- function(r, m, B0=1, B1=1, c=1){
    return( (1/2)*(1+r) * (1 - exp(-c*(m - B0 - B1*r)) ));
}
OffAT1 <- function(r, m, B0=1, B1=1, c=1){
    return(  (c/2)*(1+r)*exp(-c*(m-B0-B1*r))  );
}
``
When we use these functions to solve for the general formula $y=f'(a)(x-a)+f(a)$ when $r=1/2$, we get a slightly higher value of $m$.

``{r, echo=FALSE}
findm <- function(low.guess,high.guess,rval){
  fm  <- function(m,r) OffAT1(r=rval, m=m)*(0-m) + OffAT(r=rval, m=m);
  lg  <- fm(m=low.guess, r=rval);
  hg  <- fm(m=high.guess,r=rval);
  if(lg > 0){
    u <- low.guess;
    l <- high.guess;
  }else{
    u <- high.guess;
    l <- low.guess;
  }
  if((fm(l) > 0 & fm(u) > 0) | (fm(l) < 0 & fm(u) < 0)){
    return("Value of m is outside the range");
  }else{
    check  <- 1;
    mguess <- 0.5 * (l+u);
    i      <- 0;
    while(abs(check) > 0.001 & i < 10000){
        check <- fm(r=rval, m= mguess);
        if(check > 0){
          u      <- mguess;
          mguess <- 0.5*(l+mguess); 
        }else{
          l      <- mguess;
          mguess <- 0.5*(u+mguess);
        }
        i <- i+1;
    }
    return(mguess);
  }
} # Running the below returns the estimate
findm(low.guess=0,high.guess=4,rval=0.5);
``

We can use this value of $m$ to again figure out $\zeta_{\textrm{off}}(m)$, 

``{r, echo=FALSE}
OffAT(r=0.5, m=2.847397, B0=1, B1=1, c=1);
``

This value can again be used to figure out the slope ($\gamma$) of the tangent line, 

$$ \gamma = \frac{0.555063 - 0}{2.847397 - 0} = 0.194937 $$

We now have both the optimal $m$ for the inbreeding female, and the slope of the tangent line for the same female. Before getting into the biology, it will help to plot this out visually below,

``{r, echo=FALSE}
PI <- seq(from=0,to=4,by=0.01);
Alleles_IBD_outbr <- OffAT(r=0, m=PI, B0=1, B1=1, c=1);
par(mar=c(5,5,2,2));
plot(PI,Alleles_IBD_outbr,type="l",lwd=3,ylim=c(0,1),
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(a=0,b=0.1589222,lwd=2,lty="dashed");
abline(h=0,lty="dotted",lwd=0.8);
Alleles_IBD_inbr <- OffAT(r=0.5, m=PI, B0=1, B1=1, c=1);
points(PI,Alleles_IBD_inbr,type="l",lwd=3,col="red");
abline(a=0,b=0.194937,lwd=2,lty="dashed",col="red");
``

--->

<!---

Now we can clearly see two things:

1. The inbreeding female ($r=1/2$) maximises her $\zeta_{\textrm{off}}$ production at a higher value of $m$ than for the outbreeding ($r=0$) female. In biological terms, it benefits her to invest more in a smaller number of offspring than her outbreeding counterparts.

2. The inbreeding female has a higher rate of $\zeta_{\textrm{off}}$ production at her optimal $m$ than her outbreeding counterpart, as shown by the higher slope ($\gamma$) of $\zeta_{\textrm{off}}$ as a function of $m$ passing through the origin (dashed red versus dashed black lines). In biological terms, this means that the inbreeding female can acheive a higher *total* $\zeta_{\textrm{off}}$ with her limited resources than the outbreeding female. This is consistent with the models of @Parker1979 and @Duthie2015a for this fairly low inbreeding depression slope of $\beta =1$. 

Overall, it appears that **the model conceptually combines parental investment theory and biparental inbreeding theory to generate novel predictions about optimal parental investment for different degrees of inbreeding** 

Okay, just how good can we get with the model overlap here? In @Duthie2015a, we found a slope of $\beta =1.785148$ to be the threshold for a focal female, below which it benefitted her to mate with a half-brother of $r=1/4$. If this is the point at which inbreeding has the same fitness as outbreeding, then the $\gamma$ values for both inbreeding and outbreeding parents should be the same, albeit with different optimal $m$ values (higher for inbreeding females, as we just saw). Given $\beta =1.785148$, $m_{min}=1$ (Cancelled out in finding thresholds in @Duthie2015a), and $c=1$, the optimum $m$ for outbreeding ($r=0$) females is found below,


This translates into a $\gamma$ value of,

``{r, echo=FALSE}
OffAT(r=0.000,B1=1.785148,m=2.146193) / 2.146193;
``

Note that these values have not changed from the above (black curve and tangent line) because inbreeding depression has no effect when $r=0$. Doing the same for a female that breeds with her half-brother ($r=1/4$), we find an optimum $m$ below,

``{r, echo=FALSE}
findm(low.guess=0,high.guess=4,rval=0.25, B1=1.785148);
``

This translates into a $\gamma$ value of,

``{r, echo=FALSE}
OffAT(r=0.250,B1=1.785148,m=2.774575) / 2.774575;
``

These values are very similar -- it is difficult to tell if they **should** be identical or not, but it seems like a good sign that they are close. We can graph both below.

``{r, echo=FALSE}
PI <- seq(from=0,to=4,by=0.01);
Alleles_IBD_outbr <- OffAT(r=0, m=PI, B0=1, B1=1.785148, c=1);
par(mar=c(5,5,2,2));
plot(PI,Alleles_IBD_outbr,type="l",lwd=3,ylim=c(0,1),
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(a=0,b=0.1589222,lwd=2,lty="dashed");
abline(h=0,lty="dotted",lwd=0.8);
Alleles_IBD_inbr <- OffAT(r=0.25, m=PI, B0=1, B1=1.785148, c=1);
points(PI,Alleles_IBD_inbr,type="l",lwd=3,col="red");
abline(a=0,b=0.1655816,lwd=2,lty="dashed",col="red");
``

Again, the black line above illustrates where $r=0$, and the red line illustrates where $r=1/4$. As expected, the inbreeding female benefits by investing more and producing fewer total offspring. Intuitively, it is pleasing that the $\gamma$ values are similar at the threshold $\beta =1.785148$ value of inbreeding for half-siblings -- this is the value where the fitness for inbreeding or avoiding inbreeding is identical in the inclusive fitness model of @Duthie2015a. But I am not sure that the two slopes should necessarily be **exact** *a priori*; as mentioned above, there is no baseline or natural default for parental care ($m$) in the biparental inbreeding models, so when we allow $m$ to vary, it is not entirely obvious that both inbreeding and outbreeding females will converge on the same fitness given unique values of *optimal* parental care (or any other $m$ values) for threshold values of inbreeding versus inbreeding avoidance. But it is satisfying that the slopes are similar -- at the very least, it would seem to suggest that the conclusions from biparental inbreeding are not very sensitive to different parental investment when each invests its optimum amount. Perhaps there is a way to prove that the two values overlap.

**Upon inspection**, values of $\gamma$ will also depend on $c$, slightly, and I have assumed $c=1$. If we increase to $c=5$, then the $\gamma$ values are still very similar, but their magnitudes are reversed -- it is slightly better to outbreed for a female assuming optimum investment in $m$. Below shows the same parameters plotted as above, but with $c=5$. 

``{r, echo=FALSE}
mo <- findm(low.guess=0,high.guess=4,rval=0.00, B1=1.785148, c=5);
mi <- findm(low.guess=0,high.guess=4,rval=0.25, B1=1.785148, c=5);
so <- OffAT(r=0.000,B1=1.785148,m=mo, c=5) / mo;
si <- OffAT(r=0.250,B1=1.785148,m=mi, c=5) / mi;
PI <- seq(from=0,to=4,by=0.01);
Alleles_IBD_outbr <- OffAT(r=0, m=PI, B0=1, B1=1.785148, c=5);
par(mar=c(5,5,2,2));
plot(PI,Alleles_IBD_outbr,type="l",lwd=3,ylim=c(0,1),
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(a=0,b=so,lwd=2,lty="dashed");
abline(h=0,lty="dotted",lwd=0.8);
Alleles_IBD_inbr <- OffAT(r=0.25, m=PI, B0=1, B1=1.785148, c=5);
points(PI,Alleles_IBD_inbr,type="l",lwd=3,col="red");
abline(a=0,b=si,lwd=2,lty="dashed",col="red");
print(paste("Outbreeding optmal m:",round(mo,digits=6)));
print(paste("Outbreeding tangent to origin:",round(so,digits=6)));
print(paste("Inbreeding optmal m:",round(mi,digits=6)));
print(paste("Inbreeding tangent to origin:",round(si,digits=6)));
``

Again, it is conceptually reassuring that the values are similar. There must be a $c$ value for which the two values completely overlap. Some checking and rechecking finds a value of $c=2.084185$, which predicts identical slopes $\gamma$.

``{r, echo=FALSE}
cc <- 2.084185;
mo <- findm(low.guess=0,high.guess=4,rval=0.00, B1=1.785148, c=cc);
mi <- findm(low.guess=0,high.guess=4,rval=0.25, B1=1.785148, c=cc);
so <- OffAT(r=0.000,B1=1.785148,m=mo, c=cc) / mo;
si <- OffAT(r=0.250,B1=1.785148,m=mi, c=cc) / mi;
PI <- seq(from=0,to=4,by=0.01);
Alleles_IBD_outbr <- OffAT(r=0, m=PI, B0=1, B1=1.785148, c=cc);
par(mar=c(5,5,2,2));
plot(PI,Alleles_IBD_outbr,type="l",lwd=3,ylim=c(0,1),
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(a=0,b=so,lwd=2,lty="dashed");
abline(h=0,lty="dotted",lwd=0.8);
Alleles_IBD_inbr <- OffAT(r=0.25, m=PI, B0=1, B1=1.785148, c=cc);
points(PI,Alleles_IBD_inbr,type="l",lwd=3,col="red");
abline(a=0,b=si,lwd=2,lty="dashed",col="red");
print(paste("Outbreeding optimal m:",round(mo,digits=6)));
print(paste("Outbreeding tangent to origin:",round(so,digits=6)));
print(paste("Inbreeding optimal m:",round(mi,digits=6)));
print(paste("Inbreeding tangent to origin:",round(si,digits=6)));
``

I am not sure why this is the case (it is not simply a mean $m$ value), and I suspect that the answer is not terribly elegant. In general, higher values of $c$ give the outbreeder a higher slope when optimally investing in offspring, while lower values do the opposite. I suppose this is because if the optimal strategy is to invest relatively more in each offspring (as it is for inbreeders), then a low $c$ (smoother sloping curve) is relatively beneficial because it takes more $m$ to invest optimally -- in contrast, less $m$ is needed to reach the plateau of $\zeta_{\textrm{off}}$ when $c$ is high, so this slightly benefits outbreeders.

--->


<!---



If $f>0$, then the inclusive increment decreases, and $\zeta_{\textrm{off}}$ will increases less quickly with increasing $m$, affecting the slope of the tangent line with respect to the origin. 


First, I will plot the functions of $\zeta_{\textrm{off}}(m)$ as above when $r=1/4$ and females are outbred ($k=1/4$ and $f=0$) and $\beta =1$ (solid lines below). Then, I will plot $\zeta_{\textrm{off}}(m)$ when $k=1/4$ but $f=1/4$ (affecting inclusive fitness but not inbreeding depression, see dashed lines below).

```{r, echo=FALSE}
OffATf <- function(f, k, m, B0=1, B1=1, c=1){
    return( (1/2)*(1+(2*k/(1+f))) * (1 - exp(-c*(m - B0 - 2*B1*k)) ));
}
Alleles_IBD_f000 <- OffATf(k=0.25, f=0, m=PI, B0=1, B1=1, c=1);
par(mar=c(5,5,2,2));
plot(PI,Alleles_IBD_f000,type="l",lwd=3,ylim=c(0,1),
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(h=0,lty="dotted",lwd=0.8);
Alleles_IBD_f025 <- OffATf(k=0.25, f=0.25, m=PI, B0=1, B1=1, c=1);
points(PI,Alleles_IBD_f025,type="l",lwd=3,col="black",lty="dashed");
```

We can calculate the optimal $m$ values for each as before, first differentiating $\zeta_{\textrm{off}}$ with respect to $m$.

```{r}
fm <- expression(0.5*(1+(2*k/(f+1)))*(1-exp(-c*(m-B0-2*B1*k))),'m');
fm1 <- D(fm,'m');
print(fm1);
```

More clearly written, we have the following,

$$\frac{\partial \zeta_{\textrm{off}}}{\partial m} = \frac{c}{2} \left(1+\frac{2k}{f+1}\right)e^{-c\left(m-m_{min}-2\beta k\right)}. $$

Which we can compare directly to our original derivative using only $r$,

$$\frac{\partial \zeta_{\textrm{off}}}{\partial m} = \frac{c}{2} \left(1+r\right)e^{-c\left(m-m_{min}-\beta r\right)}. $$

We can plot these functions below assuming $k=1/4$ and $f=0$ (solid line) and $f=1/4$ (dashed line). Note that the two lines below correspond to the solid and dashed lines above, plotting the derivative of each with respect to $m$.

```{r, echo=FALSE}
Offdk <- function(k, f, m, B0=1, B1=1, c=1){
    return( 0.5 * (1 + (2 * k/(f + 1))) * (exp(-c * (m - B0 - 2 * B1 * k)) * c) );
}
Alleles_IBD_f000 <- Offdk(k=0.25, f=0, m=PI, B0=1, B1=1, c=1);
par(mar=c(5,5,2,2));
plot(PI,Alleles_IBD_f000,type="l",lwd=3,ylim=c(0,2),
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(h=0,lty="dotted",lwd=0.8);
Alleles_IBD_f025 <- Offdk(k=0.25, f=0.25, m=PI, B0=1, B1=1, c=1);
points(PI,Alleles_IBD_f025,type="l",lwd=3,col="black",lty="dashed");
```

```{r, echo=FALSE}
findmf <- function(low.guess,high.guess,kval,fval,B1=1,c=1,B0=1){
  OffATf <- function(m, f=fval, k=kval, B0=1, B1=1, c=1){
    return( (1/2)*(1+(2*k/(1+f))) * (1 - exp(-c*(m - B0 - 2*B1*k)) ));
  }
  OffATff <- function(m, k=kval, f=fval, B0=1, B1=1, c=1){
    return( 0.5 * (1 + (2 * k/(f + 1))) * (exp(-c * (m - B0 - 2 * B1 * k)) * c) );
  }    
  fm <- function(m, f=fval, k=kval, B0=1, B1=1, c=1){
    OffATff(m=m, f=fval, k=kval, B0=B0, B1=B1, c=c)*(0-m) + 
          OffATf(m=m, f=fval, k=kval, B0=B0, B1=B1, c=c);
  }
  lg  <- fm(m=low.guess, k=kval, f=fval);
  hg  <- fm(m=high.guess,k=kval, f=fval);
  if(lg > 0){
    u <- low.guess;
    l <- high.guess;
  }else{
    u <- high.guess;
    l <- low.guess;
  }
  if((fm(l) > 0 & fm(u) > 0) | (fm(l) < 0 & fm(u) < 0)){
    return("Value of m is outside the range");
  }else{
    check  <- 1;
    mguess <- 0.5 * (l+u);
    i      <- 0;
    while(abs(check) > 0.001 & i < 10000){
        check <- fm(k=kval, f=fval, m=mguess);
        if(check > 0){
          u      <- mguess;
          mguess <- 0.5*(l+mguess); 
        }else{
          l      <- mguess;
          mguess <- 0.5*(u+mguess);
        }
        i <- i+1;
    }
    return(mguess);
  }
} # Running the below returns the estimate
mopt.f000 <- findmf(low.guess=0,high.guess=4,kval=0.25,fval=0.0, B1=1);
mopt.f025 <- findmf(low.guess=0,high.guess=4,kval=0.25,fval=0.25, B1=1);
tang.f000 <- OffATf(m=mopt.f000, f=0, k=0.25, B0=1, B1=1, c=1) / mopt.f000;
tang.f025 <- OffATf(m=mopt.f025, f=0.25, k=0.25, B0=1, B1=1, c=1) / mopt.f025;
```

Again using the general equation $y = f'\left(a\right)\left(x-a\right) + f\left(a\right)$, we can find the optimum end and tangent slopes. When $\beta =1$, $k=1/4$, and $f=0$ (solid lines above), the optimal value of $m$ equals `r mopt.f000`. When $f=1/4$, the optimal value of $m$ also equals `r mopt.f000` (note that only the increase in inclusive fitness has been affected, so the optimal $m$ is unaffected for the same reason that it is not affected by varying $r$ when $\beta =0$ in previous examples). The tangent $\gamma$ slopes, however obviously differ slightly between the two curves, with the outbred female having slightly higher fitness with a $\gamma$ of `r tang.f025` versus a $\gamma$ of `r tang.f025` for the inbred female. Biologically, this makes some sense, as the inbred female is effectively slightly less closely related to her offspring than the outbred female ($r=2k/(1+f)=3/5$ versus $r=2k/(1+f)=1/2$), but the offspring of each is equally inbred. We can plot the tangent slopes of each below.

```{r, echo=FALSE}
OffATf <- function(f, k, m, B0=1, B1=1, c=1){
    return( (1/2)*(1+(2*k/(1+f))) * (1 - exp(-c*(m - B0 - 2*B1*k)) ));
}
Alleles_IBD_f000 <- OffATf(k=0.25, f=0, m=PI, B0=1, B1=1, c=1);
par(mar=c(5,5,2,2));
plot(PI,Alleles_IBD_f000,type="l",lwd=3,ylim=c(0,1),
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(h=0,lty="dotted",lwd=0.8);
Alleles_IBD_f025 <- OffATf(k=0.25, f=0.25, m=PI, B0=1, B1=1, c=1);
points(PI,Alleles_IBD_f025,type="l",lwd=3,col="black",lty="dashed");
abline(b=tang.f000,a=0,lty="solid",lwd=2);
abline(b=tang.f025,a=0,lty="dashed",lwd=2);
```

It is worth noting that the optimal amount of parent investment always *increases* as inbreeding depression becomes more severe in the exponential term. Thus, whether we subtract some function of $f$ in the exponent (e.g., $\exp[m - m_{min} - f -2\beta k$) or tie it in with the the inbreeding depression slope itself (e.g., $\exp[m - m_{min} - 2\beta k (1+f)]$), $m^{*}$ is always going to increase -- so being inbred is likely to only *increase* the amount of parental care provided if it decreases offspring fitness for some reason.

--->

