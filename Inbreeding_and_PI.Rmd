---
title: "Inbreeding parents should invest more resources in fewer offspring"
author: "A. Bradley Duthie, Aline M. Lee, and Jane M. Reid"
date: "May 27, 2016"
output:
  word_document:
    fig_caption: yes
    pandoc_args:
    - --csl
    - evolution.csl
  pdf_document:
    fig_caption: yes
  html_document: default
header-includes:
- \usepackage{natbib}
- \usepackage{lineno}
- \linenumbers
- \bibliographystyle{amnatnat}
linestretch: 1
csl: evolution.csl
bibliography: Inbreeding_and_PI.bib
---

<!---
- \setlength\parindent{24pt} 
  word_document:
    reference_docx: AASRJ-Style-Format.docx
--->

******************************


```{r, echo=FALSE}
figscale <- 1.0; # Avoid making huge figures.
```


Abstract
===================================================

Inbreeding increases parent-offspring relatedness and commonly reduces offspring viability, shaping selection on reproductive interactions involving relatives and associated parental investment. However, theories predicting selection for inbreeding versus inbreeding avoidance and selection for optimal parental investment have only been considered separately, precluding prediction of optimal parental investment and associated reproductive strategy given inbreeding. We unify inbreeding and parental investment theory, demonstrating that optimal investment per offspring increases when parents inbreed and hence produce inbred offspring with lower viability. Offspring viability is buffered by parental investment, but inbreeding parents produce fewer offspring due to the fundamental trade-off between offspring number and parental investment. Optimal parental investment does not depend on whether a focal female is herself inbred. However, inbreeding causes optimal parental investment to increase given strict monogamy and associated biparental investment compared to female-only investment. Our model implies that understanding evolutionary dynamics of inbreeding strategy, inbreeding depression, and parental investment requires joint measurement and understanding of the expression of each in relation to the other. Overall, we demonstrate that existing parental investment and inbreeding theories represent special cases within a more general inclusive fitness theory, implying that intrinsic links between inbreeding and parental investment affect evolution of behaviour and intra-familial conflict.


Introduction
===================================================

Natural selection is a universal biological process by which inherited traits are preserved within populations if they increase an individual's lifetime reproductive success, which classically defines individual fitness [@Darwin1859; @Dawkins1982]. Inclusive fitness theory [@Hamilton1964; @Hamilton1964a] provides a key extension to this classical definition of fitness, recognising that natural selection will more generally act on individual phenotypes to maximise the rate of increase of replica allele copies [@Grafen2006]. Inclusive fitness accounts for both an individual's own reproductive success and that of relatives who share identical-by-descent alleles. It provides key evolutionary insights [@Gardner2014], perhaps most iconically explaining self-sacrificial behaviour by appealing to the increased reproductive success of related beneficiaries [@Hamilton1964], and identifying causes of conflict between parents and offspring over parental investment [hereafter `PI'; @Trivers1972; @Trivers1974].

It is less widely appreciated that individuals can increase the reproductive success of their relatives by inbreeding, and that selection for inbreeding tolerance or preference can therefore occur despite decreased viability of inbred offspring [i.e., `inbreeding depression', herafter 'ID'; @Parker1979]. Inclusive fitness theory pertaining to inbreeding has focused solely on individuals' decisions to inbreed or avoid inbreeding, assuming no concurrent modulation of PI [e.g., @Parker2006; @Kokko2006; @Duthie2015a]. Such theory ignores that inbreeding might affect a parent's opportunity to increase offspring viability through PI. If individuals decrease total offspring production to invest more per offspring, then they might be able to mitigate ID. Because inbreeding also increases parent-offspring relatedness, inclusive fitness accrued for each viable inbred offspring produced should thereby increase. Unification of inbreeding and PI theory should therefore lead to general predictions for how selection will affect both critical components of reproductive strategy.

Biparental inbreeding theory has been developed primarily from a basic inclusive fitness model, wherein a focal parent encounters a focal relative and chooses to either inbreed or avoid inbreeding with them [e.g., @Parker1979; @Parker2006; @Kokko2006; @Duthie2015a]. If the focal parent inbreeds, then the viability of resulting offspring decreases (ID), but the offspring will inherit additional copies of the focal parent's alleles from the parent's related mate. The focal parent can thereby increase its inclusive fitness by inbreeding if the number of identical-by-descent alleles in its inbred offspring exceeds that of outbred offspring after accounting for ID. The magnitude of ID below which inbreeding rather than avoiding inbreeding increases a parent's inclusive fitness is sex-specific, assuming that females are resource limited and therefore always produce a fixed number of offspring, while male reproduction is limited only by mating opportunities (i.e., stereotypical sex roles). Under such conditions, females that inbreed can only increase their inclusive fitness indirectly by increasing the reproductive success of their male relatives. Conversely, males that inbreed can directly increase their inclusive fitness by increasing their own reproductive success. All else being equal, males but not females therefore benefit by inbreeding given strong ID, while both sexes benefit by inbreeding given weak ID. These predictions are sensitive to the assumption that there is a low or negligible opportunity cost of male mating. If inbreeding instead precludes a male from siring an additional outbred offspring, such as when there is an opportunity cost stemming from monogamy and associated PI, then inbreeding is never beneficial [@Waser1986]. However, existing theory that considers these inclusive fitness consequences of inbreeding assumes that PI is fixed. No theory considers inbreeding decisions in the broader context where PI is optimally expressed.

Similarly, a general framework for PI theory is well-established under outbreeding, but how optimal PI changes when offspring are inbred remains unexplored. Importantly, PI does not simply represent raw resources provided to an offspring (e.g., food), but is rather anything that a parent does to increase its offspring's viability at the expense of its other actual or potential offspring [@Trivers1972; @Trivers1974]. One key assumption of PI theory is therefore that the degree to which a parent invests in each offspring is directly and inversely related to the number of offspring that it produces. A second key assumption is that offspring viability increases with increasing PI, but with diminishing returns on viability as more PI is provided. Given these two assumptions, the optimal PI for which parent fitness is maximised can be determined, as done to examine the magnitude and evolution of parent-offspring conflict over PI [e.g., @Macnair1978; @Parker1978; @Parker1985; @DeJong2005; @Kuijper2012]. Such models assume that offspring are outbred [or result from self-fertilisation, @DeJong2005]. However, biparental inbreeding is commonplace in wild populations, directly affecting both offspring viability and parent-offspring relatedness [@OGrady2006; @Charlesworth2009]. Such inbreeding might profoundly affect optimal PI, yet no theory unifies inbreeding and PI to predict how parents should adjust each to maximise fitness.

Further, fitness consequences of PI and inbreeding might be affected if parents are themselves inbred, or if PI is shared between parents. It is inconsistent to assume that focal parents will always be outbred in a population where the opportunities for inbreeding exist. Inbred parents can carry multiple copies of an identical-by-descent allele, thereby affecting the rate at which the allele's frequency is increased per parent copy through offspring production. Hence the consequences of inbred focal parents on PI and inclusive fitness cannot necessarily be ignored. Additionally, while optimal PI and resulting fitness are not expected to differ between single parent investment and monogamous biparental investment given outbreeding [@Parker1985], this might not be the case given inbreeding because monogamy entails a mating opportunity cost [@Waser1986] to a focal female's related male. Theory unifying PI and inbreeding must therefore consider consequences for fitness when a focal parent is inbred, and when PI is biparental.

We conceptually unify two well-established but separate theoretical frameworks; the first predicts ID thresholds below which focal parents increase their fitness by inbreeding rather than avoiding inbreeding [@Parker1979], and the second predicts optimal PI in outbred offspring [@Macnair1978]. Our specific aims are to show how: (1) optimal PI changes when parents inbreed, and given different magnitudes of ID; (2) optimal PI and parental fitness change when a focal parent is itself inbred; and (3) an inbreeding parent's optimal PI is indirectly affected by opportunity costs when both parents contribute PI. We thereby generate novel predictions that apply to all sexual species.

******************************

Unification of inbreeding and parental investment
===================================================

We consider a focal diploid parent (hereafter assumed to be a stereotypical female) that can adjust the degree to which she invests in each offspring to maximise her own fitness, defined as the rate at which she increases the number of identical-by-descent allele copies inherited by her offspring per copy that she herself carries (always 1 if she is outbred). This definition differs from previous models of PI [e.g., @Macnair1978; @Parker1978], which define fitness as the rate at which offspring are produced and therefore cannot account for inclusive fitness differences between inbred and outbred offspring. We assume that offspring viability increases with increasing PI ($m$), with diminishing returns as $m$ increases [following @Parker1978]. Females have a total PI budget of $M$, and therefore produce $n=M/m$ offspring. We assume for simplicity that $M \gg m$ [following @Parker1985], but this assumption should not affect our general conclusions. Given these minimal assumptions, we can conceptually unify inbreeding and PI theory through a general framework that predicts the number of identical-by-descent allele copies inherited per viable offspring ($\zeta_{\textrm{off}}$),

(@maineq) $$ \zeta_{\textrm{off}} = \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m-m_{min}-\beta r\right)}\right). $$ 

Our model can be conceptualised in two pieces (parameters are summarised in Table 1). The first expression $\left(1/2\right) \left(1 + r\right)$ is the fitness increment that a female gains from identical-by-descent alleles inherited by her offspring, as affected by the coefficient of relatedness between the female and the sire of her offspring ($r$) scaled by $1/2$ to give each parent's genetic contribution to its offspring. The second expression $\left(1 - \exp\left[-c\left(m-m_{min}-\beta r\right)\right]\right)$ is the individual offspring's viability as a function of $m$ and $r$. Offspring viability is also affected by a minimum value of $m$ required for viability to exceed zero ($m_{min}$), ID ($\beta$), and the shape of the curve relating PI to viability ($c$; i.e., how 'diminishing' returns are in $\zeta_{\textrm{off}}$ with increasing $m$). When a focal female inbreeds, the first expression increases because more identical-by-descent alleles are inherited by inbred offspring, but the second expression decreases if $\beta>0$ due to ID in offspring viability. However, increased PI ($m$) can offset decreased offspring viability caused by ID and thereby increase $\zeta_{\textrm{off}}$. 

Parameter               | Description
------------------------|---------------------------------------------------------
$M$                     | Female's total investment budget
$m$                     | Female's investment per offspring
$n$                     | Female's total offspring production
$\zeta_{\textrm{off}}$  | Identical-by-descent allele copies inherited per offspring
$r$                     | Relatedness of a mate to the focal female
$m_{min}$               | Minimum parental investment required for offspring viability
$\beta$                 | Inbreeding depression in offspring viability
$c$                     | Curve of parental investment with offspring fitness
$\gamma$                | Female's rate of fitness increase

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   **Table 1: Definitions of key parameters.**


When $r=0$ (outbreeding), $\beta=0$ and Eq. @maineq reduces to standard models of PI that assume outbreeding [e.g., @Macnair1978; @Parker1978], but with the usual parameter $K$ replaced by $1/2$, thereby explicitly representing identical-by-descent alleles instead of an arbitrary constant affecting offspring fitness. Similarly, given $\delta = \exp\left[-c\left(m-m_{min}-\beta r\right)\right]$, Eq. @maineq reduces to standard models of biparental inbreeding that assume PI is fixed, where $\delta$ defines reduced viability of inbred versus outbred offspring [see @Kokko2006; @Parker2006; @Duthie2015a]. All offspring have equal viability as $m \to \infty$. Consequently, we assume that sufficient PI can always compensate for ID, but key conclusions remain unchanged when this assumption is relaxed (Supporting Information p. S1-2).


Parental investment and fitness given inbreeding
----------------------------------------------------

Equation @maineq can be analysed to determine optimal PI ($m^{*}$), and the corresponding rate at which identical-by-descent alleles are passed by viable offspring given $m^{*}$ [@Kuijper2012], which we define as $\gamma^{*}$. Before analysing Eq. \ref{maineq} generally, we provide a simple example contrasting outbreeding ($r=0$) with inbreeding between first order relatives ($r=1/2$). For simplicity, we assume that $m_{min}=1$, $\beta=1$, and $c=1$ (see Appendix 1 for sample derivations of $m^{*}$ and $\gamma^{*}$ under these conditions).

```{r, echo=FALSE, fig.width = 6*figscale, fig.height = 8*figscale, fig.cap="(A) Relationship between parental investment and the proportion of a focal female's identical-by-descent alleles that are are carried in its offspring for females that outbreed (solid curve) and females that inbreed with first order relatives (dashed curve). Tangent lines identify optimal parental investment, and their slopes define a female's rate of fitness increase when outbreeding (solid line) and inbreeding (dashed line). (B) Relationship between the magnitude of inbreeding depression and optimal parental investment across four degrees of relatedness between a focal female and her mate. Across all beta and r presented, m_min=1 and c=1."}
# Below is a function of the general equation for plotting
OffATr <- function(r, m, mmin=1, Beta=1, c=1){
    return( (1/2)*(1+r) * (1 - exp(-c*(m - mmin - Beta*r)) ));
}
# Below is the same equation as an expression for maths
fm  <- expression(0.5*(1+r)*(1-exp(-c*(m-mmin-Beta*r))),'m');
# We can use the above to differentiate fm wrt `m`
fmd <- D(fm,'m'); # can print fmd to show solution
# Below is fmd for analysis and plotting
OffATrd <- function(r, m, mmin=1, Beta=1, c=1){
    return(  0.5 * (1 + r) * (exp(-c * (m - mmin - Beta * r)) * c)  );
    # Also can simplify: return(  (c/2)*(1+r)*exp(-c*(m-mmin-Beta*r))  );
} # We'll need the above to find m^{*} and \gamma^{*} 
# To find m^{*}, can use the function below
findm <- function(low.guess,high.guess,rval,mmin=1,Beta=1,c=1){
  fm  <- function(m,r=rval){ 
           OffATrd(r=rval, mmin=mmin, Beta=Beta, m=m, c=c)*(0-m) + 
             OffATr(r=rval, mmin=mmin, Beta=Beta, m=m, c=c);
         }
  lg  <- fm(m=low.guess, r=rval);
  hg  <- fm(m=high.guess,r=rval);
  if(lg > 0){
    u <- low.guess;
    l <- high.guess;
  }else{
    u <- high.guess;
    l <- low.guess;
  }
  if((fm(l) > 0 & fm(u) > 0) | (fm(l) < 0 & fm(u) < 0)){
    return("Value of m is outside the range");
  }else{
    check  <- 1;
    mguess <- 0.5 * (l+u);
    i      <- 0;
    while(abs(check) > 0.000001 & i < 1000000){
        check <- fm(r=rval, m=mguess);
        if(check > 0){
          u      <- mguess;
          mguess <- 0.5*(l+mguess); 
        }else{
          l      <- mguess;
          mguess <- 0.5*(u+mguess);
        }
        i <- i+1;
    }
    return(mguess);
  }
} # Running the below returns the estimate
# Below returns m^{*} for outbreeders and inbreeders, respectively
r00m <- findm(low.guess=0,high.guess=4,rval=0.0,mmin=1,Beta=1,c=1);
r05m <- findm(low.guess=0,high.guess=4,rval=0.5,mmin=1,Beta=1,c=1);
# Below finds the tangent slope, \gamma^{*}
r00g <- OffATr(r=0,   m=r00m, mmin=1, Beta=1, c=1) / r00m;
r05g <- OffATr(r=0.5, m=r05m, mmin=1, Beta=1, c=1) / r05m;
# The code below plots everything
PI <- seq(from=0,to=4,by=0.01);
Alleles_IBD_outbr <- OffATr(r=0.0, m=PI, mmin=1, Beta=1, c=1);
Alleles_IBD_inbr  <- OffATr(r=0.5, m=PI, mmin=1, Beta=1, c=1);
# -------------------------------------
r00m.b3 <- findm(low.guess=0,high.guess=6,rval=0.0,mmin=1,Beta=3,c=1);
r05m.b3 <- findm(low.guess=0,high.guess=6,rval=0.5,mmin=1,Beta=3,c=1);
r00g.b3 <- OffATr(r=0,   m=r00m.b3, mmin=1, Beta=3, c=1) / r00m.b3;
r05g.b3 <- OffATr(r=0.5, m=r05m.b3, mmin=1, Beta=3, c=1) / r05m.b3;
bss <- seq(from=0.5,to=5,by=0.25);
gamz <- function(rvl,betas,mmin=1,c=1){
    mvl <- rep(0,length(betas));
    gam <- rep(0,length(betas));
    for(i in 1:length(bss)){
        mvl[i] <- findm(low.guess=0,high.guess=10,rval=rvl,mmin=1,Beta=betas[i],c=1);
        gam[i] <- OffATr(r=rvl, m=mvl[i], mmin=1, Beta=betas[i], c=1) / mvl[i];
    }
    return(list(mvl=mvl,gam=gam));
}
rg000 <- gamz(rvl=0.000,betas=bss);
rg125 <- gamz(rvl=0.125,betas=bss);
rg250 <- gamz(rvl=0.250,betas=bss);
rg500 <- gamz(rvl=0.500,betas=bss);
#-----------------------------------------
par(mfrow=c(2,1),mar=c(5,5,1,1),lwd=2);
layout(matrix(data=c(1,2), nrow=2, ncol=1, byrow = TRUE),
       widths=c(1,1), heights=c(1,1));
# --------------------------------------------------------------------
plot(PI,Alleles_IBD_outbr,type="l",lwd=3,ylim=c(0,1),yaxs="i",xaxs="i",
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(h=0,lty="dotted",lwd=0.8);
points(PI,Alleles_IBD_inbr,type="l",lwd=3,lty="dashed");
abline(a=0,b=r00g,lty="solid", lwd=1); # Tangent line r = 0
abline(a=0,b=r05g,lty="dashed",lwd=1); # Tangent line r = 0.5
text(x=0.15,y=0.92,labels="A",cex=2.5);
arrows(x0=r00m,x1=r00m,y0=0.1,y1=0.003,length = 0.08,angle=30,code=2,lwd=1.25);
arrows(x0=r05m,x1=r05m,y0=0.1,y1=0.003,length = 0.08,angle=30,code=2,lwd=1.25);
text(x=r00m,y=0.145,labels=expression(paste(italic(m),"*"[r==0])),cex=1.0);
text(x=r05m,y=0.145,labels=expression(paste(italic(m),"*"[r==1/2])),cex=1.0);
# --------------------------------------------------------------------
plot(x=bss,y=rg000$mvl,type="l",lwd=2,ylim=c(2,6),pch=1.5,
     xlab=expression(paste("Inbreeding depression (",beta,")")),
     ylab=expression(paste("Optimum PI (",italic(m),"*)")),
     cex.lab=1.5,cex.axis=1.5);
points(x=bss,y=rg125$mvl,type="l",lwd=2);
points(x=bss,y=rg250$mvl,type="l",lwd=2);
points(x=bss,y=rg500$mvl,type="l",lwd=2);
text(x=bss[17],y=rg000$mvl[17]+0.17,labels="r=0",srt=-0,cex=1.25);
text(x=bss[17],y=rg125$mvl[17]+0.2,labels="r=1/8",srt=6,cex=1.25);
text(x=bss[17],y=rg250$mvl[17]+0.2,labels="r=1/4",srt=12.5,cex=1.25);
text(x=bss[17],y=rg500$mvl[17]+0.2,labels="r=1/2",srt=18,cex=1.25);
text(x=0.5,y=5.80,labels="B",cex=2.5);
```

```{r, echo=FALSE}
OffAT <- function(r, m, B0=1, B1=1, c=1){
    return( (1/2)*(1+r) * (1 - exp(-c*(m - B0 - B1*r)) ));
}
```

Figure 1A shows how $\zeta_{\textrm{off}}$ increases with $m$ given $r=0$ (solid curve) and $r=1/2$ (dashed curve). Given $r=0$, $\zeta_{\textrm{off}}=0$ when $m \leq m_{min}$, meaning that offspring are only viable when $m>m_{min}$. Increasing $r$ increases the minimum amount of PI required to produce a viable offspring to $m_{min}+\beta r$, so when $r=1/2$, $\zeta_{\textrm{off}}=0$ when $m \leq 3/2$. Nevertheless, because inbred offspring inherit more identical-by-descent copies of their parent's alleles, sufficiently high $m$ causes $\zeta_{\textrm{off}}$ of inbred offspring to exceed that of outbred offspring (beyond the intersection between the solid and dashed curves in Figure 1A). The point on the line running through the origin that is tangent to $\zeta_{\textrm{off}}(m)$ defines optimal PI, as Figure \ref{mcurves_uni}A shows for outbreeding $m^{*}_{r=0}=$ `r round(r00m,digits=3)` (solid line) and inbreeding with a first order relative $m^{*}_{r=1/2}=$ `r round(r05m,digits=3)` (dashed line). The slope of each tangent line is the rate of a female's fitness increase given optimal PI given outbreeding $\gamma^{*}_{r=0}=$ `r round(r00g,digits=3)` and first order inbreeding $\gamma^{*}_{r=1/2}=$ `r round(r05g,digits=3)`. To maximise fitness, females that inbreed with first order relatives should therefore invest more in offspring than females that outbreed ($m^{*}_{r=1/2}>m^{*}_{r=0}$). This result is general across different values of $r$ (see Appendix 2); as $r$ increases, so does $m^{*}$. Given the trade-off between $m$ and $n$, females that inbreed more should therefore invest more per capita in fewer total offspring. 

A general relationship between $\beta$ and $m^{*}$ for different values of $r$ can be determined numerically. Figure 1B shows this relationship across a range of $\beta$ for $r$ values corresponding to outbreeding ($r=0$) and inbreeding between outbred third-order ($r=1/8$), second-order ($r=1/4$), and first-order ($r=1/2$) relatives. Overall, Figure 1B shows how $m^{*}$ increases with increasing $\beta$ and $r$, and that the difference in magnitude of investment per offspring is often expected to be high for females that inbreed rather than outbreed (e.g., when $\beta=3.25$, optimal PI doubles, $m^{*}_{r=1/2} \approx 2m^{*}_{r=0}$). 

```{r, echo=FALSE, fig.width = 6*figscale, fig.height = 8*figscale, fig.cap="Relationship between the magnitude of inbreeding depression and the rate of a focal female's fitness increase across four degrees of relatedness between a focal female and her mate assuming that (A) focal females invest optimally given their degree of inbreeding and (B) females invest at the optimum for outbreeding."}
# Find gamma assuming investing as if outbreeding
gamznokin <- function(rvl,betas,mmin=1,c=1){
    mvl <- rep(0,length(betas));
    gam <- rep(0,length(betas));
    for(i in 1:length(bss)){
        mvl[i] <- findm(low.guess=0,high.guess=10,rval=0,mmin=1,Beta=betas[i],c=1);
        gam[i] <- OffATr(r=rvl, m=mvl[i], mmin=1, Beta=betas[i], c=1) / mvl[i];
    }
    return(list(mvl=mvl,gam=gam));
}
rg000nk <- gamznokin(rvl=0.000,betas=bss);
rg125nk <- gamznokin(rvl=0.125,betas=bss);
rg250nk <- gamznokin(rvl=0.250,betas=bss);
rg500nk <- gamznokin(rvl=0.500,betas=bss);
# Find gamma assuming investing as if full sibling inbreeding
gamzfsib <- function(rvl,betas,mmin=1,c=1){
    mvl <- rep(0,length(betas));
    gam <- rep(0,length(betas));
    for(i in 1:length(bss)){
        mvl[i] <- findm(low.guess=0,high.guess=10,rval=0.5,mmin=1,Beta=betas[i],c=1);
        gam[i] <- OffATr(r=rvl, m=mvl[i], mmin=1, Beta=betas[i], c=1) / mvl[i];
    }
    return(list(mvl=mvl,gam=gam));
}
rg000fs <- gamzfsib(rvl=0.000,betas=bss);
rg125fs <- gamzfsib(rvl=0.125,betas=bss);
rg250fs <- gamzfsib(rvl=0.250,betas=bss);
rg500fs <- gamzfsib(rvl=0.500,betas=bss);
#--- Start building the figure below
par(mfrow=c(2,1),mar=c(0.25,1,4,1),oma=c(5,5,1,1),lwd=2);
#----------------------------------------------------------------
#par(mar=c(0.5,1,0.25,1),lwd=2);
plot(x=bss,y=rg000$gam,type="l",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     ylab="",xaxt="n",cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.10,0.15,0.20),cex.axis=1.5);
points(x=bss,y=rg125$gam,type="l",lwd=2);
points(x=bss,y=rg250$gam,type="l",lwd=2);
points(x=bss,y=rg500$gam,type="l",lwd=2);
text(x=bss[18],y=rg000$gam[18]+0.0038,labels="r=0",srt=-0,cex=0.8);
text(x=bss[18],y=rg125$gam[18]+0.0038,labels="r=1/8",srt=-7,cex=0.8);
text(x=bss[18],y=rg250$gam[18]+0.0038,labels="r=1/4",srt=-9,cex=0.8);
text(x=bss[18],y=rg500$gam[18]+0.0038,labels="r=1/2",srt=-12,cex=0.8);
text(x=4.95,y=0.213,labels="A",cex=2.5);
#----------------------------------------------------------------
par(mar=c(4,1,0.25,1),lwd=2);
plot(x=bss,y=rg000nk$gam,type="l",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab=expression(paste("Inbreeding depression (",beta,")")),
     cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.10,0.15,0.20),cex.axis=1.5);
points(x=bss,y=rg125nk$gam,type="l",lwd=2);
points(x=bss,y=rg250nk$gam,type="l",lwd=2);
points(x=bss,y=rg500nk$gam,type="l",lwd=2);
text(x=bss[12],y=rg000nk$gam[12]+0.004,labels="r=0",srt=-0,cex=0.8);
text(x=bss[10],y=rg125nk$gam[10]+0.005,labels="r=1/8",srt=-16,cex=0.8);
text(x=bss[7],y=rg250nk$gam[7]+0.005,labels="r=1/4",srt=-40,cex=0.8);
text(x=bss[4]+0.075,y=rg500nk$gam[4]+0.002,labels="r=1/2",srt=-65,cex=0.8);
text(x=4.95,y=0.213,labels="B",cex=2.5);
mtext(text=expression(paste("Rate of fitness increase (",gamma,")")),
      side=2,line=3, cex=1.5, col="black", outer=TRUE);
#----------------------------------------------------------------
# Next, the below generates a function to find where lines intersect
# Finds the beta at which a particular r value intersects r=0 for fitness
findbeta <- function(high.guess,rval,m=FALSE,mmin=1,c=1){
    low.guess <- 0;
    outbr <- findm(low.guess=0,high.guess=10,rval=0,mmin=mmin,Beta=0,c=c);
    outgm <- OffATr(r=0,m=outbr,mmin=mmin,Beta=0,c=c) / outbr;
    if(m == FALSE){ # If we're not constraining m
        check  <- 1;
        bguess <- 0.5 * high.guess;
        i      <- 0;
        l      <- low.guess
        u      <- high.guess;
        while(abs(check) > 0.000001 & i < 1000000){
            mst   <- findm(low.guess=0,high.guess=10,rval=rval,mmin=mmin,Beta=bguess,c=c);
            gam   <- OffATr(r=rval,m=mst,mmin=mmin,Beta=bguess,c=c) / mst;
            check <- gam - outgm;
            if(check < 0){
                u      <- bguess;
                bguess <- 0.5*(l+bguess); 
            }else{
                l      <- bguess;
                bguess <- 0.5*(u+bguess);
            }
            i <- i+1;
        }
    }else{ #If we are forcing m to a particular value
        check  <- 1;
        bguess <- 0.5 * high.guess;
        i      <- 0;
        l      <- low.guess
        u      <- high.guess;
        while(abs(check) > 0.000001 & i < 1000000){
            gam   <- OffATr(r=rval,m=m,mmin=mmin,Beta=bguess,c=c) / m;
            check <- gam - outgm;
            if(check < 0){
                u      <- bguess;
                bguess <- 0.5*(l+bguess); 
            }else{
                l      <- bguess;
                bguess <- 0.5*(u+bguess);
            }
            i <- i+1;
        }
    }   
    return(bguess);
}

```

Assuming that females allocate PI optimally, their $\gamma^{*}$ values can be compared across different values of $r$ and $\beta$. For example, given $r=0$ and $r=1/2$ when $\beta=1$, females that inbreed increase their fitness more than females that outbreed when both invest optimally ($\gamma^{*}_{r=1/2}>\gamma^{*}_{r=0}$). This result concurs with biparental inbreeding models where PI does not vary (see Appendix 3). However, if $\beta=3$, then $\gamma^{*}_{r=0}=$ `r round(r00g.b3,digits=3)` and $\gamma^{*}_{r=1/2}=$ `r round(r05g.b3,digits=3)`. Given this higher inbreeding depression, females that outbreed will therefore have higher fitness than females that inbreed with first order relatives. Figure 2A shows more generally how $\gamma^{*}$ changes with $\beta$ and $r$ given optimal PI. Across all $\beta$, the highest $\gamma^{*}$ occurs either when $r=1/2$ ($\beta <$ `r round(findbeta(high.guess=5,rval=0.5),digits=3)`) or $r=0$ ($\beta >$ `r round(findbeta(high.guess=5,rval=0.5),digits=3)`), and never for intermediate values of $r$. If females can investing optimally, it is therefore beneficial to either maximise or minimise inbreeding, depending on the magnitude of ID.

In some populations, individuals might be unable to discriminate between relatives and non-relatives, and hence unable to adjust their PI when inbreeding. We therefore consider a focal female's inclusive fitness when she cannot adjust her PI to $m^{*}$ upon inbreeding, and therefore $\gamma < \gamma^{*}$. Figure 2B shows $\gamma$ values for females that inbreed to different degrees when they invest at the relatively low optimum $m^{*}$ of outbreeding females When inbreeding females allocate PI as if they are outbreeding, $\gamma$ always decreases, and this fitness decrease becomes more severe with increasing $r$. While the fitness of a female that inbreeds with a first order relative ($r=1/2$) exceeds that of an outbreeding female when $\beta <$ `r round(findbeta(high.guess=5,rval=0.5),digits=3)`, if the inbreeding female invests at the outbreeding female's optimum, then her fitness is higher only when $\beta <$ `r round(findbeta(high.guess=5,rval=0.5,m=r00m),digits=3)`. Consequently, if parents are unable to recognise that they are inbreeding and adjust their PI accordingly, their fitness might be decreased severely relative to optimally investing parents.


Investment and fitness of an inbred parent
------------------------------------------------

Our initial assumption that a focal female is herself outbred is likely to be violated in populations where inbreeding is expected to occur [@Duthie2015a]. We therefore consider how the degree to which a focal female is herself inbred will affect her optimal PI ($m^{*}$) and rate of increase in fitness ($\gamma^{*}$).

To account for an inbred female, we decompose the coefficient of relatedness $r$ into the underlying coefficient of kinship $k$ between the female and her mate and the female's own coefficient of inbreeding $f$ [see @Hamilton1972; @Michod1979], such that,

(@rdef) $$ r = \frac{2k}{1 + f}. $$

The coefficients $k$ and $f$ are the probabilities that two homologous alleles randomly sampled from the focal female and her mate, and two homologous alleles within the focal female, are identical-by-descent. The value of $k$ between two parents therefore defines offspring $f$. Because inbreeding depression is widely assumed to be caused by the expression of homozygous deleterious recessive alleles [@Charlesworth2009], the value of $k$ determines the degree to which ID is expressed in offspring. In contrast, a female's own $f$ does not directly affect the degree to which homologous deleterious recessive alleles from two different parents will pair in inbred offspring, and therefore does not contribute to ID. To understand how $\zeta_{\textrm{off}}$ is affected by $f$ and $k$, and thereby relax the assumption that a focal female is outbred, we expand Eq @maineq,

(@maineqr) $$\zeta_{\textrm{off}} = \frac{1}{2}\left(1+\frac{2k}{1+f}\right)\left(1-e^{-c\left(m-m_{min}-2\beta k\right)}\right).$$

Because a focal female's $f$ does not affect inbreeding depression in its offspring, and instead only affects the fitness increment $1/2\left(1+ 2 k / \left[1 + f\right]\right)$,  $m^{*}$ is unaffected by $f$ (see also Appendix 2). The degree to which a female is herself inbred therefore does not affect optimal PI (Fig. 3).

```{r, echo=FALSE}
OffATf <- function(f, k, m, B0=1, B1=1, c=1){
    return( (1/2)*(1+(2*k/(1+f))) * (1 - exp(-c*(m - B0 - 2*B1*k)) ));
}
findmf <- function(low.guess,high.guess,kval,fval,B1=1,c=1,B0=1){
  OffATf <- function(m, f=fval, k=kval, B0=1, B1=1, c=1){
    return( (1/2)*(1+(2*k/(1+f))) * (1 - exp(-c*(m - B0 - 2*B1*k)) ));
  }
  OffATff <- function(m, k=kval, f=fval, B0=1, B1=1, c=1){
    return( 0.5 * (1 + (2 * k/(f + 1))) * (exp(-c * (m - B0 - 2 * B1 * k)) * c) );
  }    
  fm <- function(m, f=fval, k=kval, B0=1, B1=1, c=1){
    OffATff(m=m, f=fval, k=kval, B0=B0, B1=B1, c=c)*(0-m) + 
          OffATf(m=m, f=fval, k=kval, B0=B0, B1=B1, c=c);
  }
  lg  <- fm(m=low.guess, k=kval, f=fval);
  hg  <- fm(m=high.guess,k=kval, f=fval);
  if(lg > 0){
    u <- low.guess;
    l <- high.guess;
  }else{
    u <- high.guess;
    l <- low.guess;
  }
  if((fm(l) > 0 & fm(u) > 0) | (fm(l) < 0 & fm(u) < 0)){
    return("Value of m is outside the range");
  }else{
    check  <- 1;
    mguess <- 0.5 * (l+u);
    i      <- 0;
    while(abs(check) > 0.001 & i < 10000){
        check <- fm(k=kval, f=fval, m=mguess);
        if(check > 0){
          u      <- mguess;
          mguess <- 0.5*(l+mguess); 
        }else{
          l      <- mguess;
          mguess <- 0.5*(u+mguess);
        }
        i <- i+1;
    }
    return(mguess);
  }
} # Running the below returns the estimate
imopt.f000 <- findmf(low.guess=0,high.guess=4,kval=0.25,fval=0.0, B1=1);
imopt.f025 <- findmf(low.guess=0,high.guess=4,kval=0.25,fval=0.25, B1=1);
itang.f000 <- OffATf(m=imopt.f000, f=0, k=0.25, B0=1, B1=1, c=1) / imopt.f000;
itang.f025 <- OffATf(m=imopt.f025, f=0.25, k=0.25, B0=1, B1=1, c=1) / imopt.f025;
omopt.f000 <- findmf(low.guess=0,high.guess=4,kval=0.0,fval=0.0, B1=1);
omopt.f025 <- findmf(low.guess=0,high.guess=4,kval=0.0,fval=0.25, B1=1);
otang.f000 <- OffATf(m=omopt.f000, f=0, k=0.0, B0=1, B1=1, c=1) / omopt.f000;
otang.f025 <- OffATf(m=omopt.f025, f=0.25, k=0.0, B0=1, B1=1, c=1) / omopt.f025;
```

```{r, echo=FALSE, fig.cap="Relationship between parental investment (m) and the number of identical-by-descent copies of a focal female's alleles that are carried by its offspring (zeta-off) for females that are outbred (f=0; upper curve) versus females that are inbred (f=1/4; lower curve). Grey shading between the curves shows the fitness difference between outbred and inbred females across different degrees of parental investment, and m* indicates optimal parental investment. Thin grey lines in the figure show tangent lines for each curve."}
Alleles_IBD_f000 <- OffATf(k=0.25, f=0.0, m=PI, B0=1, B1=1, c=1);
par(mar=c(5,5,2,2));
plot(PI,Alleles_IBD_f000,type="l",lwd=1,ylim=c(0,0.95),lty="solid",
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5,yaxs="i",xaxs="i");
abline(h=0,lty="dotted",lwd=0.8);
Alleles_IBD_f025 <- OffATf(k=0.25, f=0.25, m=PI, B0=1, B1=1, c=1);
abline(b=itang.f000,a=0,lty="solid",lwd=0.5,col="grey40");
abline(b=itang.f025,a=0,lty="solid",lwd=0.5,col="grey40");
polygon(x=c(PI,rev(PI)),y=c(Alleles_IBD_f000,rev(Alleles_IBD_f025)),col="grey70",border=NA);
points(PI,Alleles_IBD_f025,type="l",lwd=1,col="black",lty="solid");
points(PI,Alleles_IBD_f000,type="l",lwd=1,col="black",lty="solid");
yof000 <- OffATf(k=0.25, f=0.0,  m=imopt.f000, B0=1, B1=1, c=1);
yof025 <- OffATf(k=0.25, f=0.25, m=imopt.f025, B0=1, B1=1, c=1);
xline  <- seq(from=1,to=imopt.f000,by=0.001);
points(x=xline,y=rep(yof000,length(xline)),type="l",lwd=1);
points(x=xline,y=rep(yof025,length(xline)),type="l",lwd=1);
yline  <- seq(from=0,to=yof025,by=0.001);
points(x=rep(imopt.f025,length(yline)),y=yline,type="l",lwd=1);
text(x=3.5,y=0.255,labels=expression(paste(italic(m^{"*"}))),cex=1.75);
arrows(x0=3.345,y0=0.205,x1=imopt.f025+0.04,y1=0.01,length = 0.15,angle=30,code=2,lwd=2);
text(x=0.75,y=0.8,labels=expression(paste(italic(f==0))),cex=1.25);
arrows(x0=0.8,y0=0.75,x1=1.1,y1=yof000+0.01,length = 0.15,angle=30,code=2,lwd=2);
text(x=0.67,y=0.35,labels=expression(paste(italic(f==frac(1,4)))),cex=1.25);
arrows(x0=0.87,y0=0.36,x1=1.1,y1=yof025-0.01,length = 0.15,angle=30,code=2,lwd=2);
```

Further, a focal female's $f$ should only slightly affect $\gamma^{*}$, and only if $k>0$.  For example, Fig. \ref{inbred_parent} shows the difference between $\zeta_{\textrm{off}}(m)$ for females that are outbred ($f=0$, top curve) versus inbred ($f=1/4$, i.e., whose parents were outbred first-order relatives, bottom curve) when each pairs with a first order relative ($k=1/4$). Where $m=m^{*}$, $\zeta_{\textrm{off}}$ is slightly higher for outbred females, meaning that $\gamma^{*}$ is higher for outbred individuals even though optimal PI is the same ($m^{*}_{f=0}=m^{*}_{f=1/4}$). Thin grey lines in the figure show tangent lines for each curve. Overall, Fig 3 shows a weak effect on $\gamma^{*}$ across a relatively wide range of $f$ (outbred individuals versus individuals of full sibling matings). Consequently, the degree to which an individual is inbred will have a small effect on its rate of fitness increase, and no effect on its optimal PI.


Effects of biparental investment
------------------------------------------------

```{r, echo=FALSE}
# New equations needed to present the results below
fpair <- expression(0.5*(1+r)*(1-exp(-c*(m-mmin-Beta*r))) - 
                        (r/2)*(1-exp(-c*(z-mmin))),'m');
fpaird <- D(fpair,'m'); # can print fmd to show solution
Offpair <- function(r, m, mmin=1, Beta=1, c=1, m0=r00m){
    direct   <- (1/2)*(1+r) * (1 - exp(-c*(m - mmin - Beta*r)) );
    indirect <- (r/2)*(1-exp(-c*(r00m-mmin)));
    return( direct - indirect);
}
findmpair <- function(low.guess,high.guess,rval,mmin=1,Beta=1,c=1,m0=r00m){
    # Note that derivative of zeta has not changed, only the original f
    fm  <- function(m,r=rval){ 
        OffATrd(r=rval, mmin=mmin, Beta=Beta, m=m, c=c)*(0-m) + 
            Offpair(r=rval, mmin=mmin, Beta=Beta, m=m, c=c, m0=m0);
    }
    lg  <- fm(m=low.guess, r=rval);
    hg  <- fm(m=high.guess,r=rval);
    if(lg > 0){
        u <- low.guess;
        l <- high.guess;
    }else{
        u <- high.guess;
        l <- low.guess;
    }
    if((fm(l) > 0 & fm(u) > 0) | (fm(l) < 0 & fm(u) < 0)){
        return("Value of m is outside the range");
    }else{
        check  <- 1;
        mguess <- 0.5 * (l+u);
        i      <- 0;
        while(abs(check) > 0.000001 & i < 1000000){
            check <- fm(r=rval, m=mguess);
            if(check > 0){
                u      <- mguess;
                mguess <- 0.5*(l+mguess); 
            }else{
                l      <- mguess;
                mguess <- 0.5*(u+mguess);
            }
            i <- i+1;
        }
        return(mguess);
    }
} # Running the below returns the
r05mpB0 <- findmpair(low.guess=0,high.gues=10,rval=0.5,Beta=0);
r05gpB0 <- Offpair(r=0.5, m=r05mpB0, mmin=1, Beta=0, c=1, m0=r00m) / r05mpB0;
r05mpB1 <- findmpair(low.guess=0,high.gues=10,rval=0.5,Beta=1);
r05gpB1 <- Offpair(r=0.5, m=r05mpB1, mmin=1, Beta=1, c=1, m0=r00m) / r05mpB1;

```

Our initial model assumed that only females provide PI. We now consider the opposite extreme, where PI is provided by two parents that pair exactly once in life and therefore have completely overlapping fitness interests [i.e., strict monogamy; @Parker1985]. Given Parker's (1985) implicit assumption of outbreeding, optimal PI per parent ($m^{*}$) does not differ between female-only PI versus monogamy, but twice as many offspring are produced due to the doubled total investment budget $2M$. However, $m^{*}$ given monogamy will differ from $m^{*}$ given female-only PI if monogamous parents are related. This is because a male is by definition precluded from mating with another female, and therefore pays a complete opportunity cost for inbreeding [@Waser1986]. A focal female will thereby lose any inclusive fitness increment that she would have otherwise received when her related mate also bred with other females.

To incorporate this cost, we explicitly consider both the direct and indirect fitness consequences of inbreeding. We assume that if a focal female avoids inbreeding with her male relative, then that relative will outbreed instead, and that parents are outbred ($f=0$) and invest optimally for any given $\beta$. We define $m^{*}_{0}$ and $m^{*}_{r}$ as optimal investment for outbreeding and for inbreeding to the degree $r$, respectively. Therefore, if a focal female avoids inbreeding,

(@optPI) $$\zeta_{\textrm{off}} = \frac{1}{2}\left(1-e^{-c\left(m^{*}_{0}-m_{min}\right)}\right).$$ 

If she instead inbreeds,

(@optPIoc) $$\zeta_{\textrm{off}} = \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m^{*}_{r}-m_{min}-\beta r\right)}\right) - \frac{r}{2}\left(1-e^{-c\left(m^{*}_{0}-m_{min}\right)}\right).$$ 

The first term of Eq. @optPIoc represents the fitness increment the focal female receives from inbreeding (and is identical to the right-hand side of Eq. @maineq). The second term represents the indirect loss of fitness the focal female would have received through her male relative had she not inbred with him. The resulting decrease in $\zeta_{\textrm{off}}(m_{r})$ causes an overall increase in $m^{*}_{r}$. Monogamous parents should therefore each invest even more per offspring when inbreeding than females should invest given female-only PI (assuming a male would otherwise have outbred). For example, if $r=1/2$ and $\beta=1$, $m^{*}_{r}=$ `r round(r05mpB1,digits=3)` given strict monogamy but `r round(r05m,digits=3)` geven female-only PI (Fig. 4A). However, a parent's rate of fitness increase at $r=1/2$ is $\gamma^{*}_{r=1/2}=$ `r round(r05g,digits=3)` given female-only PI versus $\gamma^{*}_{r=1/2}=$ `r round(r05gpB1,digits=3)` given strict monogamy. The latter is therefore less than the increase resulting from optimal PI given outbreeding, $\gamma^{*}_{r=0}=0.159$. Indeed, given strict monogamy, $\gamma^{*}_{r=1/2} < \gamma^{*}_{r=0}$ for all $\beta$, meaning that the rate of fitness increase accrued from inbreeding never exceeds that accrued from outbreeding. 

```{r, echo=FALSE, fig.width = 6*figscale, fig.height = 8*figscale, fig.cap="Assuming strict monogamy, the (A) relationship between parental investment and the proportion of a focal female's identical-by-descent alleles that are are carried in its offspring for females that outbreed (solid curve) and females that inbreed with first order relatives (dashed curve). Tangent lines identify optimal parental investment, and their slopes define a female's rate of fitness increase when outbreeding (solid line) and inbreeding (dashed line). (B) Relationship between the magnitude of inbreeding depression and optimal parental investment across four degrees of relatedness between a focal female and her mate."}
#---------------- Some general patterns now plotted
bss <- seq(from=0.5,to=5,by=0.25);
gamzp <- function(rvl,betas,mmin=1,c=1,m0=r00m){
    mvl <- rep(0,length(betas));
    gam <- rep(0,length(betas));
    for(i in 1:length(bss)){
        mvl[i] <- findmpair(low.guess=0,high.guess=10,rval=rvl,
                            mmin=1,Beta=betas[i],c=1,m0=r00m);
        gam[i] <- Offpair(r=rvl,m=mvl[i],mmin=1,Beta=betas[i],c=1,m0=m0) / mvl[i];
    }
    return(list(mvl=mvl,gam=gam));
}
rg000p <- gamzp(rvl=0.000,betas=bss);
rg125p <- gamzp(rvl=0.125,betas=bss);
rg250p <- gamzp(rvl=0.250,betas=bss);
rg500p <- gamzp(rvl=0.500,betas=bss);
#----------------------------------------------------------------
Alleles_IBD_outbr_pair <- Offpair(r=0.0, m=PI, mmin=1, Beta=1, c=1);
Alleles_IBD_inbr_pair  <- Offpair(r=0.5, m=PI, mmin=1, Beta=1, c=1);
#-----------------------------------------
par(mfrow=c(2,1),mar=c(5,5,1,1),lwd=2);
layout(matrix(data=c(1,2), nrow=2, ncol=1, byrow = TRUE),
       widths=c(1,1), heights=c(1,1));
# --------------------------------------------------------------------
plot(PI,Alleles_IBD_outbr_pair,type="l",lwd=3,ylim=c(0,1),yaxs="i",xaxs="i",
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5);
abline(h=0,lty="dotted",lwd=0.8);
points(PI,Alleles_IBD_inbr_pair,type="l",lwd=3,lty="dashed");
abline(a=0,b=r00g,lty="solid", lwd=1); # Tangent line r = 0
abline(a=0,b=r05gpB1,lty="dashed",lwd=1); # Tangent line r = 0.5
text(x=0.15,y=0.925,labels="A",cex=2.5);
# --------------------------------------------------------------------
plot(x=bss,y=rg000$mvl,type="l",lwd=2,ylim=c(2,6),pch=1.5,
     xlab=expression(paste("Inbreeding depression (",beta,")")),
     ylab=expression(paste("Optimum PI (",italic(m),"*)")),
     cex.lab=1.5,cex.axis=1.5);
points(x=bss,y=rg125$mvl,type="l",lwd=2);
points(x=bss,y=rg250$mvl,type="l",lwd=2);
points(x=bss,y=rg500$mvl,type="l",lwd=2);
text(x=bss[17],y=rg000$mvl[17]+0.17,labels="r=0",srt=-0,cex=1.15);
text(x=bss[17],y=rg125$mvl[17]+0.17,labels="r=1/8",srt=6,cex=1.15);
text(x=bss[17],y=rg250$mvl[17]+0.17,labels="r=1/4",srt=12.5,cex=1.15);
text(x=bss[17],y=rg500$mvl[17]+0.17,labels="r=1/2",srt=18,cex=1.15);
text(x=0.5,y=5.85,labels="B",cex=2.5);

```

Figure 4A shows how $\zeta_{\textrm{off}}$ increases as a function of $m$ given $r=0$ (solid curve) and $r=1/2$ (dashed curve) given strict monogamy and biparental investment, and can be compared to analogous relationships for female-only PI, given identical parameter values shown in Fig. 1A. In contrast to female-only PI, $\gamma^{*}_{r=1/2}$ (slope of the dashed line) is now lower when $r=1/2$ than when $r=0$, meaning that the fitness of females that inbreed with first order relatives is lower than females that outbreed given strict monogamy. Figure 4B shows $m^{*}$ for two strictly monogamous parents across different values of $r$ and $\beta$. In comparison with female-only PI (Fig. 1B), $m^{*}$ is always slightly higher given strict monogamy if $r>0$ (Fig. 4B), but in both cases $m^{*}$ increases with increasing $r$ and $\beta$. 

We now consider the inclusive fitness of focal parents that cannot adjust her PI upon inbreeding, and instead allocates PI at the optimum for outbreeding. Figure 5A shows how $\gamma$ varies with $\beta$ given that monogamous parents invest optimally (5A) and invest at an optimum PI for outbreeding (5B). In contrast to female-only PI (Fig. 2A), $\gamma^{*}$ is always maximised at $r=0$, meaning that inbreeding never increases fitness. Fitness decreases even further when inbreeding individuals allocate PI at $m^{*}$ for outbreeding (compare Figs 2B and 5B; see Supporting Information S3 for $\gamma$ values across $\beta$ and $r$ assuming parents invest at different $m^{*}_{r}$). Universally decreasing $\gamma$ with increasing $r$ is consistent with biparental inbreeding theory, which demonstrates that if inbreeding with a female completely precludes a male from outbreeding, inbreeding will never be beneficial [@Waser1986; @Duthie2015a]. However, if relatives become paired under strict monogamy, each should invest more per offspring than given female-only PI.

```{r, echo=FALSE, fig.width = 6*figscale, fig.height = 8*figscale, fig.cap="Assuming strict monogamy, the relationship between the magnitude of inbreeding depression and the rate of a focal female's fitness increase across four degrees of relatedness between a focal female and her mate given that (A) focal females invest optimally given their degree of inbreeding, and (B) females invest at the optimum for outbreeding."}
#--- Start building the figure below
par(mfrow=c(2,1),mar=c(0.25,1,4,1),oma=c(5,5,1,1),lwd=2);
#----------------------------------------------------------------
plot(x=bss,y=rg000p$gam,type="l",lwd=2,ylim=c(0.05,0.18),pch=1.5,yaxt="n",
     xlab=expression(paste("Inbreeding depression (",beta,")")),xaxt="n",
     ylab="",cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.05,0.10,0.15,0.20),cex.axis=1.5);
points(x=bss,y=rg125p$gam,type="l",lwd=2);
points(x=bss,y=rg250p$gam,type="l",lwd=2);
points(x=bss,y=rg500p$gam,type="l",lwd=2);
text(x=bss[17],y=rg000p$gam[17]+0.005,labels="r=0",srt=-0,cex=1);
text(x=bss[17],y=rg125p$gam[17]+0.005,labels="r=1/8",srt=-4,cex=1);
text(x=bss[17],y=rg250p$gam[17]+0.005,labels="r=1/4",srt=-6,cex=1);
text(x=bss[17],y=rg500p$gam[17]+0.005,labels="r=1/2",srt=-8,cex=1);
text(x=4.95,y=0.174,labels="A",cex=2.5);
#----------------------------------------------------------------
par(mar=c(4,1,0.25,1),lwd=2);
r000_000pt <- Offpair(r=0.000, m=r00m, mmin=1, Beta=bss, c=1, m0=r00m) / r00m;
r125_000pt <- Offpair(r=0.125, m=r00m, mmin=1, Beta=bss, c=1, m0=r00m) / r00m;
r250_000pt <- Offpair(r=0.250, m=r00m, mmin=1, Beta=bss, c=1, m0=r00m) / r00m;
r500_000pt <- Offpair(r=0.500, m=r00m, mmin=1, Beta=bss, c=1, m0=r00m) / r00m;
plot(x=bss,y=r000_000pt,type="l",lwd=2,ylim=c(0.05,0.18),pch=1.5,yaxt="n",
     xlab=expression(paste("Inbreeding depression (",beta,")")),
     ylab="",cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.05,0.10,0.15,0.20),cex.axis=1.5);
points(x=bss,y=r125_000pt,type="l",lwd=2);
points(x=bss,y=r250_000pt,type="l",lwd=2);
points(x=bss,y=r500_000pt,type="l",lwd=2);
text(x=bss[12],y=r000_000pt[12]+0.005,labels="r=0",srt=-0,cex=1);
text(x=bss[10],y=r125_000pt[10]+0.005,labels="r=1/8",srt=-15,cex=1);
text(x=bss[7],y=r250_000pt[7]+0.005,labels="r=1/4",srt=-34,cex=1);
text(x=bss[4]+0.06,y=r500_000pt[4]+0.004,labels="r=1/2",srt=-65,cex=1);
text(x=4.95,y=0.174,labels="B",cex=2.5);
#----------------------------------------------------------------
mtext(text=expression(paste("Rate of fitness increase (",gamma,")")),
      side=2,line=2, cex=1.5, col="black",outer=TRUE);
```

******************************

Discussion
===================================================

Inbreeding increases parent-offspring relatedness and commonly reduces offspring viability, potentially affecting selection on reproductive interactions involving relatives and associated parental investment (PI), and thereby altering evolutionary dynamics of entire reproductive systems. By unifying biparental inbreeding theory and PI theory under an inclusive fitness framework, we show that when females inbreed and hence produce inbred offspring, optimal PI always increases, and this increase is greatest when inbreeding depression in offspring viability (ID) is strong. We also show that, in contrast to existing theory that implicitly assumes outbreeding [@Parker1985], optimal PI increases given strict monogamy and associated biparental investment compared to female-only PI. Finally, we show that optimal PI does not change when a focal female is herself inbred, but her fitness, defined as the rate of increase of identical-by-descent allele copies, decreases. Our conceptual synthesis illustrates how previously separate theory developed for biparental inbreeding [@Parker1979; @Parker2006] and PI [@Macnair1978, @Parker1978] can be understood as special cases within a broader inclusive fitness framework in which inbreeding and PI covary in predictable ways.

Inbreeding and PI in empirical systems
---------------------------------------------------

Theory can inform empirical hypothesis testing by logically connecting assumptions to novel empirical predictions. We demonstrate that given a small number of assumptions regarding PI and inbreeding, selection will increase PI (and therefore decrease the total number of offspring parents produce) with increasing relatedness between parents and increasing magnitude of ID (Fig. 1B). Empirical studies are now needed to test key assumptions and predictions.

One assumption is that ID can be reduced by PI. Numerous studies have estimated magnitudes of ID in components of offspring fitness [@Charlesworth2009; @Szulkin2012]. However, PI is notoriously difficult to measure because it might encompass numerous behaviours, each involving allocation from an unknown total PI budget [@Parker2002]. It is therefore difficult to quantify how much ID is reduced by PI, and only a few empirical studies make such estimates. For example, @Pilakouta2015 quantified the fitness of inbred and outbred burying beetle (*Nicrophorus vespilloides*) offspring in the presence and absence of maternal care, finding that maternal care increased survival of inbred offspring relatively more than outbred offspring. Interpreting care as a component of PI, this result concurs with the assumption that PI can reduce ID. Similarly, in the subsocial spider *Anelosimus* cf. *jucundus*, in which care is provided by solitary females, @Aviles2006 found evidence of ID only late in an offspring's life when parental care was no longer being provided, and hypothesise that care might buffer ID. However, *A.* cf. *jucundus* that inbred did not produce fewer offspring than females that outbred, as our model predicts if females respond to inbreeding by increasing PI. Some further constraint might therefore prevent female \textit{A.} cf. \textit{jucundus} from adaptively adjusting PI.

Indeed, a second assumption of our model is that individuals can discriminate among different kin and non-kin and adjust their PI according to the degree to which they inbreed. If parents are unable to infer that they are inbreeding, then will likely allocate PI sub-optimally, resulting in decreased fitness of inbreeding parents (Fig. 2B) and viability of resulting inbred offspring. The magnitude of ID might consequently be greater than if PI were allocated optimally, implying that observed ID depends partly on adaptive PI rather than being a fixed consequence of offspring genotype. To our knowledge, no empirical studies have explicitly tested whether or not PI varies with inbreeding. However, strong negative correlations between inbreeding and litter size have been found in wolves [*Canis lupus*; e.g., @Liberg2005; @Fredrickson2007]. Wolves are highly social and generally monogamous, and are likely able to discriminate among kin [@Raikkonen2009, @Geffen2011]. @Liberg2005 and @Fredrickson2007 interpret decreased litter size as a negative fitness consequence of inbreeding manifested as increased early mortality of inbred offspring. Our model suggests an alternative explanation; smaller litter sizes might partially reflect adaptive allocation whereby inbreeding parents invest more in fewer offspring. Future empirical assessments of the relative contributions of ID and adjusted PI in shaping offspring viability will require careful observation of variation in PI and litter or brood sizes in systems with natural or experimental variation in inbreeding.

Our model also clarifies why reproductive success, simply measured as the number of offspring produced, does not necessarily reflect inclusive fitness given inbreeding, or hence predict evolutionary dynamics. A female that produces an outbred brood might have lower inclusive fitness than a female that produces an inbred brood of the same (or slightly smaller) size if the inbreeding female's viable offspring carry more identical-by-descent allele copies (see also Reid et al., *in press*). Interestingly, if brood size is restricted by some physiological or external constraint (i.e., brooding or nest site capacity), our model predicts that females with large total resource budgets $M$ might benefit by inbreeding and thereby adaptively allocate more PI to each offspring. Overall, therefore, our model shows that understanding the evolutionary dynamics of reproductive systems that involve interactions among relatives is likely to require ID, inbreeding strategy, and reproductive output to be evaluated in the context of variable PI.

Intrafamilial conflict given inbreeding
---------------------------------------------------

Interactions over PI are characterised by intrafamilial conflict between parents, between parents and offspring, and among siblings [@Parker2002]. Our general theoretical framework sets up future considerations of intrafamilial conflict over PI given inbreeding. Our current model assumes either female-only PI or strict monogamy, meaning that female and male fitness interests are identical, eliminating sexual conflict. However, in general, if both parents invest and are not completely monogamous, sexual conflict is predicted because each parent will increase its fitness if it provides less PI than its mate. Optimal PI can then be modelled as an evolutionary stable strategy [@Smith1977], and is expected to decrease for both parents [@Parker1985]. This decrease in optimal PI might be weaker given inbreeding because the negative inclusive fitness consequences of a focal parent reducing PI will be exacerbated if the mate that it abandons is a relative. 

Sexual conflict might also be minimised if a focal parent that decreases its PI must wait for another mate to become available before it can mate again. @Kokko2006 considered the fitness consequences of inbreeding and inbreeding avoidance given a waiting time between mate encounters, and a processing time following mating, which they interpreted as PI. They found that inbreeding tolerance generally increased with increasing waiting time, but that such relationships depended on processing time.  However, processing time was a fixed parameter, meaning that parents could not adjust PI as a consequence of inbreeding. If this assumption was relaxed such that PI could vary, parents that inbreed might be expected to increase their time spent processing offspring before attempting to mate again.

Parent-offspring conflict is a focal theoretical interest of many PI models, which generally predict that offspring benefit from PI that exceeds parental optima [e.g., @Macnair1978; @Parker1978; @Parker1985; @DeJong2005]. However, such conflict might be decreased by inbreeding. Inbreeding parents are more closely related to their offspring than are outbreeding parents, generating the increase in parents' optimal PI in our model; in the extreme case where $r=1$ (self-fertilisation), no conflict over PI should exist. @DeJong2005 modelled PI conflict in the context of optimal seed mass from the perspective of parent plants and their seeds given varying rates of self-fertilisation, showing that conflict over seed mass decreases with increasing self-fertilisation, assuming seed mass is controlled by seeds rather than parent plants. They predict that conflict over seed mass decreases with increasing self-fertilisation rate, and a comparative analysis of seed size across closely related plant species generally supports this prediction [@DeJong2005]. In general, the same principles of parent-offspring conflict are expected to apply for biparental inbreeding; parent-offspring conflict should decrease with increasing inbreeding, and reduced conflict might in turn affect offspring behaviour. For example, @Mattey2014 observed both increased parental care and decreased offspring begging in an experimental study of *N. vispilloides* when offspring were inbred. A reduction in begging behaviour is consistent with our model when inbreeding increases and parent-offspring fitness interests with respect to PI are more closely aligned. Future models could relax our assumption that parents completely control PI, and thereby consider how biparental inbreeding and PI interact to affect the evolution of reproductive strategies given intrafamilial conflict.


**************************


Appendix 1: Sample derivations of $m^{*}$ and $\gamma^{*}$
----------------------------------------------

In general, the equation for a line tangent to some function $f$ at the point $a$ is,

$$ y = f'\left(a\right)\left(x-a\right) + f\left(a\right). $$

In the above, $f'(a)$ is the first derivative of $f(a)$, and $y$ and $x$ define the point of interest through which the straight line will pass that is also tangent to $f(a)$. The original function that defines $\zeta_{\textrm{off}}$ is as follows,

$$\zeta_{\textrm{off}} = \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m-m_{min}-\beta r\right)}\right).$$

Differentiating $\zeta_{\textrm{off}}$ with respect to $m$, we have the following,

```{r, echo=FALSE}
fm <- expression(0.5*(1+r)*(1-exp(-c*(m-B0-B1*r))),'m');
fm1 <- D(fm,'m');
```

$$\frac{\partial \zeta_{\textrm{off}}}{\partial m} = \frac{c}{2} \left(1+r\right)e^{-c\left(m-m_{min}-\beta r\right)}. $$

Substituting $\zeta_{\textrm{off}}(m)$ and $\partial \zeta_{\textrm{off}} / \partial m$ and setting $y=0$ and $x=0$ (origin), we have the general equation, 

$$ 0 = \frac{c}{2} \left(1+r\right)e^{-c\left(m-m_{min}-\beta r\right)}\left(0-m\right) + \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m-m_{min}-\beta r\right)}\right). $$

```{r, echo=FALSE}
r00m.y <- OffATr(r=0,  m=r00m, mmin=1, Beta=1, c=1);
r05m.y <- OffATr(r=0.5, m=r05m, mmin=1, Beta=1, c=1);
```

A solution for $m^{*}$ can be obtained numerically for the example in which $m_{min}=1$, $\beta=1$, and $c=1$. If $r=0$, $m^{*}_{r=0}=$ `r round(r00m,digits=3)`, and if $r=1/2$, $m^{*}_{r=1/2}=$ `r round(r05m,digits=3)`. Solutions for the slopes defining $\gamma^{*}_{r=0}$ and $\gamma^{*}_{r=1/2}$ can be obtained by finding the straight line that runs through the two points $(0,0)$ and $(m^{*}$ , $\zeta_{\textrm{off}}(m^{*}))$. In the case of $r=0$, $\zeta_{\textrm{off}}(m^{*})=$ `r round(r00m.y,digits=3)`, so we find, $\gamma^{*}_{r=0}=$ (`r round(r00m.y,digits=3)` $- 0$) $/$ (`r round(r00m,digits=3)` $- 0$) = `r round(r00g,digits=3)`. In the case of $r=1/2$, $\zeta_{\textrm{off}}(m^{*})=$ `r round(r05m.y,digits=3)`, so we find, $\gamma^{*}_{r=1/2}=$ (`r round(r05m.y,digits=3)` $- 0$) $/$ (`r round(r05m,digits=3)` $- 0$) = `r round(r05g,digits=3)`. 

Appendix 2: $m^{*}$ increases with increasing $r$
----------------------------------------------

Here we show that optimal parental investment always increases with increasing inbreeding given ID and $c>0$. First, note that $m^{*}$ is defined as the value of $m$ that maximises the rate of increase in $\zeta_{\textrm{off}}$ for a female. This is described by the line that passes through the origin and lies tangent to $\zeta_{\textrm{off}}(m)$. As in Appendix 1, we have the general equation for which $m=m^{*}$,

$$ 0 = \frac{c}{2} \left(1+r\right)e^{-c\left(m-m_{min}-\beta r\right)}\left(0-m\right) + \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m-m_{min}-\beta r\right)}\right). $$

We first substitute $m=m^{*}$ and note that this equation reduces to,

$$ 0 = c e^{-c\left(m^{*}-m_{min}-\beta r\right)}\left(0-m^{*}\right) + \left(1-e^{-c\left(m^{*}-m_{min}-\beta r\right)}\right). $$

This simplification dividing both sides of the equation by $(1/2)(1+r)$ has a biological interpretaion that is relevant to parental investment. Optimal parental investment does not depend directly on the uniform increase in $\zeta_{\textrm{off}}$ caused by $r$ in $(1/2)(1+r)$, the change in $m^{*}$ is only affected by $r$ insofar as $r$ affects offspring fitness directly through ID. Ideally, we would isolate $m$ to find $\partial m^{*} / \partial r$, but this is not possible. Instead, the above equation can be simplified further to isolate $r$ and show that $\partial r / \partial m^{*} > 0$,

$$ 0 = -m^{*} c e^{-c\left(m^{*}-m_{min}-\beta r\right)} + 1-e^{-c\left(m^{*}-m_{min}-\beta r\right)} $$

From the above, $r$ can be isolated,

<!---
$$ 1 = m^{*} c e^{-c\left(m^{*}-m_{min}-\beta r\right)} + e^{-c\left(m^{*}-m_{min}-\beta r\right)} $$

$$ 1 = e^{-c\left(m^{*}-m_{min}-\beta r\right)} \left(1 + m^{*} c\right) $$

$$ e^{-c\left(m^{*}-m_{min}-\beta r\right)} = \frac{1}{\left(1 + m^{*} c\right)} $$

$$ -c\left(m^{*}-m_{min}-\beta r\right) = \ln\left(\frac{1}{\left(1 + m^{*} c\right)}\right) $$

$$ m^{*}-m_{min}-\beta r = -\frac{1}{c}\ln\left(\frac{1}{\left(1 + m^{*} c\right)}\right) $$

$$ \beta r = m^{*} - m_{min} + \frac{1}{c}\ln\left(\frac{1}{\left(1 + m^{*} c\right)}\right) $$
--->

$$ r = \frac{1}{\beta}\left(m^{*} - m_{min} + \frac{1}{c}\ln\left(\frac{1}{\left(1 + m^{*} c\right)}\right)\right) $$

We now differentiate $r$ with respect to $m^{*}$,

```{r, echo=FALSE}
rrmm  <- expression((1/beta)*(mopt-mmin+(1/c)*log(1/(mopt*c+1))),'mopt');
# We can use the above to differentiate fm wrt `m`
drdm <- D(rrmm,'mopt'); # can print fmd to show solution
# Note that drdm simplifies considerably from what R produces
```

$$ \frac{\partial r}{\partial m^{*}} = \frac{m^{*} c}{\beta \left(m^{*} c + 1\right)}. $$

We thereby arrive at the general conclusion,

$$ \frac{\partial m^{*}}{\partial r} = \frac{\beta \left(m^{*} c + 1\right)}{m^{*} c}. $$

Given the above, $\partial m^{*} / \partial r > 0$ assuming $\beta>0$ (ID), $c>0$ (offspring fitness increases with parental investment), and $m^{*}>0$ (optimum parental investment is positive). These assumptions are biologically realistic; we therefore conclude that the positive association between optimal parental investment ($m^{*}$) and inbreeding ($r$) is general. As inbreeding increases, so should optimal parental investment in offspring.


Supporting Information
----------------------------------------------

Consistency with biparental inbreeding models
----------------------------------------------

To show that a female that inbreeds with a first order relative ($r=1/2$) has a higher fitness than a female that outbreeds ($r=0$) given $m_{min}=1$, $\beta=1$, and $c=1$ at optimal values of $m^{*}_{r=1/2}$ and $m^{*}_{r=0}$, we define $\delta_{r}$ as follows,

$$ \delta_{r} = e^{-c(m^{*}_{r}-m_{min}-\beta r)}. $$

Existing biparental inbreeding models [e.g., @Kokko2006; @Parker2006; @Duthie2015a] implicitly assume that $\delta_{r=0}=0$ for outbred offspring, but this is not valid in our model because $\delta_{r=0}$ will also depend on PI. However, by defining $\delta_{r}$ to explicitly include PI, we can thereby define individual fitness using the same mathematical framework as existing biparental inbreeding models, where inclusive fitness resulting from inbreeding to any degree $r$ is determined by,

$$ W_{r} = \frac{n}{2}\left(1+r\right)\left(1-\delta_{r}\right). $$

The right hand side of the above equation defines inclusive fitness resulting from inbreeding in inequality 1 of [-@Duthie2015a], in which the inequality compares inclusive fitness accrued from inbreeding with a relative $r$ versus inclusive fitness accrued from outbreeding. Equivalent definitions of $W_{r}$ also appear in [-@Parker2006] and [-@Kokko2006]. By definition, $n = M/m$, so $n$ is the total number of offspring a female produces. Existing biparental inbreeding models assume that $n$ is constant, but $n$ scales linearly with $m$ in our model because females that invest more in each offspring (high $m$) will produce fewer total offspring (low $n$). To account for this, we can simply substitute $M/m$ for $n$,

$$ W_{r} = \frac{M}{2 m}\left(1+r\right)\left(1-\delta_{r}\right). $$

Fitness given $r=0$ and $r=1/2$, and $m^{*}_{r=0}$ and $m^{*}_{r=1/2}$, can be determined by substituting some constant value for $M$ (here for simplicity, assume $M=1$), as the magnitude of $n$ will not affect relative fitness 

To show that inbreeding with first order relatives returns a higher fitness than outbreeding given the above conditions assumed in our model, we can simply use the above equation directly to compare inclusive fitness given both $r=1/2$ and $r=0$, noting that $\delta_{r=1/2}=0.26$ and $\delta_{r=0}=0.32$ (note that $\delta_{r=1/2}<\delta_{r=0}$  because an inbreeding female invests more in her offspring, $m^{*}_{r=1/2}=$ `r round(r05m,digits=3)` versus $m^{*}_{r=0}=$ `r round(r00m,digits=3)`). Consequently, we can use the above equation to show that the fitness gain of an optimally investing female that inbreeds with a first order relative is `r round((1/(r05m*2))*(1+0.5)*(1-exp(-1*(r05m - 1 -1*0.5))),digits=3)`, compared with `r round((1/(r00m*2))*(1+0.0)*(1-exp(-1*(r00m - 1 -1*0.0))),digits=3)` for the outbreeding female; these values are identical to our earlier calculated values of $\gamma^{*}_{r=1/2}$ and $\gamma^{*}_{r=0}$.


******************************

Inbreeding depression that cannot be mitigated by PI
----------------------------------------------

Suppose we assume that some amount of reduction in offspring viability due to inbreeding (ID) cannot be mitigated by PI, $(1 - \Delta r)$, such that offspring viability decreases linearly with increasing $\Delta$ and $r$ regardless of $m$. In this case, $\zeta_{\textrm{off}}$ is simply,

$$\zeta_{\textrm{off}} = \frac{1}{2}\left(1+r\right)\left(1-e^{-c\left(m-m_{min}-\beta r\right)}\right) \left(1 - \Delta r\right).$$

Note that offspring viability now decreases with $\Delta$, but the additional strength of ID $\Delta$ is (by definition) independent of $m$. A simple example illustrates how $\zeta_{\textrm{off}}$ and therefore $\gamma^{*}$ decreases with increasing $\Delta$, while $m^{*}$ remains unaffected. We return to the example in which $c=1$, $m_{min}=1$, $\beta=1$, and $r=1/2$ (inbreeding between first order relatives).

```{r, echo=FALSE}
fm  <- expression(0.5*(1+r) * (1 - exp(-c*(m-mmin-Beta*r))) * (1-r*Delta),'m');
# We can use the above to differentiate fm wrt `m`
fmd <- D(fm,'m'); # can print fmd to show solution
OffDelta <- function(r, m, mmin=1, Beta=1, c=1, Delta){
    return( 0.5*(1+r) * (1 - exp(-c*(m-mmin-Beta*r))) * (1-r*Delta) );
}
OffDeltad <- function(r, m, mmin=1, Beta=1, c=1, Delta){
    return( 0.5 * (1 + r) * (exp(-c * (m - mmin - Beta * r)) * c)*(1-r*Delta) );
}
findmDelta <- function(low.guess,high.guess,rval,mmin=1,Beta=1,c=1,Delta){
    fm  <- function(m,r=rval, DD=Delta){ 
        OffDeltad(r=rval, mmin=mmin, Beta=Beta, m=m, c=c, Delta=Delta)*(0-m) + 
            OffDelta(r=rval, mmin=mmin, Beta=Beta, m=m, c=c, Delta=Delta);
    }
    lg  <- fm(m=low.guess, r=rval, DD=Delta);
    hg  <- fm(m=high.guess,r=rval, DD=Delta);
    if(lg > 0){
        u <- low.guess;
        l <- high.guess;
    }else{
        u <- high.guess;
        l <- low.guess;
    }
    if((fm(l) > 0 & fm(u) > 0) | (fm(l) < 0 & fm(u) < 0)){
        return("Value of m is outside the range");
    }else{
        check  <- 1;
        mguess <- 0.5 * (l+u);
        i      <- 0;
        while(abs(check) > 0.000001 & i < 1000000){
            check <- fm(r=rval, m=mguess);
            if(check > 0){
                u      <- mguess;
                mguess <- 0.5*(l+mguess); 
            }else{
                l      <- mguess;
                mguess <- 0.5*(u+mguess);
            }
            i <- i+1;
        }
        return(mguess);
    }
} # Running the below returns the estimate
Beta <- 1;
c    <- 1;
mmin <- 1;
rva  <- 0.5;
Delt <- 0; # First show no Delta
Del1 <- OffDelta(m=PI,r=0.5,Delta=Delt, Beta=1);
par(mar=c(5,5,1,1));
plot(x=PI,y=Del1,type="l",lwd=2,ylim=c(0,1),
     xlab=expression(paste("Parental investment (",italic(m),")")),
     ylab=expression(paste("IBD alleles in offspring (",zeta[off],")")),
     cex.lab=1.5,cex.axis=1.5,yaxs="i",xaxs="i");
d1m <- findmDelta(low.guess=0,high.guess=10,rval=0.5,Delta=Delt);
d1g <- OffDelta(r=rva, mmin=mmin, Beta=Beta, m=d1m, c=c, Delta=Delt) / d1m;
abline(a=0,b=d1g,col="black");
Delt <- 0.5; # Now show significant delta
Del2 <- OffDelta(m=PI,r=0.5,Delta=Delt, Beta=1);
points(x=PI,y=Del2,type="l",lwd=2,ylim=c(0,1),lty="dashed");
d2m <- findmDelta(low.guess=0,high.guess=10,rval=0.5,Delta=Delt);
d2g <- OffDelta(r=rva, mmin=mmin, Beta=Beta, m=d2m, c=c, Delta=Delt) / d2m;
abline(a=0,b=d2g,lty="dashed");

```

The figure above compares $\Delta=0$ (solid curve) with $\Delta=1/2$ (dashed curve). When strong ID exists with an effect that is independent of $m$, optimal parental investment does not change, and $m^{*}=$ `r round(d2m,digits=3)`. Yet while $m^{*}$ is unaffected by $\Delta$, the additional source of ID has a predictable negative effect on $\zeta_{\textrm{off}}$, with a rate of fitness increase $\gamma^{*}$ of `r round(d1g,digits=3)` (solid line) when $\Delta=0$ and `r round(d2g,digits=3)` when $\Delta=1/2$ (dashed line). The inclusion of $\Delta$ effectively relaxes the assumption that sufficient PI can always compensate for being inbred. For inbred offspring, $\zeta_{\textrm{off}}$ approaches $1/2(1+r)(1 - \Delta r)$ as $m \to \infty$. As such, when $r=1/2$ and $\Delta=1/2$, the maximum possible $\zeta_{\textrm{off}}$ is `r OffDelta(m=Inf, r=0.5, Delt=0.5, Beta=0)` (dashed curve) instead of `r OffDelta(m=Inf, r=0.5, Delt=0, Beta=0)` (solid curve). While this has no effect on optimal PI given that inbreeding has occurred, the existence of ID that cannot be mitigated with PI might strongly affect the fitness consequences of inbreeding versus avoiding inbreeding (e.g., $\gamma^{*}_{r=1/2}$ versus $\gamma^{*}_{r=0}$).

Fitness ($\gamma$) across PI ($m$) given $\beta=1$ \& $\beta=3$
----------------------------------------------

Figure 6 below shows how $\gamma$ changes as a function of $m$, and graphically identifies $m^{*}$ where $\gamma$ is maximised (i.e., $\gamma = \gamma^{*}$). Values of $m^{*}$ are identified by grey dots where $\gamma$ is at its peak for four different $r$ values. Figure 6A identifies $m^{*}$ where $\beta$ is sufficiently low to mean that inbreeding is beneficial ($\gamma$ peaks at higher values when $r$ is higher), and Fig. 6B identifies $m^{*}$ where $\beta$ is sufficiently high to mean that outbreeding is beneficial ($\gamma$ peaks at higher values when $r$ is lower). As in Fig. 1B, Fig. 6 shows that $m^{*}$ always increases with increasing $r$ and $\beta$. Consequently, inbreeding parents might often be expected to invest considerably more in fewer offspring, relative to outbreeding parents.

```{r, echo=FALSE, fig.width = 8*figscale, fig.height = 5*figscale, fig.cap="A focal female's rate of fitness increase (gamma star), defined as the rate at which she increases the number of identical-by-descent alleles copies carried in her offspring, given different magnitudes of parental investment. Lines show outbreeding (r=0), inbreeding between outbred first cousins (r=1/8), half-siblings (r=1/4), and full-siblings (r=1/2). Grey dots identify optimal parental investment (m star) for each degree of inbreeding given magnitudes of inbreeding depression in which inbreeding (A; beta=1) and outbreeding (B; beta=3) increase parent fitness."}
par(oma=c(4,1,1,1));
moBB <- 1;
mvals   <- seq(from=1, to=6, by=0.01);
par(mfrow=c(1,2),mar=c(1,5,2,1),lwd=2);
# First assume that Beta = 1.
mvr000  <- OffATr(r=0.000, m=mvals, mmin=1, Beta=moBB, c=1) / mvals;
mvr125  <- OffATr(r=0.125, m=mvals, mmin=1, Beta=moBB, c=1) / mvals;
mvr250  <- OffATr(r=0.250, m=mvals, mmin=1, Beta=moBB, c=1) / mvals;
mvr500  <- OffATr(r=0.500, m=mvals, mmin=1, Beta=moBB, c=1) / mvals;
mstr000 <- findm(low.guess=0,high.guess=6,rval=0.000,Beta=moBB,c=1,mmin=1);
mstr125 <- findm(low.guess=0,high.guess=6,rval=0.125,Beta=moBB,c=1,mmin=1);
mstr250 <- findm(low.guess=0,high.guess=6,rval=0.250,Beta=moBB,c=1,mmin=1);
mstr500 <- findm(low.guess=0,high.guess=6,rval=0.500,Beta=moBB,c=1,mmin=1);
mstrgm0 <- OffATr(r=0.000, m=mstr000, mmin=1, Beta=moBB, c=1) / mstr000;
mstrgm1 <- OffATr(r=0.125, m=mstr125, mmin=1, Beta=moBB, c=1) / mstr125;
mstrgm2 <- OffATr(r=0.250, m=mstr250, mmin=1, Beta=moBB, c=1) / mstr250;
mstrgm5 <- OffATr(r=0.500, m=mstr500, mmin=1, Beta=moBB, c=1) / mstr500;
plot(x=mvals,y=mvr000,type="l",lwd=3,ylim=c(0.0,0.21),pch=1.5,yaxt="n",
     ylab=expression(paste("Rate of fitness increase (",gamma,")")),
     cex.lab=1.5,cex.axis=1.5,xaxs="i",yaxs="i",xaxt="n");
axis(side=2,at=c(0,0.05,0.10,0.15,0.20),labels=TRUE,cex.axis=1.5);
axis(side=1,at=c(1,2,3,4,5,6),cex.axis=1.5);
points(x=mvals,y=mvr125,type="l",lwd=3);
points(x=mvals,y=mvr250,type="l",lwd=3);
points(x=mvals,y=mvr500,type="l",lwd=3);
points(x=mstr000,y=mstrgm0,cex=1.5,pch=21,bg="grey70");
points(x=mstr125,y=mstrgm1,cex=1.5,pch=21,bg="grey70");
points(x=mstr250,y=mstrgm2,cex=1.5,pch=21,bg="grey70");
points(x=mstr500,y=mstrgm5,cex=1.5,pch=21,bg="grey70");
text(x=mvals[450],y=mvr000[450]+0.005,labels="r=0",  srt=-25,cex=0.8);
text(x=mvals[450],y=mvr125[450]+0.005,labels="r=1/8",srt=-25,cex=0.8);
text(x=mvals[450],y=mvr250[450]+0.005,labels="r=1/4",srt=-25,cex=0.8);
text(x=mvals[450],y=mvr500[450]+0.006,labels="r=1/2",srt=-30,cex=0.8);
text(x=5.0,y=0.198,labels=expression(paste("A; ",beta==1)),cex=1.5);
lines(x=c(4.1,4.1,6),y=c(0.21,0.189,0.189),lwd=2);
#--- Now show the place where Beta = 3.
par(mar=c(1,1,2,4),lwd=2);
moBB    <- 3;
mvr000  <- OffATr(r=0.000, m=mvals, mmin=1, Beta=moBB, c=1) / mvals;
mvr125  <- OffATr(r=0.125, m=mvals, mmin=1, Beta=moBB, c=1) / mvals;
mvr250  <- OffATr(r=0.250, m=mvals, mmin=1, Beta=moBB, c=1) / mvals;
mvr500  <- OffATr(r=0.500, m=mvals, mmin=1, Beta=moBB, c=1) / mvals;
mstr000 <- findm(low.guess=0,high.guess=6,rval=0.000,Beta=moBB,c=1,mmin=1);
mstr125 <- findm(low.guess=0,high.guess=6,rval=0.125,Beta=moBB,c=1,mmin=1);
mstr250 <- findm(low.guess=0,high.guess=6,rval=0.250,Beta=moBB,c=1,mmin=1);
mstr500 <- findm(low.guess=0,high.guess=6,rval=0.500,Beta=moBB,c=1,mmin=1);
mstrgm0 <- OffATr(r=0.000, m=mstr000, mmin=1, Beta=moBB, c=1) / mstr000;
mstrgm1 <- OffATr(r=0.125, m=mstr125, mmin=1, Beta=moBB, c=1) / mstr125;
mstrgm2 <- OffATr(r=0.250, m=mstr250, mmin=1, Beta=moBB, c=1) / mstr250;
mstrgm5 <- OffATr(r=0.500, m=mstr500, mmin=1, Beta=moBB, c=1) / mstr500;
plot(x=mvals,y=mvr000,type="l",lwd=3,ylim=c(0.0,0.21),pch=1.5,yaxt="n",
     xlab="",ylab="", cex.lab=1.5,cex.axis=1.5,xaxs="i",yaxs="i",xaxt="n");
axis(side=1,at=c(1,2,3,4,5,6),cex.axis=1.5);
points(x=mvals,y=mvr125,type="l",lwd=3);
points(x=mvals,y=mvr250,type="l",lwd=3);
points(x=mvals,y=mvr500,type="l",lwd=3);
points(x=mstr000,y=mstrgm0,cex=1.5,pch=21,bg="grey70");
points(x=mstr125,y=mstrgm1,cex=1.5,pch=21,bg="grey70");
points(x=mstr250,y=mstrgm2,cex=1.5,pch=21,bg="grey70");
points(x=mstr500,y=mstrgm5,cex=1.5,pch=21,bg="grey70");
text(x=mvals[450],y=mvr000[450]+0.005,labels="r=0",  srt=-22,cex=0.8);
text(x=mvals[450],y=mvr125[450]+0.005,labels="r=1/8",srt=-22,cex=0.8);
text(x=mvals[450],y=mvr250[450]+0.005,labels="r=1/4",srt=-22,cex=0.8);
text(x=mvals[450],y=mvr500[450]+0.005,labels="r=1/2",srt=-22,cex=0.8);
text(x=5.0,y=0.198,labels=expression(paste("B; ",beta==3)),cex=1.5);
lines(x=c(4.1,4.1,6),y=c(0.21,0.189,0.189),lwd=2);
mtext(expression(paste("Parental investment (",italic(m),")")),
      outer=TRUE,side=1,line=2.1,cex=1.5);
```


Fitness consequences of sub-optimal PI
----------------------------------------------

One goal of theory is to provide unified explanations for otherwise disparate natural phenomena, and to thereby generate broadly applicable predictions that follow from a minimal set of general assumptions. We used inclusive fitness theory as a framework to unify previous theory developed for understanding adaptation in the context of inbreeding [@Parker1979; @Parker2006] and parental investment [e.g., @Macnair1978; @Parker1978], and to thereby make general predictions for how natural selection should act across all sexual species when PI can vary with inbreeding. Our interest was therefore to broadly understand the general effect of natural selection with respect to inbreeding and PI, not to predict specific inclusive fitness consequences for different magnitudes of inbreeding or PI provided by individual parents.  Nevertheless, by predicting the fitness consequences for females that inbreed and allocate PI sub-optimally (i.e., $m < m^{*}$), it is possible to gain some additional insight into how selection might affect female fitnesses in real populations. 

Here we focus on the specific fitness consequences of females that inbreed and provide PI to different degrees. We consider outbred females that breed with mates of four different degrees of relatedness: non-relatives ($r=0$), first cousins ($r=1/8$), half siblings ($r=1/4$), and full siblings ($r=1/2$). We consider a focal female that inbreeds to each degree $r$, and allocates PI at the optimum of her own, and all other, optimal PIs (i.e., $m^{*}_{r=0}$, $m^{*}_{r=1/8}$, $m^{*}_{r=1/4}$, and $m^{*}_{r=1/2}$ for all degrees of inbreeding $r$). Figure 7 shows the consequences across all possible combinations of inbreeding and PI given female-only PI (left-hand column of panels) and strict monogamy (and hence biparental investment, right-hand column of panels). A focal female's rate of fitness increase ($\gamma$) is shown across a range of magnitudes of ID ($\beta$) assuming that females allocate PI at $m^{*}_{r=0}$ (Fig. 7A,B), $m^{*}_{r=1/8}$ (Fig. 7C,D), $m^{*}_{r=1/4}$ (Fig. 7E,F), $m^{*}_{r=1/2}$ (Fig. 7G,H). Line weights show different degrees of inbreeding ($r$) from decreasing to increasing such that the thinnest lines show $r=0$, medium thin lines show $r=1/8$, medium thick lines show $r=1/4$, and the thickest lines show $r=1/2$. Overall, Figure 7 thereby shows the fitness consequences ($\gamma$) across multiple degrees of inbreeding, PI ($m$), and magnitudes of ID ($\beta$).

Given female-onlyh PI (left-hand column of panels), fitness always decreases with increasing $\beta$, except when $r=0$ and outbreeders invest optimally (Fig. 7A), in which case fitness remains unchanged despite increasing $\beta$. As outbreeding females invest at the optimum of increasingly high inbreeding (panel rows top to bottom), female fitness decreases more rapidly with increasing $\beta$ because outbreeding females are allocating PI further away from their optimum and more toward the optimum of females that inbreed (compare Fig. 7 with Fig. 6 in SI 2, where $\gamma$ for $r=0$ decreases along the curve away from its maximum given $m^{*}$ for increasing $r=1/8$ to $r=1/2$). When $r>0$, $\gamma$ always decreases with increasing $\beta$, but the slope of this decrease is weakest when a female is investing at its optimum PI. For example, when $r=1/8$, the slope of $\gamma$ as a function of $\beta$ is least negative in Fig. 7C, where the female is investing at its optimum $m^{*}_{r=1/8}$, and more negative for all other $m^{*}$ (Fig. 7A,E,G). For the highest $m^{*}_{r=1/2}$ (Fig. 7G), $r=1/2$ consistently has the highest $\gamma$, with a monotonic decrease in $\gamma$ with decreasing $r$, and as females therefore invest further away from their own optimum PI (it is relevant to note that lines predicting $\gamma$ in Fig. 7G would cross at higher $\beta$ values, as they do at increasingly higher $\beta$ in Fig. 7A,C, and E). Overall, fitness decreases with increasing $\beta$, and as a female invests further away from its optimal PI.

Given strict monogamy (and hence biparental investment, right-hand column of panels), fitness always decreases with increasing $\beta$, except again when outbreeders invest optimally (Fig. 7B). In contrast to female-only PI, given strict monogamy, parents that inbreed ($r>0$) never have a higher fitness than parents that avoid inbreeding ($r=0$). In fact, across all optimal PI, parent fitness always decreases with increasing inbreeding. For example, in Fig. 7F, a focal parent that inbreeds with its half-sibling (second thinnest line) is investing optimally while all other parents do not, yet its fitness is always lower than parents that outbreed or inbreed with first cousins ($r=0$ and $r=1/8$, respectively), and always higher than parents that inbreed with full siblings ($r=1/2$). This illustrates the importance of considering the fitness consequences of inbreeding in light of opportunity costs [@Waser1986], such as the complete opportunity cost imposed by strict monogamy. If opportunity costs of male mating are high, then inbreeding will decrease fitness regardless of PI, as is consistent with the key conceptual point highlighted by @Waser1986.

Overall, Figure 7 thereby shows the fitness consequences of varying inbreeding and PI across a wide range of values for inbreeding depression. These specific cases affecting inclusive fitness highlight our general conclusion that individuals will benefit by increasing their PI at higher magnitudes of inbreeding and inbreeding depression, as illustrated by the fitness consequences of deviations from optimal PI derived in the main text.


```{r, echo=FALSE, fig.width = 7*figscale, fig.height = 8*figscale, fig.cap="Relationship between the magnitude of inbreeding depression and the rate of a focal parents's fitness increase given optimum parental investment (m*) for four degrees of relatedness between a focal parent and its mate (r={0, 1/8, 1/4, 1/2}, rows top to bottom) and single parent investment (left column) versus strict monogamy (right column). Each panel therefore shows a unique combinuation of optimum parental investment given either single parent investment or strict monogamy. Within panels, parent fitness is plotted as a function of inbreeding depression for all combinations of r: r=0 (thin line), r=1/8 (medium thin line), r=1/4 (medium thick line) and r=1/2 (thick line)."}
gamzVrkin <- function(rvl,kin,betas,mmin=1,c=1,oc=0){
    mvl <- rep(0,length(betas));
    gam <- rep(0,length(betas));
    for(i in 1:length(bss)){
        mvl[i] <- findm(low.guess=0,high.guess=10,rval=kin,mmin=1,Beta=betas[i],c=1);
        if(oc==0){
            gam[i] <- OffATr(r=rvl, m=mvl[i], mmin=1, Beta=betas[i], c=1) / mvl[i];
        }else{
            gam[i] <- Offpair(r=rvl, m=mvl[i], mmin=1, Beta=betas[i], c=1, m0=r00m) / mvl[i];
        }
    }
    return(list(mvl=mvl,gam=gam));
} 
#-----------------------------------------------------------
r0500m000 <- gamzVrkin(rvl=0.500,kin=0.000,betas=bss,oc=0); 
r0250m000 <- gamzVrkin(rvl=0.250,kin=0.000,betas=bss,oc=0);
r0125m000 <- gamzVrkin(rvl=0.125,kin=0.000,betas=bss,oc=0);
r0000m000 <- gamzVrkin(rvl=0.000,kin=0.000,betas=bss,oc=0);
#-----------------------------------------------------------
r0500m125 <- gamzVrkin(rvl=0.500,kin=0.125,betas=bss,oc=0);
r0250m125 <- gamzVrkin(rvl=0.250,kin=0.125,betas=bss,oc=0);
r0125m125 <- gamzVrkin(rvl=0.125,kin=0.125,betas=bss,oc=0);
r0000m125 <- gamzVrkin(rvl=0.000,kin=0.125,betas=bss,oc=0);
#-----------------------------------------------------------
r0500m250 <- gamzVrkin(rvl=0.500,kin=0.250,betas=bss,oc=0);
r0250m250 <- gamzVrkin(rvl=0.250,kin=0.250,betas=bss,oc=0);
r0125m250 <- gamzVrkin(rvl=0.125,kin=0.250,betas=bss,oc=0);
r0000m250 <- gamzVrkin(rvl=0.000,kin=0.250,betas=bss,oc=0);
#-----------------------------------------------------------
r0500m500 <- gamzVrkin(rvl=0.500,kin=0.500,betas=bss,oc=0);
r0250m500 <- gamzVrkin(rvl=0.250,kin=0.500,betas=bss,oc=0);
r0125m500 <- gamzVrkin(rvl=0.125,kin=0.500,betas=bss,oc=0);
r0000m500 <- gamzVrkin(rvl=0.000,kin=0.500,betas=bss,oc=0);
#-----------------------------------------------------------
#-----------------------------------------------------------
r0500m000c <- gamzVrkin(rvl=0.500,kin=0.000,betas=bss,oc=1); 
r0250m000c <- gamzVrkin(rvl=0.250,kin=0.000,betas=bss,oc=1);
r0125m000c <- gamzVrkin(rvl=0.125,kin=0.000,betas=bss,oc=1);
r0000m000c <- gamzVrkin(rvl=0.000,kin=0.000,betas=bss,oc=1);
#-----------------------------------------------------------
r0500m125c <- gamzVrkin(rvl=0.500,kin=0.125,betas=bss,oc=1);
r0250m125c <- gamzVrkin(rvl=0.250,kin=0.125,betas=bss,oc=1);
r0125m125c <- gamzVrkin(rvl=0.125,kin=0.125,betas=bss,oc=1);
r0000m125c <- gamzVrkin(rvl=0.000,kin=0.125,betas=bss,oc=1);
#-----------------------------------------------------------
r0500m250c <- gamzVrkin(rvl=0.500,kin=0.250,betas=bss,oc=1);
r0250m250c <- gamzVrkin(rvl=0.250,kin=0.250,betas=bss,oc=1);
r0125m250c <- gamzVrkin(rvl=0.125,kin=0.250,betas=bss,oc=1);
r0000m250c <- gamzVrkin(rvl=0.000,kin=0.250,betas=bss,oc=1);
#-----------------------------------------------------------
r0500m500c <- gamzVrkin(rvl=0.500,kin=0.500,betas=bss,oc=1);
r0250m500c <- gamzVrkin(rvl=0.250,kin=0.500,betas=bss,oc=1);
r0125m500c <- gamzVrkin(rvl=0.125,kin=0.500,betas=bss,oc=1);
r0000m500c <- gamzVrkin(rvl=0.000,kin=0.500,betas=bss,oc=1);
#-----------------------------------------------------------
par(mfrow=c(4,2),mar=c(0.5,0.5,0.5,0.5),oma=c(5.5,5.5,4,1));
#-----------------------------------------------------------
plot(x=bss,y=r0500m000$gam,type="n",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab="",xaxt="n",ylab="",cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.10,0.15,0.20),cex.axis=1.5);
points(x=bss,y=r0500m000$gam,type="l",lwd=4);
points(x=bss,y=r0250m000$gam,type="l",lwd=3);
points(x=bss,y=r0125m000$gam,type="l",lwd=2);
points(x=bss,y=r0000m000$gam,type="l",lwd=1);
text(x=4.95,y=0.212,labels="A",cex=2.5);
text(x=1.20,y=0.212,labels=expression(paste("m*"[r==0])),cex=1.5);
#-----------------------------------------------------------
plot(x=bss,y=r0500m000c$gam,type="n",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab="",xaxt="n",ylab="",cex.lab=1.5,cex.axis=1.5);
points(x=bss,y=r0500m000c$gam,type="l",lwd=4);
points(x=bss,y=r0250m000c$gam,type="l",lwd=3);
points(x=bss,y=r0125m000c$gam,type="l",lwd=2);
points(x=bss,y=r0000m000c$gam,type="l",lwd=1);
text(x=4.95,y=0.212,labels="B",cex=2.5);
text(x=1.20,y=0.212,labels=expression(paste("m*"[r==0])),cex=1.5);
#-----------------------------------------------------------
plot(x=bss,y=r0500m125$gam,type="n",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab="",xaxt="n",ylab="",cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.10,0.15,0.20),cex.axis=1.5);
points(x=bss,y=r0500m125$gam,type="l",lwd=4);
points(x=bss,y=r0250m125$gam,type="l",lwd=3);
points(x=bss,y=r0125m125$gam,type="l",lwd=2);
points(x=bss,y=r0000m125$gam,type="l",lwd=1);
text(x=4.95,y=0.212,labels="C",cex=2.5);
text(x=1.20,y=0.212,labels=expression(paste("m*"[r==1/8])),cex=1.5);
#-----------------------------------------------------------
plot(x=bss,y=r0500m125c$gam,type="n",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab="",xaxt="n",ylab="",cex.lab=1.5,cex.axis=1.5);
points(x=bss,y=r0500m125c$gam,type="l",lwd=4);
points(x=bss,y=r0250m125c$gam,type="l",lwd=3);
points(x=bss,y=r0125m125c$gam,type="l",lwd=2);
points(x=bss,y=r0000m125c$gam,type="l",lwd=1);
text(x=4.95,y=0.212,labels="D",cex=2.5);
text(x=1.20,y=0.212,labels=expression(paste("m*"[r==1/8])),cex=1.5);
#-----------------------------------------------------------
plot(x=bss,y=r0500m250$gam,type="n",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab="",xaxt="n",ylab="",cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.10,0.15,0.20),cex.axis=1.5);
points(x=bss,y=r0500m250$gam,type="l",lwd=4);
points(x=bss,y=r0250m250$gam,type="l",lwd=3);
points(x=bss,y=r0125m250$gam,type="l",lwd=2);
points(x=bss,y=r0000m250$gam,type="l",lwd=1);
text(x=4.95,y=0.212,labels="E",cex=2.5);
text(x=1.20,y=0.212,labels=expression(paste("m*"[r==1/4])),cex=1.5);
#-----------------------------------------------------------
plot(x=bss,y=r0500m250c$gam,type="n",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab="",xaxt="n",ylab="",cex.lab=1.5,cex.axis=1.5);
points(x=bss,y=r0500m250c$gam,type="l",lwd=4);
points(x=bss,y=r0250m250c$gam,type="l",lwd=3);
points(x=bss,y=r0125m250c$gam,type="l",lwd=2);
points(x=bss,y=r0000m250c$gam,type="l",lwd=1);
text(x=4.95,y=0.212,labels="F",cex=2.5);
text(x=1.20,y=0.212,labels=expression(paste("m*"[r==1/4])),cex=1.5);
#-----------------------------------------------------------
plot(x=bss,y=r0500m500$gam,type="n",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab="", ylab="",cex.lab=1.5,cex.axis=1.5);
axis(side=2,at=c(0.10,0.15,0.20),cex.axis=1.5);
points(x=bss,y=r0500m500$gam,type="l",lwd=4);
points(x=bss,y=r0250m500$gam,type="l",lwd=3);
points(x=bss,y=r0125m500$gam,type="l",lwd=2);
points(x=bss,y=r0000m500$gam,type="l",lwd=1);
text(x=4.95,y=0.212,labels="G",cex=2.5);
text(x=1.20,y=0.212,labels=expression(paste("m*"[r==1/2])),cex=1.5);
#-----------------------------------------------------------
plot(x=bss,y=r0500m500$gam,type="n",lwd=2,ylim=c(0.09,0.22),pch=1.5,yaxt="n",
     xlab="",ylab="",cex.lab=1.5,cex.axis=1.5);
points(x=bss,y=r0500m500c$gam,type="l",lwd=4);
points(x=bss,y=r0250m500c$gam,type="l",lwd=3);
points(x=bss,y=r0125m500c$gam,type="l",lwd=2);
points(x=bss,y=r0000m500c$gam,type="l",lwd=1);
text(x=4.95,y=0.212,labels="H",cex=2.5);
text(x=1.20,y=0.212,labels=expression(paste("m*"[r==1/2])),cex=1.5);
#-----------------------------------------------------------
mtext(text=expression(paste("Inbreeding depression (",beta,")")),
      side=1,line=3, cex=1.5, col="black" , outer=TRUE);
mtext(text=expression(paste("Rate of fitness increase (",gamma,")")),
      side=2,line=2, cex=1.5, col="black", outer=TRUE);
mtext(text="Single parent", adj=0,
      side=3,line=1, cex=1.5, col="black", outer=TRUE);
mtext(text="Strict monogamy", adj=1,
      side=3,line=1, cex=1.5, col="black", outer=TRUE);
```

******************************


References
----------------------------------------------


